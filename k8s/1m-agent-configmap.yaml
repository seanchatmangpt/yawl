apiVersion: v1
kind: ConfigMap
metadata:
  name: 1m-agent-config
  namespace: yawl
  labels:
    app.kubernetes.io/name: 1m-agent
    app.kubernetes.io/component: config
    app.kubernetes.io/part-of: yawl
    app.kubernetes.io/version: "6.0.0"
data:
  # Heartbeat Configuration (agent liveness in cluster)
  HEARTBEAT_TTL_SECONDS: "60"
  HEARTBEAT_INTERVAL_SECONDS: "30"
  HEARTBEAT_EXECUTOR_TYPE: "VIRTUAL_THREAD"

  # Agent Discovery Configuration
  DISCOVERY_POLL_INTERVAL_MS: "5000"
  DISCOVERY_SERVICE_SELECTOR: "app.kubernetes.io/component=autonomous-agent"
  DISCOVERY_RETRY_BACKOFF_MS: "1000"
  DISCOVERY_MAX_RETRIES: "3"

  # HTTP Client & Connection Pooling
  HTTP_CLIENT_POOL_SIZE: "UNBOUNDED"
  HTTP_CORE_THREADS: "16"
  HTTP_MAX_THREADS: "128"
  HTTP_QUEUE_SIZE: "1024"
  HTTP_KEEP_ALIVE_MS: "60000"

  # Marketplace & Agent Index
  MARKETPLACE_INDEX_TYPE: "CONCURRENT_HASH_SET"
  MARKETPLACE_CACHE_SIZE: "10000"
  MARKETPLACE_CACHE_TTL_SECONDS: "300"
  MARKETPLACE_REFRESH_INTERVAL_MS: "10000"

  # Service Discovery & Registration
  AGENT_DISCOVERY_BACKOFF_ENABLED: "true"
  AGENT_DISCOVERY_BACKOFF_JITTER_PERCENT: "10"
  AGENT_DISCOVERY_INITIAL_BACKOFF_MS: "100"
  AGENT_DISCOVERY_MAX_BACKOFF_MS: "30000"
  AGENT_DISCOVERY_TIMEOUT_MS: "10000"

  # A2A (Agent-to-Agent) Communication
  A2A_PROTOCOL_VERSION: "1.0"
  A2A_MESSAGE_TIMEOUT_MS: "30000"
  A2A_BATCH_SIZE: "100"
  A2A_BATCH_TIMEOUT_MS: "1000"

  # MCP (Model Context Protocol) Configuration
  MCP_ENABLED: "true"
  MCP_PROTOCOL_VERSION: "2024-11-05"
  MCP_REQUEST_TIMEOUT_MS: "30000"

  # Task Queue Configuration
  TASK_QUEUE_SIZE: "10000"
  TASK_QUEUE_TIMEOUT_MS: "60000"
  TASK_BATCH_SIZE: "50"
  TASK_THREAD_POOL_SIZE: "32"

  # Resilience & Retry Configuration
  RETRY_MAX_ATTEMPTS: "3"
  RETRY_BACKOFF_MS: "1000"
  RETRY_BACKOFF_MULTIPLIER: "2.0"
  CIRCUIT_BREAKER_ENABLED: "true"
  CIRCUIT_BREAKER_FAILURE_THRESHOLD: "5"
  CIRCUIT_BREAKER_SUCCESS_THRESHOLD: "2"
  CIRCUIT_BREAKER_TIMEOUT_MS: "60000"

  # Cache Configuration
  CACHE_ENABLED: "true"
  CACHE_MAX_SIZE: "50000"
  CACHE_TTL_SECONDS: "600"
  CACHE_EXPIRE_AFTER_WRITE_SECONDS: "300"

  # Metric & Monitoring Configuration
  METRICS_ENABLED: "true"
  METRICS_EXPORT_INTERVAL_SECONDS: "60"
  METRICS_HISTOGRAM_BUCKETS: "0.001,0.005,0.010,0.050,0.100,0.500,1.0,5.0,10.0"

  # Rate Limiting Configuration
  RATE_LIMIT_ENABLED: "true"
  RATE_LIMIT_REQUESTS_PER_SECOND: "1000"
  RATE_LIMIT_BURST_SIZE: "500"

  # Timeout Configuration
  AGENT_INITIALIZATION_TIMEOUT_MS: "30000"
  AGENT_SHUTDOWN_TIMEOUT_MS: "15000"
  MARKETPLACE_SYNC_TIMEOUT_MS: "5000"

  # Logging Configuration
  LOG_LEVEL: "INFO"
  LOG_FORMAT: "json"
  LOG_RETENTION_DAYS: "7"
  LOG_MAX_FILE_SIZE_MB: "100"

  # Health Check Configuration
  HEALTH_CHECK_ENDPOINT: "/actuator/health"
  HEALTH_CHECK_READINESS_ENDPOINT: "/actuator/health/readiness"
  HEALTH_CHECK_LIVENESS_ENDPOINT: "/actuator/health/liveness"
  HEALTH_CHECK_INTERVAL_SECONDS: "10"

  # Distributed Tracing Configuration
  TRACING_ENABLED: "true"
  TRACING_SAMPLE_RATE: "0.1"
  TRACING_ENDPOINT: "http://otel-collector:4317"

  # Database Connection Pool (if applicable)
  DB_POOL_SIZE: "20"
  DB_MAX_POOL_SIZE: "40"
  DB_CONNECTION_TIMEOUT_MS: "10000"
  DB_IDLE_TIMEOUT_MS: "900000"
  DB_MAX_LIFETIME_MS: "1800000"

  # Locality-Aware Configuration
  PREFER_LOCAL_REPLICAS: "true"
  ZONE_AWARENESS_ENABLED: "true"

  # Security Configuration
  ENABLE_MTLS: "true"
  TLS_CERT_PATH: "/etc/tls/certs/tls.crt"
  TLS_KEY_PATH: "/etc/tls/certs/tls.key"
  TLS_CA_PATH: "/etc/tls/certs/ca.crt"

  # Feature Flags
  FEATURE_AGENT_GROUPS_ENABLED: "true"
  FEATURE_AGENT_FEDERATION_ENABLED: "true"
  FEATURE_MARKETPLACE_FILTERING_ENABLED: "true"
  FEATURE_DISTRIBUTED_LOCKING_ENABLED: "true"
