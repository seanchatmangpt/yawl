PREFIX yawl: <http://yawlfoundation.org/yawl#>
PREFIX xsd:  <http://www.w3.org/2001/XMLSchema#>

# ============================================================================
# SELECT: Enabled Tasks from Live Case State
# ============================================================================
#
# This query is the fundamental CONSTRUCT coordination primitive:
# "What should this agent do next?" answered by SPARQL, not LLM inference.
#
# In the YAWL execution model (YNetRunner, YTask.t_enabled):
#   - Conditions (places) hold tokens (YIdentifier bags)
#   - Tasks (transitions) are enabled when preset conditions are marked:
#       AND-join: ALL preset conditions contain a token for this case
#       XOR-join: ANY preset condition contains a token for this case
#       OR-join:  at least one path can still complete through the join
#                 (computed via E2WFO algorithm in YNet.orJoinEnabled())
#
# Java implementation (stateful engine):
#   YNetRunner.getEnabledTaskNames() [line 358]
#   YTask.t_enabled(YIdentifier caseId) [line 1089]
#
# Via InterfaceB (HTTP):
#   InterfaceB.getWorkItemsForCase(caseId) → filter by status == "Enabled"
#   WorkItemRecord.statusEnabled = "Enabled"
#
# Cost comparison per routing decision:
#   select/do agent:   ~2000 tokens, ~200ms, non-deterministic output
#   This SELECT query:   0 tokens,   <1ms,   deterministic, formally proven
#
# The cost differential scales superlinearly with agent count (Little's Law):
#   N agents × 2000 tokens/decision × D decisions/second = token wall
#   N agents × 0 tokens/decision × D decisions/second = 0 token overhead
# ============================================================================

SELECT ?taskId ?taskName ?joinType ?splitType ?caseId
WHERE {
    ?case a yawl:CaseState ;
          yawl:caseId ?caseId .

    ?task a yawl:AtomicTask ;
          yawl:taskId  ?taskId ;
          yawl:enabled true ;
          yawl:inCase  ?case .

    OPTIONAL { ?task yawl:taskName  ?taskName }
    OPTIONAL { ?task yawl:joinType  ?joinType }
    OPTIONAL { ?task yawl:splitType ?splitType }

    # Token marking predicate (Petri net semantics):
    # For XOR-join: FILTER EXISTS { ?presetCond yawl:hasToken ?case }
    # For AND-join: All preset conditions checked via sub-SELECT
    # Implemented in Java as YTask.t_enabled(caseId) with split-join dispatch
}
ORDER BY ?taskId
