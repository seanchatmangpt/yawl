# YAWL MCP Spring AI Integration - Application Configuration
#
# This configuration file demonstrates the recommended setup for
# YAWL MCP Spring integration in a production environment.

spring:
  application:
    name: yawl-mcp-server

  # Disable Spring Boot banner for cleaner MCP server output
  main:
    banner-mode: off
    web-application-type: none  # No embedded web server for STDIO transport

# YAWL MCP Configuration
yawl:
  mcp:
    # Enable/disable YAWL MCP integration
    enabled: true

    # YAWL engine connection
    engine-url: ${YAWL_ENGINE_URL:http://localhost:8080/yawl}
    username: ${YAWL_USERNAME:admin}
    password: ${YAWL_PASSWORD}

    # MCP transport configuration
    transport: stdio  # Options: stdio, http

    # HTTP transport settings (used when transport=http)
    http:
      enabled: false
      port: 8081
      path: /mcp

    # Z.AI natural language integration
    zai:
      enabled: true
      api-key: ${ZAI_API_KEY:}  # Also checks ZHIPU_API_KEY

    # Connection retry and timeout configuration
    connection:
      retry-attempts: 3
      retry-delay-ms: 1000
      timeout-ms: 5000

# Logging Configuration
logging:
  level:
    root: WARN
    org.yawlfoundation.yawl.integration.mcp.spring: INFO
    org.yawlfoundation.yawl.integration.mcp: INFO
    org.yawlfoundation.yawl.engine: WARN
    io.modelcontextprotocol: INFO

  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# Spring Boot Actuator (optional, for health monitoring)
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: when-authorized

# OpenTelemetry Configuration (optional, for observability)
otel:
  service:
    name: yawl-mcp-server
  traces:
    exporter: none  # Options: otlp, logging, none
  metrics:
    exporter: none  # Options: prometheus, otlp, logging, none
  logs:
    exporter: none  # Options: otlp, logging, none

# Resilience4j Configuration (optional, for circuit breakers)
resilience4j:
  circuitbreaker:
    instances:
      yawlEngine:
        registerHealthIndicator: true
        slidingWindowSize: 10
        minimumNumberOfCalls: 5
        permittedNumberOfCallsInHalfOpenState: 3
        automaticTransitionFromOpenToHalfOpenEnabled: true
        waitDurationInOpenState: 10s
        failureRateThreshold: 50
        eventConsumerBufferSize: 10

  retry:
    instances:
      yawlEngine:
        maxAttempts: 3
        waitDuration: 1000ms
        exponentialBackoffMultiplier: 2
        retryExceptions:
          - java.io.IOException
          - java.net.ConnectException

---
# Development Profile
spring:
  config:
    activate:
      on-profile: dev

yawl:
  mcp:
    engine-url: http://localhost:8080/yawl
    connection:
      retry-attempts: 1  # Fail fast in development

logging:
  level:
    org.yawlfoundation.yawl.integration.mcp.spring: DEBUG
    org.yawlfoundation.yawl.integration.mcp: DEBUG

---
# Production Profile
spring:
  config:
    activate:
      on-profile: prod

yawl:
  mcp:
    connection:
      retry-attempts: 5
      retry-delay-ms: 2000
      timeout-ms: 10000

logging:
  level:
    root: ERROR
    org.yawlfoundation.yawl.integration.mcp.spring: INFO

otel:
  traces:
    exporter: otlp
  metrics:
    exporter: prometheus
