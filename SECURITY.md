# YAWL Security Policy

## Credential Security Audit - February 2026

This document records the findings of the February 2026 credential security audit
(17 findings) and provides the required integration procedures.

---

## Known Credential Defaults Removed

The following hardcoded credential defaults have been removed as of this audit.
Any deployment that relied on these defaults must be reconfigured before upgrading.

| File | Location | Finding | Remediation |
|------|----------|---------|-------------|
| `YEngine.java` | `setAllowAdminID()` line 2097 | Hardcoded admin password `"YAWL"` passed to `PasswordEncryptor.encrypt()` | Replaced with `UnsupportedOperationException`; configure via `CredentialManager` |
| `InterfaceBWebsideController.java` | `loadEnginePassword()` | Silent `return null` fallback when no credential configured | Replaced with `UnsupportedOperationException`; set `YAWL_ENGINE_PASSWORD` env var |
| `MainScreen.java` | field `sPwd` | Hardcoded default `"YAWL"` for proclet service editor | Replaced with `loadServicePassword()` fail-fast; set `YAWL_SERVICE_PASSWORD` env var |
| `AgentFactory.java` | `fromEnvironment()` | `getEnv("YAWL_PASSWORD", "YAWL")` silent fallback default | Replaced with mandatory `YAWL_PASSWORD` env var check |
| `YawlA2AServer.java` | `main()` error message | Error message leaked `"YAWL"` as example password value | Replaced with reference to `SECURITY.md` |
| `YawlMcpServer.java` | `main()` error message | Error message leaked `"YAWL"` as example password value | Replaced with reference to `SECURITY.md` |
| `SelfPlayTest.java` | lines 136, 262 | Hardcoded `"YAWL"` fallback in integration test credential loading | Replaced with mandatory `YAWL_PASSWORD` env var check |
| `PasswordEncryptor.java` | `encrypt(String, String)` | Silent catch block returning caller-supplied default | Replaced with `UnsupportedOperationException`; migrate to `Argon2PasswordEncryptor` |

### SHA-1 Deprecation

`PasswordEncryptor.encrypt()` uses SHA-1 (via `MessageDigest.getInstance("SHA")`).
SHA-1 is cryptographically broken for password storage (NIST SP 800-131A Rev 2,
OWASP Password Storage Cheat Sheet 2024). The method is retained only for backward
compatibility with existing persisted hashes during a migration window.

**Migration path**: Use `Argon2PasswordEncryptor` for all new credentials. To migrate
existing SHA-1 hashes, force a password reset on the next login and store the new
Argon2id hash.

---

## Required Vault Integration Steps

### 1. Choose a Secrets Backend

Supported options:
- **HashiCorp Vault** (recommended): KV secrets engine v2
- **AWS Secrets Manager**: via AWS SDK v2
- **Azure Key Vault**: via Azure SDK
- **Environment variables** (development only): not permitted in production

### 2. Create Required Secrets

Create the following secrets in your vault before deploying YAWL:

```
secret/yawl/admin/password          # YAWL admin account password
secret/yawl/engine/service-password # Engine service authentication password
secret/yawl/integration/zai-api-key # Z.AI API key
secret/yawl/integration/zhipu-api-key # Zhipu AI API key (optional)
secret/yawl/procletservice/password # Proclet service editor password
```

All secrets must be strong random values generated by a cryptographically secure
random number generator (at least 128 bits of entropy).

### 3. Implement CredentialManager

Create an implementation of `org.yawlfoundation.yawl.security.CredentialManager`
backed by your chosen vault. Example for HashiCorp Vault (pseudocode):

```java
public class VaultCredentialManager implements CredentialManager {
    private final VaultTemplate vault;

    @Override
    public String getCredential(CredentialKey key) {
        String path = vaultPathFor(key);
        VaultResponse response = vault.read(path);
        String value = (String) response.getData().get("value");
        if (value == null || value.isEmpty()) {
            throw new CredentialUnavailableException(key,
                "Secret at " + path + " is null or empty");
        }
        return value;
    }
    // ...
}
```

### 4. Register at Startup

In your servlet context initializer or Spring `@Configuration`:

```java
VaultCredentialManager vault = new VaultCredentialManager(vaultConfig);
CredentialManagerFactory.setInstance(vault);
```

This must happen before any YAWL component starts. Failure to register results in
`UnsupportedOperationException` at credential access time.

### 5. Environment Variables for Development

During development, the following environment variables are accepted as a substitute
for vault integration. They must never be used in production:

| Variable | Purpose |
|----------|---------|
| `YAWL_ENGINE_PASSWORD` | Engine Interface B service password |
| `YAWL_PASSWORD` | General YAWL authentication password |
| `YAWL_USERNAME` | YAWL authentication username (default: admin) |
| `YAWL_SERVICE_PASSWORD` | Proclet service editor password |
| `ZAI_API_KEY` | Z.AI API key |
| `ZHIPU_API_KEY` | Zhipu AI API key |

---

## Credential Rotation Procedures

### Scheduled Rotation (every 90 days)

1. Generate a new strong random password (minimum 128-bit entropy).
2. Update the secret in vault:
   ```
   vault kv put secret/yawl/<name> value=<new-password>
   ```
3. Call `CredentialManager.rotateCredential(key, newValue)` via the admin API.
4. Verify YAWL services reconnect successfully (check health endpoints).
5. Revoke the previous secret version after the rotation window (recommended: 24 hours).

### Emergency Rotation (credential compromise suspected)

1. Immediately revoke the compromised secret in vault.
2. Generate and deploy a replacement following the scheduled rotation procedure.
3. Review vault audit logs for unauthorized access.
4. Invalidate all active YAWL sessions.
5. File a security incident report per your organisation's IR procedure.

### API Key Rotation (Z.AI, Zhipu)

External API keys are rotated on demand via the respective provider dashboards.
After rotation, update the vault secret and restart affected YAWL services.

---

## Reporting Vulnerabilities

Report security vulnerabilities via the YAWL Foundation security contact.
Do not file public GitHub issues for security vulnerabilities.

---

*Last updated: 2026-02-17 (credential security audit P0/P1 remediation)*
