# JUnit Platform parallel execution configuration.
#
# Part 4 Optimization: Virtual Thread Optimized Configuration
#
# Key changes from Part 3:
# - Dynamic factor increased from 3.0 to 4.0 for virtual threads
# - Max pool size increased from 32 to 512 for unlimited virtual thread parallelism
# - Added virtual thread pinning detection
# - Virtual threads allow 512+ concurrent tests vs 32 platform threads
#
# Why virtual threads: Java 21+ virtual threads are lightweight (~1KB vs ~1MB platform threads)
# and can scale to thousands of concurrent tasks. This is ideal for I/O-bound tests
# (H2 setup, XML parsing, network calls) which are common in YAWL's test suite.
#
# Why parallel=true: JUnit 5 does not inherit Maven Surefire's legacy
# parallel/threadCount settings. This file is the authoritative source.
#
# Why dynamic.factor=4.0: Virtual threads have minimal overhead, so we can
# overprovision more aggressively than with platform threads. 4.0 creates
# 4 threads per available processor for mixed I/O+CPU workloads.
junit.jupiter.execution.parallel.enabled=true
junit.jupiter.execution.parallel.mode.default=concurrent
junit.jupiter.execution.parallel.mode.classes.default=concurrent
junit.jupiter.execution.parallel.config.strategy=dynamic

# Virtual thread optimized (Part 4): 4x factor, 512 max pool
junit.jupiter.execution.parallel.config.dynamic.factor=4.0
junit.jupiter.execution.parallel.config.dynamic.max-pool-size=512

# Test sharding for CI parallelization - 8 shards for optimal parallelism
yawl.test.shard.count=8
yawl.test.shard.index=${yawl.test.shard.index:0}

# Virtual thread pinning detection (Part 4)
# Set to 'full' for detailed stack traces when virtual threads are pinned.
# Set to 'short' for brief warnings. Comment out to disable.
yawl.test.virtual.pinning.detection=true

# Timeouts prevent runaway tests from blocking the entire test suite.
# Method-level: 90s is generous enough for integration-style unit tests.
# Class-level: 180s covers all @BeforeAll/@AfterAll setup/teardown overhead.
junit.jupiter.execution.timeout.default=90 s
junit.jupiter.execution.timeout.testable.method.default=180 s
junit.jupiter.execution.timeout.lifecycle.method.default=180 s
