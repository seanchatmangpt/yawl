<?xml version="1.0" encoding="UTF-8"?>
<!--
  Test Specification for AND Join Semantics

  Purpose: Verify AND join enablement requires ALL preset conditions to have tokens.

  Structure:
    input -> split-task (AND split) -> parallel-A -> join-task (AND join) -> output
                                   -> parallel-B -> (to join-task)

  Invariants tested:
  1. AND join task is NOT enabled when only ONE preset has a token
  2. AND join task IS enabled when ALL presets have tokens
-->
<specificationSet xmlns="http://www.citi.qut.edu.au/yawl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.citi.qut.edu.au/yawl YAWL_Schema.xsd">
  <specification uri="YAWL_Specification_AndJoin.xml">
    <metaData />
    <rootNet id="and-join-test-net">
      <processControlElements>
        <!-- Input condition -->
        <inputCondition id="input">
          <name>Input</name>
          <flowsInto>
            <nextElementRef id="split-task" />
          </flowsInto>
        </inputCondition>

        <!-- Task with AND split - creates parallel paths -->
        <task id="split-task">
          <flowsInto>
            <nextElementRef id="c-parallel-a" />
          </flowsInto>
          <flowsInto>
            <nextElementRef id="c-parallel-b" />
          </flowsInto>
          <join code="xor" />
          <split code="and" />
          <decomposesTo id="SplitTask" />
        </task>

        <!-- Condition for parallel path A -->
        <condition id="c-parallel-a">
          <flowsInto>
            <nextElementRef id="parallel-a" />
          </flowsInto>
        </condition>

        <!-- Condition for parallel path B -->
        <condition id="c-parallel-b">
          <flowsInto>
            <nextElementRef id="parallel-b" />
          </flowsInto>
        </condition>

        <!-- Parallel task A -->
        <task id="parallel-a">
          <flowsInto>
            <nextElementRef id="c-join-input-a" />
          </flowsInto>
          <join code="xor" />
          <split code="and" />
          <decomposesTo id="ParallelA" />
        </task>

        <!-- Parallel task B -->
        <task id="parallel-b">
          <flowsInto>
            <nextElementRef id="c-join-input-b" />
          </flowsInto>
          <join code="xor" />
          <split code="and" />
          <decomposesTo id="ParallelB" />
        </task>

        <!-- Condition before AND join from path A -->
        <condition id="c-join-input-a">
          <flowsInto>
            <nextElementRef id="join-task" />
          </flowsInto>
        </condition>

        <!-- Condition before AND join from path B -->
        <condition id="c-join-input-b">
          <flowsInto>
            <nextElementRef id="join-task" />
          </flowsInto>
        </condition>

        <!-- Task with AND join - requires tokens from BOTH paths -->
        <task id="join-task">
          <flowsInto>
            <nextElementRef id="output" />
          </flowsInto>
          <join code="and" />
          <split code="and" />
          <decomposesTo id="JoinTask" />
        </task>

        <!-- Output condition -->
        <outputCondition id="output">
          <name>Output</name>
        </outputCondition>
      </processControlElements>
    </rootNet>

    <!-- Decompositions -->
    <decomposition id="SplitTask" xsi:type="WebServiceGatewayFactsType" />
    <decomposition id="ParallelA" xsi:type="WebServiceGatewayFactsType" />
    <decomposition id="ParallelB" xsi:type="WebServiceGatewayFactsType" />
    <decomposition id="JoinTask" xsi:type="WebServiceGatewayFactsType" />
  </specification>
</specificationSet>
