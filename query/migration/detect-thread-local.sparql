# Detect Java 11 ThreadLocal Pattern
# Finds: ThreadLocal<T> field declarations â€” candidates for ScopedValue<T>.
# Rule: R03_ThreadLocalToScopedValue  (HIGH complexity, requires review)

PREFIX java: <http://yawl.io/java#>
PREFIX xsd:  <http://www.w3.org/2001/XMLSchema#>

SELECT ?file ?class ?field ?line ?fieldName ?snippet
WHERE {
  ?field a java:FieldDeclaration ;
         java:name ?fieldName ;
         java:lineNumber ?line .

  ?fieldType a java:TypeRef ;
             java:name ?typeName .

  ?field java:fieldType ?fieldType .

  FILTER(STRSTARTS(?typeName, "ThreadLocal"))

  ?class a java:ClassDeclaration ;
         java:hasField ?field ;
         java:qualifiedName ?className .

  ?cu a java:CompilationUnit ;
      java:filePath ?file .

  OPTIONAL { ?field java:sourceText ?snippet }
}
ORDER BY ?file ?line
