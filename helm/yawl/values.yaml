# =============================================================================
# YAWL v6.0.0-Alpha Helm Chart - Default Values
# =============================================================================
# Cloud-native workflow engine with Petri Net semantics and virtual threads.
# Override these values with environment-specific values files.
#
# Usage:
#   helm install yawl ./helm/yawl -f values.yaml
#   helm install yawl ./helm/yawl -f values.yaml -f values-production.yaml
# =============================================================================

# -----------------------------------------------------------------------------
# Global Settings
# -----------------------------------------------------------------------------
global:
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: ""
  namespace: yawl
  labels: {}
  annotations: {}

# -----------------------------------------------------------------------------
# YAWL Version Information
# -----------------------------------------------------------------------------
yawlVersion: "6.0.0-Alpha"
buildNumber: "6000"

# -----------------------------------------------------------------------------
# Cloud Provider Configuration
# -----------------------------------------------------------------------------
cloudProvider: ""  # gcp, aws, azure, oracle, ibm, or empty for generic

# -----------------------------------------------------------------------------
# Image Configuration
# -----------------------------------------------------------------------------
image:
  registry: docker.io
  repository: yawl/yawl-engine
  tag: "6.0.0-alpha"
  pullPolicy: IfNotPresent

# -----------------------------------------------------------------------------
# Replica Configuration
# -----------------------------------------------------------------------------
replicaCount: 2

# -----------------------------------------------------------------------------
# Database Configuration
# -----------------------------------------------------------------------------
# Embedded PostgreSQL (via Bitnami subchart)
postgresql:
  enabled: true
  auth:
    postgresPassword: "yawl-admin"
    password: "yawl"
    database: "yawl"
  primary:
    persistence:
      enabled: true
      size: 20Gi
      storageClass: ""
  readReplicas:
    replicaCount: 0

# External PostgreSQL (when postgresql.enabled is false)
externalDatabase:
  host: ""
  port: 5432
  database: yawl
  user: yawl
  password: ""
  existingSecret: ""
  existingSecretPasswordKey: password

# -----------------------------------------------------------------------------
# Redis Configuration (Session Management)
# -----------------------------------------------------------------------------
redis:
  enabled: true
  auth:
    enabled: true
    password: "yawl-redis"
  master:
    persistence:
      enabled: true
      size: 8Gi
  replica:
    replicaCount: 1

# External Redis (when redis.enabled is false)
externalRedis:
  host: ""
  port: 6379
  password: ""
  existingSecret: ""
  existingSecretPasswordKey: password

# -----------------------------------------------------------------------------
# Service Configuration
# -----------------------------------------------------------------------------
service:
  type: ClusterIP
  port: 8080
  targetPort: 8080
  managementPort: 9090
  managementTargetPort: 9090
  resourcePort: 8081
  resourceTargetPort: 8081
  annotations: {}
  labels: {}

# -----------------------------------------------------------------------------
# Health Check Configuration (Spring Boot Actuator)
# -----------------------------------------------------------------------------
healthcheck:
  # Liveness probe - restarts container if failed
  liveness:
    enabled: true
    path: /actuator/health/liveness
    port: 9090
    initialDelaySeconds: 120
    periodSeconds: 30
    timeoutSeconds: 15
    failureThreshold: 3
    successThreshold: 1

  # Readiness probe - removes from service if failed
  readiness:
    enabled: true
    path: /actuator/health/readiness
    port: 9090
    initialDelaySeconds: 60
    periodSeconds: 10
    timeoutSeconds: 10
    failureThreshold: 3
    successThreshold: 1

  # Startup probe - for slow-starting containers
  startup:
    enabled: true
    path: /actuator/health/liveness
    port: 9090
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 10
    failureThreshold: 18  # 3 minutes max startup time

# -----------------------------------------------------------------------------
# Resource Management
# -----------------------------------------------------------------------------
resources:
  requests:
    cpu: 500m
    memory: 1Gi
  limits:
    cpu: 4000m
    memory: 4Gi

# -----------------------------------------------------------------------------
# JVM Configuration (Java 25 + Virtual Threads)
# -----------------------------------------------------------------------------
jvm:
  # Core JVM options optimized for Java 25 and containers
  opts: >-
    -XX:+UseContainerSupport
    -XX:MaxRAMPercentage=75.0
    -XX:InitialRAMPercentage=50.0
    -XX:+UseZGC
    -XX:+ZGenerational
    -XX:+UseStringDeduplication
    -XX:+ExitOnOutOfMemoryError
    -XX:+HeapDumpOnOutOfMemoryError
    -XX:HeapDumpPath=/app/logs/heap-dump.hprof
    -Djava.security.egd=file:/dev/./urandom
    -Djava.io.tmpdir=/app/temp
    -Dfile.encoding=UTF-8
    -Djdk.virtualThreadScheduler.parallelism=200
    -Djdk.virtualThreadScheduler.maxPoolSize=256
    -Djdk.tracePinnedThreads=short

  # Additional JVM options (appended to opts)
  extraOpts: ""

# -----------------------------------------------------------------------------
# Spring Boot Configuration
# -----------------------------------------------------------------------------
spring:
  profilesActive: production
  application:
    name: yawl-engine

# -----------------------------------------------------------------------------
# Actuator Configuration
# -----------------------------------------------------------------------------
actuator:
  enabled: true
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,logfile,env,beans
  health:
    probes:
      enabled: true
    showDetails: when-authorized

# -----------------------------------------------------------------------------
# OpenTelemetry Configuration
# -----------------------------------------------------------------------------
opentelemetry:
  enabled: true
  serviceName: yawl-engine
  tracesExporter: otlp
  metricsExporter: prometheus
  logsExporter: otlp
  exporter:
    otlp:
      endpoint: http://otel-collector:4318
  resource:
    attributes: "service.name=yawl-engine,service.version=6.0.0-alpha"

# -----------------------------------------------------------------------------
# Logging Configuration
# -----------------------------------------------------------------------------
logging:
  level:
    root: INFO
    yawlfoundation: DEBUG
    hibernate: WARN
    springframework: INFO
  format: json
  file:
    path: /app/logs
    name: yawl-engine.log
    maxSize: 100MB
    maxHistory: 10
    totalSizeCap: 1GB

# -----------------------------------------------------------------------------
# Persistence Configuration
# -----------------------------------------------------------------------------
persistence:
  enabled: true
  specifications:
    enabled: true
    size: 5Gi
    storageClass: ""
    accessMode: ReadWriteOnce
  logs:
    enabled: true
    size: 10Gi
    storageClass: ""
    accessMode: ReadWriteOnce
  data:
    enabled: true
    size: 20Gi
    storageClass: ""
    accessMode: ReadWriteOnce
  config:
    enabled: true
    size: 1Gi
    storageClass: ""
    accessMode: ReadWriteOnce

# -----------------------------------------------------------------------------
# Ingress Configuration
# -----------------------------------------------------------------------------
ingress:
  enabled: true
  className: nginx
  annotations:
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "60"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
    nginx.ingress.kubernetes.io/configuration-snippet: |
      add_header X-Frame-Options "SAMEORIGIN" always;
      add_header X-Content-Type-Options "nosniff" always;
      add_header X-XSS-Protection "1; mode=block" always;
      add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: yawl.example.com
      paths:
        - path: /
          pathType: Prefix
          port: 8080
        - path: /actuator
          pathType: Prefix
          port: 9090
  tls:
    - secretName: yawl-tls-secret
      hosts:
        - yawl.example.com

# -----------------------------------------------------------------------------
# Horizontal Pod Autoscaler
# -----------------------------------------------------------------------------
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80
  # Custom metrics (optional)
  metrics: []
  behavior: {}

# -----------------------------------------------------------------------------
# Pod Disruption Budget
# -----------------------------------------------------------------------------
podDisruptionBudget:
  enabled: true
  minAvailable: 1
  # maxUnavailable: 1

# -----------------------------------------------------------------------------
# Network Policy
# -----------------------------------------------------------------------------
networkPolicy:
  enabled: true
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: ingress-nginx
      ports:
        - protocol: TCP
          port: 8080
        - protocol: TCP
          port: 9090
  egress:
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 5432  # PostgreSQL
        - protocol: TCP
          port: 6379  # Redis
        - protocol: TCP
          port: 4317  # OTLP gRPC
        - protocol: TCP
          port: 4318  # OTLP HTTP
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 53  # DNS
        - protocol: UDP
          port: 53

# -----------------------------------------------------------------------------
# Security Context
# -----------------------------------------------------------------------------
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000
  seccompProfile:
    type: RuntimeDefault

containerSecurityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000

# -----------------------------------------------------------------------------
# Service Account
# -----------------------------------------------------------------------------
serviceAccount:
  create: true
  name: ""
  annotations: {}
  labels: {}
  automountServiceAccountToken: true

# -----------------------------------------------------------------------------
# Secrets Configuration
# -----------------------------------------------------------------------------
secrets:
  database:
    create: true
    name: ""
    user: yawl
    password: yawl
  apiKeys:
    create: true
    name: ""
    engineApiKey: ""
  encryptionKey:
    create: true
    name: ""
    key: ""

# -----------------------------------------------------------------------------
# Cloud-Specific Settings
# -----------------------------------------------------------------------------
# GCP CloudSQL Proxy
cloudsqlProxy:
  enabled: false
  instanceConnectionName: ""
  serviceAccount: ""
  serviceAccountJson: ""
  proxyPort: 5432

# AWS RDS Proxy
awsRdsProxy:
  enabled: false
  endpoint: ""
  port: 5432

# Azure Database
azureDatabase:
  enabled: false
  serverName: ""

# Oracle Cloud
oracleDatabase:
  enabled: false
  ocid: ""

# IBM Cloud
ibmDatabase:
  enabled: false
  instanceId: ""

# -----------------------------------------------------------------------------
# Node Scheduling
# -----------------------------------------------------------------------------
nodeSelector: {}
tolerations: []
affinity: {}
topologySpreadConstraints: []
priorityClassName: ""
terminationGracePeriodSeconds: 60

# -----------------------------------------------------------------------------
# Init Containers
# -----------------------------------------------------------------------------
initContainers: []
  # Example: Wait for database
  # - name: wait-for-db
  #   image: busybox:1.36
  #   command: ['sh', '-c', 'until nc -z postgres 5432; do echo waiting for db; sleep 2; done']

# -----------------------------------------------------------------------------
# Extra Configuration
# -----------------------------------------------------------------------------
extraEnv: []
extraEnvFrom: []
extraVolumes: []
extraVolumeMounts: []
extraDeploy: []

# -----------------------------------------------------------------------------
# Pod Labels and Annotations
# -----------------------------------------------------------------------------
podLabels: {}
podAnnotations: {}

# -----------------------------------------------------------------------------
# Metrics and Monitoring
# -----------------------------------------------------------------------------
metrics:
  enabled: true
  serviceMonitor:
    enabled: false
    namespace: ""
    interval: 30s
    scrapeTimeout: 10s
    labels: {}
    relabelings: []
    metricRelabelings: []

prometheus:
  rules:
    enabled: false
    additionalLabels: {}
    namespace: ""

# -----------------------------------------------------------------------------
# Service Mesh (Istio)
# -----------------------------------------------------------------------------
istio:
  enabled: false
  gateway:
    enabled: false
    name: ""
  virtualService:
    enabled: false
    hosts: []
    gateways: []
  destinationRule:
    enabled: false
    subsets: []

# -----------------------------------------------------------------------------
# H2 Database (Development Only)
# -----------------------------------------------------------------------------
h2:
  enabled: false
  console:
    enabled: false
    port: 8082
  tcp:
    enabled: false
    port: 9092
