# YAWL Helm Chart - Oracle Cloud Infrastructure (OCI) Values
# Override values for deploying YAWL on Oracle Cloud OKE

# -----------------------------------------------------------------------------
# Cloud Provider
# -----------------------------------------------------------------------------
cloudProvider: oracle

# -----------------------------------------------------------------------------
# Global Settings
# -----------------------------------------------------------------------------
global:
  storageClass: oci-bv  # Oracle Block Volume default
  labels:
    cloud-provider: oci
    environment: production

# -----------------------------------------------------------------------------
# Image Configuration - Use OCIR
# -----------------------------------------------------------------------------
image:
  registry: iad.ocir.io
  repository: your-namespace/yawl

# -----------------------------------------------------------------------------
# Database Configuration - Oracle Autonomous Database or ATP
# -----------------------------------------------------------------------------
postgresql:
  enabled: false  # Use OCI Database instead

externalDatabase:
  # Use OCI Database System PostgreSQL endpoint
  host: "yawl-db.subnet.yawl-vcn.oraclevcn.com"
  port: 5432
  database: yawl
  user: admin
  password: ""
  existingSecret: yawl-db-credentials
  existingSecretPasswordKey: password

# Oracle Cloud Database Configuration
oracleDatabase:
  enabled: true
  # Autonomous Transaction Processing
  autonomous:
    enabled: false
    ocid: "ocid1.autonomousdatabase.oc1.iad.anuwcl..."
    walletSecret: yawl-db-wallet
  # Base Database System (PostgreSQL compatible)
  databaseSystem:
    enabled: true
    ocid: "ocid1.dbsystem.oc1.iad.anuwcl..."
    compartmentId: "ocid1.compartment.oc1..."
    subnetId: "ocid1.subnet.oc1.iad.aaaa..."
  # MySQL HeatWave (alternative)
  mysql:
    enabled: false
    ocid: "ocid1.mysqldbsystem.oc1.iad.anuwcl..."

# -----------------------------------------------------------------------------
# Redis Configuration - OCI Cache
# -----------------------------------------------------------------------------
redis:
  enabled: false  # Use OCI Cache instead

externalRedis:
  host: "yawl-redis.subnet.yawl-vcn.oraclevcn.com"
  port: 6379
  password: ""
  existingSecret: yawl-redis-credentials
  existingSecretPasswordKey: password

# OCI Cache Configuration
ociCache:
  enabled: true
  clusterName: yawl-redis
  compartmentId: "ocid1.compartment.oc1..."
  subnetId: "ocid1.subnet.oc1.iad.aaaa..."
  shape: REDIS.CLUSTER.E4.FLEX.2
  nodeCount: 3

# -----------------------------------------------------------------------------
# Storage Configuration - Oracle Object Storage
# -----------------------------------------------------------------------------
storage:
  documentStore:
    enabled: true
    type: oci-object-storage
    namespace: your-namespace
    bucket: yawl-documents
  backup:
    enabled: true
    namespace: your-namespace
    bucket: yawl-backups

# OCI Object Storage Configuration
objectStorage:
  enabled: true
  namespace: your-namespace
  compartmentId: "ocid1.compartment.oc1..."
  redundancy: STANDARD

# -----------------------------------------------------------------------------
# Ingress Configuration - OCI Load Balancer
# -----------------------------------------------------------------------------
ingress:
  enabled: true
  className: oci-nginx
  annotations:
    kubernetes.io/ingress.class: nginx
    oci.oraclecloud.com/load-balancer-type: "lb"
    service.beta.kubernetes.io/oci-load-balancer-shape: "flexible"
    service.beta.kubernetes.io/oci-load-balancer-shape-flex-min: "10"
    service.beta.kubernetes.io/oci-load-balancer-shape-flex-max: "100"
    service.beta.kubernetes.io/oci-load-balancer-ssl-ports: "443"
    service.beta.kubernetes.io/oci-load-balancer-tls-secret: "yawl-tls-secret"
    service.beta.kubernetes.io/oci-load-balancer-health-check-retries: "3"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: yawl.your-domain.com
      paths: []
  tls:
    - secretName: yawl-tls-secret
      hosts:
        - yawl.your-domain.com

# OCI Load Balancer Configuration
loadBalancer:
  enabled: true
  name: yawl-lb
  shape: flexible
  minBandwidth: 10
  maxBandwidth: 100
  networkSecurityGroups:
    - "ocid1.networksecuritygroup.oc1.iad.aaaa..."

# -----------------------------------------------------------------------------
# Service Configuration with OKE-specific settings
# -----------------------------------------------------------------------------
services:
  engine:
    replicaCount: 3
    service:
      type: LoadBalancer
      annotations:
        service.beta.kubernetes.io/oci-load-balancer-internal: "false"
        service.beta.kubernetes.io/oci-load-balancer-subnet1: "ocid1.subnet.oc1.iad.aaaa..."
    resources:
      requests:
        cpu: 1000m
        memory: 2Gi
      limits:
        cpu: 4000m
        memory: 4Gi
    autoscaling:
      enabled: true
      minReplicas: 3
      maxReplicas: 15
      targetCPUUtilizationPercentage: 65
    nodeSelector:
      node_pool: yawl_core

  resourceService:
    replicaCount: 3
    service:
      type: ClusterIP
    resources:
      requests:
        cpu: 500m
        memory: 1Gi
      limits:
        cpu: 2000m
        memory: 2Gi
    autoscaling:
      maxReplicas: 10

  workletService:
    replicaCount: 2
    service:
      type: ClusterIP

  monitorService:
    service:
      type: ClusterIP

  costService:
    service:
      type: ClusterIP

  schedulingService:
    service:
      type: ClusterIP

  balancer:
    replicaCount: 3
    service:
      type: ClusterIP
    autoscaling:
      maxReplicas: 8

# -----------------------------------------------------------------------------
# Service Account with OCI IAM
# -----------------------------------------------------------------------------
serviceAccount:
  create: true
  annotations:
    oci.oraclecloud.com/compartment-id: "ocid1.compartment.oc1..."
    oci.oraclecloud.com/tenancy-id: "ocid1.tenancy.oc1..."
    oci.oraclecloud.com/region: "us-ashburn-1"
  labels:
    app.kubernetes.io/part-of: yawl

# -----------------------------------------------------------------------------
# Network Policy with OCI-specific rules
# -----------------------------------------------------------------------------
networkPolicy:
  enabled: true
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: kube-system
        - namespaceSelector:
            matchLabels:
              app: nginx-ingress
      ports:
        - protocol: TCP
          port: 8080
  egress:
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 5432  # OCI Database
        - protocol: TCP
          port: 6379  # OCI Cache
    # Allow access to OCI APIs
    - to:
        - ipBlock:
            cidr: 0.0.0.0/0
      ports:
        - protocol: TCP
          port: 443
    # OCI VCN internal
    - to:
        - ipBlock:
            cidr: 10.0.0.0/16
      ports:
        - protocol: TCP
          port: 5432
        - protocol: TCP
          port: 6379
    # DNS
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 53
        - protocol: UDP
          port: 53

# -----------------------------------------------------------------------------
# Node Selector for OKE
# -----------------------------------------------------------------------------
nodeSelector:
  node_pool: yawl_default

# -----------------------------------------------------------------------------
# Topology Spread for OCI Availability Domains
# -----------------------------------------------------------------------------
topologySpreadConstraints:
  - maxSkew: 1
    topologyKey: topology.kubernetes.io/zone
    whenUnsatisfiable: ScheduleAnyway
    labelSelector:
      matchLabels:
        app.kubernetes.io/part-of: yawl

# -----------------------------------------------------------------------------
# OKE-specific resources
# -----------------------------------------------------------------------------
extraDeploy: []

# -----------------------------------------------------------------------------
# OKE Cluster Settings
# -----------------------------------------------------------------------------
oke:
  clusterId: "ocid1.cluster.oc1.iad.aaaa..."
  compartmentId: "ocid1.compartment.oc1..."
  tenancyId: "ocid1.tenancy.oc1..."
  region: us-ashburn-1
  vcnId: "ocid1.vcn.oc1.iad.aaaa..."
  availabilityDomains:
    - "Uocm:PHX-AD-1"
    - "Uocm:PHX-AD-2"
    - "Uocm:PHX-AD-3"

# -----------------------------------------------------------------------------
# OCI Vault (Secrets)
# -----------------------------------------------------------------------------
vault:
  enabled: true
  vaultId: "ocid1.vault.oc1.iad.aaaa..."
  compartmentId: "ocid1.compartment.oc1..."
  secrets:
    database: "ocid1.secret.oc1.iad.aaaa..."
    redis: "ocid1.secret.oc1.iad.aaaa..."

# -----------------------------------------------------------------------------
# OCI Monitoring
# -----------------------------------------------------------------------------
monitoring:
  enabled: true
  compartmentId: "ocid1.compartment.oc1..."
  namespace: yawl_production
  alarms:
    enabled: true
    topicId: "ocid1.onstopic.oc1.iad.aaaa..."

# -----------------------------------------------------------------------------
# OCI WAF (Web Application Firewall)
# -----------------------------------------------------------------------------
waf:
  enabled: true
  compartmentId: "ocid1.compartment.oc1..."
  policyName: yawl-waf-policy

# -----------------------------------------------------------------------------
# OCI Security Lists
# -----------------------------------------------------------------------------
securityLists:
  ingress:
    - source: "0.0.0.0/0"
      protocol: "6"  # TCP
      tcpOptions:
        destinationPortRange:
          min: 443
          max: 443
    - source: "10.0.0.0/16"
      protocol: "6"
      tcpOptions:
        destinationPortRange:
          min: 8080
          max: 8080
