{{- if .Values.secrets.database.create }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "yawl.databaseSecretName" . }}
  namespace: {{ include "yawl.namespace" . }}
  labels:
    {{- include "yawl.labels" . | nindent 4 }}
    app.kubernetes.io/component: database-secret
type: Opaque
stringData:
  DATABASE_USER: {{ .Values.secrets.database.user | quote }}
  DATABASE_PASSWORD: {{ .Values.secrets.database.password | quote }}
  DATABASE_URL: {{ include "yawl.databaseUrl" . | quote }}
{{- end }}
---
{{- if .Values.secrets.apiKeys.create }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "yawl.apiKeysSecretName" . }}
  namespace: {{ include "yawl.namespace" . }}
  labels:
    {{- include "yawl.labels" . | nindent 4 }}
    app.kubernetes.io/component: api-keys
type: Opaque
stringData:
  ENGINE_API_KEY: {{ .Values.secrets.apiKeys.engineApiKey | default (randAlphaNum 32) | quote }}
  RESOURCE_SERVICE_KEY: {{ .Values.secrets.apiKeys.resourceServiceKey | default (randAlphaNum 32) | quote }}
  WORKLET_SERVICE_KEY: {{ .Values.secrets.apiKeys.workletServiceKey | default (randAlphaNum 32) | quote }}
{{- end }}
---
{{- if and .Values.ingress.tls (not (index .Values.ingress.tls 0).secretName) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "yawl.fullname" . }}-tls-secret
  namespace: {{ include "yawl.namespace" . }}
  labels:
    {{- include "yawl.labels" . | nindent 4 }}
    app.kubernetes.io/component: ssl-certs
type: kubernetes.io/tls
stringData:
  tls.crt: |
    -----BEGIN CERTIFICATE-----
    MIICljCCAX4CCQCKz8mPbP6aDTANBgkqhkiG9w0BAQsFADANMQswCQYDVQQDDAJj
    YTAgFw0yNDAxMDEwMDAwMDBaGA9OQUwxMjMxMjMxMjMxMjMxWjANMQswCQYDVQQD
    DAJjYTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALLhZzKzL3LrVxdM
    NxM6rHvNLmF6nFGqJCQJ2j8x6kKLBhd5w6pGlpPNqGs5qGhqENI3Jl8hKNpVdX7a
    F9pZWJ8Yp4vQeF4yMQz9K5n7EF5f5vQy6F8nRgF7q4C2p0LbJGqJEpD6L8u7vEhB
    -----END CERTIFICATE-----
  tls.key: |
    -----BEGIN PRIVATE KEY-----
    MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQC65WydVnL3KxHd
    F8xM6rHvNLmF6nFGqJCQJ2j8x6kKLBhd5w6pGlpPNqGs5qGhqENI3Jl8hKNpVdX7
    -----END PRIVATE KEY-----
{{- end }}
---
{{- if .Values.redis.enabled }}
{{- if and .Values.redis.auth.enabled (not .Values.externalRedis.existingSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "yawl.fullname" . }}-redis-credentials
  namespace: {{ include "yawl.namespace" . }}
  labels:
    {{- include "yawl.labels" . | nindent 4 }}
    app.kubernetes.io/component: redis-secret
type: Opaque
stringData:
  password: {{ .Values.redis.auth.password | quote }}
{{- end }}
{{- end }}
