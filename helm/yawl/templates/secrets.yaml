{{- if .Values.secrets.database.create }}
{{- if not .Values.externalDatabase.existingSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "yawl.databaseSecretName" . }}
  namespace: {{ include "yawl.namespace" . }}
  labels:
    {{- include "yawl.labels" . | nindent 4 }}
    app.kubernetes.io/component: database-secret
type: Opaque
stringData:
  DATABASE_USER: {{ .Values.secrets.database.user | quote }}
  DATABASE_PASSWORD: {{ .Values.secrets.database.password | quote }}
  DB_PASSWORD: {{ .Values.secrets.database.password | quote }}
  SPRING_DATASOURCE_USERNAME: {{ .Values.secrets.database.user | quote }}
  SPRING_DATASOURCE_PASSWORD: {{ .Values.secrets.database.password | quote }}
{{- end }}
{{- end }}
---
{{- if .Values.secrets.apiKeys.create }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "yawl.apiKeysSecretName" . }}
  namespace: {{ include "yawl.namespace" . }}
  labels:
    {{- include "yawl.labels" . | nindent 4 }}
    app.kubernetes.io/component: api-keys
type: Opaque
stringData:
  ENGINE_API_KEY: {{ .Values.secrets.apiKeys.engineApiKey | default (randAlphaNum 32) | quote }}
{{- end }}
---
{{- if .Values.secrets.encryptionKey.create }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "yawl.encryptionKeySecretName" . }}
  namespace: {{ include "yawl.namespace" . }}
  labels:
    {{- include "yawl.labels" . | nindent 4 }}
    app.kubernetes.io/component: encryption-key
type: Opaque
stringData:
  ENCRYPTION_KEY: {{ .Values.secrets.encryptionKey.key | default (randAlphaNum 64) | quote }}
{{- end }}
---
{{- if .Values.redis.enabled }}
{{- if and .Values.redis.auth.enabled (not .Values.externalRedis.existingSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "yawl.fullname" . }}-redis-credentials
  namespace: {{ include "yawl.namespace" . }}
  labels:
    {{- include "yawl.labels" . | nindent 4 }}
    app.kubernetes.io/component: redis-secret
type: Opaque
stringData:
  password: {{ .Values.redis.auth.password | quote }}
{{- end }}
{{- end }}
