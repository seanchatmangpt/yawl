apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "yawl.fullname" . }}-config
  namespace: {{ include "yawl.namespace" . }}
  labels:
    {{- include "yawl.labels" . | nindent 4 }}
    app.kubernetes.io/component: config
data:
  # Database configuration
  DATABASE_TYPE: "postgres"
  DATABASE_PATH: {{ include "yawl.databaseName" . | quote }}
  DATABASE_HOST: {{ include "yawl.databaseHost" . | quote }}
  DATABASE_PORT: {{ include "yawl.databasePort" . | quote }}
  DATABASE_URL: {{ include "yawl.databaseUrl" . | quote }}

  # Redis configuration
  REDIS_HOST: {{ include "yawl.redisHost" . | quote }}
  REDIS_PORT: {{ include "yawl.redisPort" . | quote }}

  # Spring Boot configuration
  SPRING_PROFILES_ACTIVE: {{ .Values.spring.profilesActive | quote }}
  SPRING_APPLICATION_NAME: {{ .Values.spring.application.name | quote }}

  # Actuator configuration
  MANAGEMENT_HEALTH_PROBES_ENABLED: {{ .Values.actuator.health.probes.enabled | quote }}
  MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS: {{ .Values.actuator.health.showDetails | quote }}
  MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE: {{ .Values.actuator.endpoints.web.exposure.include | quote }}

  # OpenTelemetry configuration
  {{- if .Values.opentelemetry.enabled }}
  OTEL_SERVICE_NAME: {{ .Values.opentelemetry.serviceName | quote }}
  OTEL_TRACES_EXPORTER: {{ .Values.opentelemetry.tracesExporter | quote }}
  OTEL_METRICS_EXPORTER: {{ .Values.opentelemetry.metricsExporter | quote }}
  OTEL_LOGS_EXPORTER: {{ .Values.opentelemetry.logsExporter | quote }}
  OTEL_EXPORTER_OTLP_ENDPOINT: {{ .Values.opentelemetry.exporter.otlp.endpoint | quote }}
  {{- end }}

  # Logging configuration
  LOGGING_LEVEL_ROOT: {{ .Values.logging.level.root | quote }}
  LOGGING_LEVEL_ORG_YAWLFOUNDATION: {{ .Values.logging.level.yawlfoundation | quote }}
  LOGGING_LEVEL_ORG_HIBERNATE: {{ .Values.logging.level.hibernate | quote }}
  LOGGING_LEVEL_ORG_SPRINGFRAMEWORK: {{ .Values.logging.level.springframework | quote }}
  LOGGING_FORMAT: {{ .Values.logging.format | quote }}
  LOGGING_FILE_PATH: {{ .Values.logging.file.path | quote }}
  LOGGING_FILE_NAME: {{ .Values.logging.file.name | quote }}

  # YAWL version
  YAWL_VERSION: {{ .Values.yawlVersion | quote }}
  YAWL_BUILD_NUMBER: {{ .Values.buildNumber | quote }}

  # Cloud provider
  CLOUD_PROVIDER: {{ .Values.cloudProvider | default "" | quote }}

  # JVM options
  JAVA_OPTS: {{ include "yawl.jvmOpts" . | quote }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "yawl.fullname" . }}-hibernate-config
  namespace: {{ include "yawl.namespace" . }}
  labels:
    {{- include "yawl.labels" . | nindent 4 }}
    app.kubernetes.io/component: hibernate-config
data:
  # Hibernate configuration for PostgreSQL
  hibernate.dialect: "org.hibernate.dialect.PostgreSQLDialect"
  hibernate.show_sql: "false"
  hibernate.hbm2ddl.auto: "update"
  hibernate.cache.use_second_level_cache: "true"
  hibernate.cache.use_query_cache: "true"
  hibernate.jdbc.batch_size: "20"
  hibernate.order_inserts: "true"
  hibernate.order_updates: "true"
  hibernate.generate_statistics: "false"

  # HikariCP connection pool settings
  hibernate.connection.provider_class: "org.hibernate.hikaricp.internal.HikariCPConnectionProvider"
  hibernate.hikari.minimumIdle: "5"
  hibernate.hikari.maximumPoolSize: "20"
  hibernate.hikari.idleTimeout: "300000"
  hibernate.hikari.connectionTimeout: "30000"
  hibernate.hikari.maxLifetime: "1800000"
  hibernate.hikari.leakDetectionThreshold: "60000"
