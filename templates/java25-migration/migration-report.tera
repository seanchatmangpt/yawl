{# ============================================================================
   migration-report.tera
   Renders the human-readable migration report from the MigrationPlan.

   Variables:
     - plan: the MigrationPlan resource with all migration instances
     - codebase_path: root path of the codebase being migrated
     - generated_at: ISO 8601 timestamp
     - total_files: number of Java files analyzed
     - migrations: list of {file, line, rule, complexity, snippet, rendered, requires_review}
     - summary: {total, automatic, requires_review, low, medium, high, by_file}
   ============================================================================ #}

# Java 11 â†’ 25 Migration Report

**Codebase**: `{{ codebase_path }}`
**Generated**: {{ generated_at }}
**Files Analyzed**: {{ total_files }}

---

## Summary

| Category | Count |
|----------|-------|
| Total migration opportunities | {{ summary.total }} |
| Auto-applicable (no review needed) | {{ summary.automatic }} |
| Requires human review | {{ summary.requires_review }} |
| LOW complexity | {{ summary.low }} |
| MEDIUM complexity | {{ summary.medium }} |
| HIGH complexity | {{ summary.high }} |

---

## Migrations by Complexity

### LOW Complexity (Apply First)

These migrations are mechanical, reversible, and safe to apply automatically.

{% for m in migrations | filter(attribute="complexity", value="LOW") | sort(attribute="file") %}
#### `{{ m.file }}` line {{ m.line }} â€” {{ m.rule }}

```java
// BEFORE (Java 11):
{{ m.snippet }}

// AFTER (Java 25):
{{ m.rendered }}
```

{% if m.requires_review %}
> âš ï¸  **Review requested**: {{ m.review_note }}
{% endif %}

---
{% endfor %}

### MEDIUM Complexity (Review Recommended)

These migrations involve behavior changes that should be validated with tests.

{% for m in migrations | filter(attribute="complexity", value="MEDIUM") | sort(attribute="file") %}
#### `{{ m.file }}` line {{ m.line }} â€” {{ m.rule }}

```java
// BEFORE (Java 11):
{{ m.snippet }}

// AFTER (Java 25):
{{ m.rendered }}
```

> ðŸ“‹ **Review note**: {{ m.review_note | default(value="Validate equivalent behavior with existing tests.") }}

---
{% endfor %}

### HIGH Complexity (Manual Review Required)

These migrations require deep understanding of the original code's semantics.
**Do not apply automatically.**

{% for m in migrations | filter(attribute="complexity", value="HIGH") | sort(attribute="file") %}
#### `{{ m.file }}` line {{ m.line }} â€” {{ m.rule }}

```java
// BEFORE (Java 11):
{{ m.snippet }}

// PROPOSED REPLACEMENT (Java 25) â€” REQUIRES MANUAL REVIEW:
{{ m.rendered }}
```

> â›” **High complexity**: {{ m.review_note }}

---
{% endfor %}

---

## Files with Most Migrations

| File | Migrations |
|------|-----------|
{% for entry in summary.by_file | sort(attribute="count", reverse=true) | slice(end=10) %}
| `{{ entry.file }}` | {{ entry.count }} |
{% endfor %}

---

## Migration Rules Applied

| Rule ID | Description | Count |
|---------|-------------|-------|
{% for rule in migrations | unique(attribute="rule") %}
| {{ rule.rule }} | {{ rule.rule_description }} | {{ migrations | filter(attribute="rule", value=rule.rule) | length }} |
{% endfor %}

---

## Next Steps

1. **Apply LOW complexity migrations**: `bash scripts/migration/apply-low-complexity.sh`
2. **Run tests**: `bash scripts/dx.sh all`
3. **Review MEDIUM complexity**: Check each migration in `migration-review/`
4. **Schedule HIGH complexity**: Assign to engineers for manual implementation
5. **Validate soundness**: For engine changes, run YAWL soundness test suite

*Generated by YAWL Java Migration Pipeline v1.0 â€” ontology-driven, SPARQL CONSTRUCT powered.*
