{#
 YAWL Decompositions Template
 Generates <decomposition> elements for task definitions, including composite tasks
 and web service gateway specifications.

 Context Variables (from ggen):
   - decompositions: Array of decomposition rows {?decompId, ?decompName, ?type, ?isRootNet, ?documentation}
   - tasks: Array of task definitions from main workflow
   - variables: Array of local variables in parent net

 Pattern:
   Each task that has a decomposesTo reference generates a corresponding decomposition.
   Simple tasks map to WebServiceGatewayFactsType (manual execution).
   Composite tasks map to NetFactsType (nested workflow nets).
#}
{% set processed_decomps = [] %}
{% for task in tasks %}
  {% set decomp_id = task.get('?decomposesTo') or task.get('decomposesTo') or task.get('?taskId') or task.get('taskId') %}
  {% if decomp_id not in processed_decomps %}
    {% set _ = processed_decomps.append(decomp_id) %}

    {# Simple Task Decomposition (WebServiceGatewayFactsType) #}
    <decomposition id="{{ decomp_id }}" xsi:type="WebServiceGatewayFactsType">
      {% if task.get('?taskName') or task.get('taskName') %}
      <name>{{ task.get('?taskName') or task.get('taskName') }}</name>
      {% endif %}

      {# Input Parameters (from task's incoming data mappings) #}
      {% set param_index = 0 %}
      {% for variable in (variables or []) %}
      <inputParam>
        <index>{{ param_index }}</index>
        <name>{{ variable.get('?varName') or variable.get('varName') }}</name>
        <type>{{ variable.get('?varType') or variable.get('varType') or "string" }}</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </inputParam>
      {% set param_index = param_index + 1 %}
      {% endfor %}

      {# Output Parameters (from task's outgoing data mappings) #}
      {% set out_param_index = 0 %}
      {% for variable in (variables or []) %}
      <outputParam>
        <index>{{ out_param_index }}</index>
        <name>{{ variable.get('?varName') or variable.get('varName') }}</name>
        <type>{{ variable.get('?varType') or variable.get('varType') or "string" }}</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </outputParam>
      {% set out_param_index = out_param_index + 1 %}
      {% endfor %}

      {# External Interaction Mode #}
      <externalInteraction>manual</externalInteraction>
    </decomposition>

  {% endif %}
{% endfor %}

{# Alternative: Composite Task Decomposition Pattern (for multi-instance or nested nets) #}
{# This is commented as a reference for future enhancement when composite tasks are needed #}
