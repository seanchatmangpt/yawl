{#
 YAWL Data Bindings and XSD Variable Definitions Template
 Generates XSD type definitions for workflow variables and data constraints.

 Context Variables (from SPARQL query or ggen context):
   - variables: Array of variable definitions {?varName, ?varType, ?minOccurs, ?maxOccurs, ?pattern, ?minLength, ?maxLength, ?documentation}
   - types: Array of custom type definitions {?typeName, ?baseType, ?elements, ?restrictions, ?documentation}
   - targetNamespace: XML target namespace (default: http://www.w3.org/2001/XMLSchema)
   - elementFormDefault: Form for element declarations (qualified|unqualified, default: qualified)

 Pattern:
   1. Root <xs:schema> element with namespace and imports
   2. Custom type definitions (complexType, simpleType)
   3. Global element declarations for workflow variables
   4. Constraint restrictions (length, pattern, enumeration, range)
   5. Documentation and annotations for each type

 Output:
   Generates <xs:schema> block suitable for embedding in YAWL specification
#}
{# Main schema wrapper - this template generates the xs:schema contents #}
{% set targetNamespace = targetNamespace | default(value="http://www.yawlfoundation.org/workflow") %}
{% set elementFormDefault = elementFormDefault | default(value="qualified") %}

{# ============================================================================= #}
{# SECTION 1: Custom Type Definitions #}
{# ============================================================================= #}
{% for customType in types | default(value=[]) %}

  {# Complex Types (for structured data) #}
  {% if customType['?typeCategory'] == 'complex' or not customType['?typeCategory'] %}
  <xs:complexType name="{{ customType['?typeName'] | default(value=customType.typeName) }}">
    {% if customType['?documentation'] %}
    <xs:annotation>
      <xs:documentation>{{ customType['?documentation'] | default(value=customType.documentation) }}</xs:documentation>
    </xs:annotation>
    {% endif %}

    {# Determine composition style (sequence vs choice) #}
    {% if customType['?compositionStyle'] == 'choice' %}
    <xs:choice>
    {% else %}
    <xs:sequence>
    {% endif %}

      {# Elements within the complex type #}
      {% for element in customType['?elements'] | default(value=[]) %}
      <xs:element name="{{ element['?elementName'] | default(value=element.elementName) }}"
                   type="{{ element['?elementType'] | default(value=element.elementType) | default(value="xs:string") }}"
                   minOccurs="{{ element['?minOccurs'] | default(value=element.minOccurs) | default(value="0") }}"
                   maxOccurs="{{ element['?maxOccurs'] | default(value=element.maxOccurs) | default(value="1") }}">
        {% if element['?documentation'] %}
        <xs:annotation>
          <xs:documentation>{{ element['?documentation'] | default(value=element.documentation) }}</xs:documentation>
        </xs:annotation>
        {% endif %}
      </xs:element>
      {% endfor %}

    {% if customType['?compositionStyle'] == 'choice' %}
    </xs:choice>
    {% else %}
    </xs:sequence>
    {% endif %}
  </xs:complexType>

  {% endif %}

  {# Simple Types with Restrictions (for scalar data with constraints) #}
  {% if customType['?typeCategory'] == 'simple' %}
  <xs:simpleType name="{{ customType['?typeName'] | default(value=customType.typeName) }}">
    {% if customType['?documentation'] %}
    <xs:annotation>
      <xs:documentation>{{ customType['?documentation'] | default(value=customType.documentation) }}</xs:documentation>
    </xs:annotation>
    {% endif %}

    {# Base type restriction #}
    <xs:restriction base="{{ customType['?baseType'] | default(value=customType.baseType) | default(value="xs:string") }}">

      {# Length restrictions #}
      {% if customType['?minLength'] %}
      <xs:minLength value="{{ customType['?minLength'] | default(value=customType.minLength) }}" />
      {% endif %}
      {% if customType['?maxLength'] %}
      <xs:maxLength value="{{ customType['?maxLength'] | default(value=customType.maxLength) }}" />
      {% endif %}

      {# Pattern restrictions (regex) #}
      {% if customType['?pattern'] %}
      <xs:pattern value="{{ customType['?pattern'] | default(value=customType.pattern) }}" />
      {% endif %}

      {# Numeric range restrictions #}
      {% if customType['?minInclusive'] %}
      <xs:minInclusive value="{{ customType['?minInclusive'] | default(value=customType.minInclusive) }}" />
      {% endif %}
      {% if customType['?maxInclusive'] %}
      <xs:maxInclusive value="{{ customType['?maxInclusive'] | default(value=customType.maxInclusive) }}" />
      {% endif %}
      {% if customType['?minExclusive'] %}
      <xs:minExclusive value="{{ customType['?minExclusive'] | default(value=customType.minExclusive) }}" />
      {% endif %}
      {% if customType['?maxExclusive'] %}
      <xs:maxExclusive value="{{ customType['?maxExclusive'] | default(value=customType.maxExclusive) }}" />
      {% endif %}

      {# Enumeration constraints (fixed set of values) #}
      {% for enumValue in customType['?enumValues'] | default(value=[]) %}
      <xs:enumeration value="{{ enumValue['?value'] | default(value=enumValue.value) }}">
        {% if enumValue['?documentation'] %}
        <xs:annotation>
          <xs:documentation>{{ enumValue['?documentation'] | default(value=enumValue.documentation) }}</xs:documentation>
        </xs:annotation>
        {% endif %}
      </xs:enumeration>
      {% endfor %}

    </xs:restriction>
  </xs:simpleType>

  {% endif %}

{% endfor %}

{# ============================================================================= #}
{# SECTION 2: Global Element Declarations for Workflow Variables #}
{# ============================================================================= #}
{% for variable in variables | default(value=[]) %}
<xs:element name="{{ variable['?varName'] | default(value=variable.varName) }}"
             type="{{ variable['?varType'] | default(value=variable.varType) | default(value="xs:string") }}"
             minOccurs="{{ variable['?minOccurs'] | default(value=variable.minOccurs) | default(value="0") }}"
             maxOccurs="{{ variable['?maxOccurs'] | default(value=variable.maxOccurs) | default(value="1") }}">
  {% if variable['?documentation'] %}
  <xs:annotation>
    <xs:documentation>{{ variable['?documentation'] | default(value=variable.documentation) }}</xs:documentation>
  </xs:annotation>
  {% endif %}
</xs:element>

{% endfor %}

{# ============================================================================= #}
{# SECTION 3: Built-in Type Extensions (for common workflow data) #}
{# ============================================================================= #}

{# Standard workflow data type definitions #}
<xs:simpleType name="YTaskStatus">
  <xs:annotation>
    <xs:documentation>Standard YAWL task execution status enumeration</xs:documentation>
  </xs:annotation>
  <xs:restriction base="xs:string">
    <xs:enumeration value="Enabled" />
    <xs:enumeration value="Executing" />
    <xs:enumeration value="Fired" />
    <xs:enumeration value="Suspended" />
  </xs:restriction>
</xs:simpleType>

<xs:simpleType name="YCaseStatus">
  <xs:annotation>
    <xs:documentation>Standard YAWL case lifecycle status</xs:documentation>
  </xs:annotation>
  <xs:restriction base="xs:string">
    <xs:enumeration value="Created" />
    <xs:enumeration value="Executing" />
    <xs:enumeration value="Completed" />
    <xs:enumeration value="Cancelled" />
  </xs:restriction>
</xs:simpleType>

<xs:complexType name="YCaseData">
  <xs:annotation>
    <xs:documentation>Standard workflow case context data structure</xs:documentation>
  </xs:annotation>
  <xs:sequence>
    <xs:element name="caseID" type="xs:string" />
    <xs:element name="caseStatus" type="YCaseStatus" />
    <xs:element name="createdAt" type="xs:dateTime" />
    <xs:element name="completedAt" type="xs:dateTime" minOccurs="0" />
  </xs:sequence>
</xs:complexType>

<xs:complexType name="YWorkItemData">
  <xs:annotation>
    <xs:documentation>Standard workflow work item (task instance) data</xs:documentation>
  </xs:annotation>
  <xs:sequence>
    <xs:element name="workItemID" type="xs:string" />
    <xs:element name="caseID" type="xs:string" />
    <xs:element name="taskID" type="xs:string" />
    <xs:element name="status" type="YTaskStatus" />
    <xs:element name="createdAt" type="xs:dateTime" />
    <xs:element name="startedAt" type="xs:dateTime" minOccurs="0" />
    <xs:element name="completedAt" type="xs:dateTime" minOccurs="0" />
  </xs:sequence>
</xs:complexType>

{# ============================================================================= #}
{# SECTION 4: Assertion Constraints (XSD 1.1 feature for complex validations) #}
{# ============================================================================= #}
{% for assertion in assertions | default(value=[]) %}
<xs:assert test="{{ assertion['?test'] | default(value=assertion.test) }}" />
{% endfor %}
