# Fluent Bit Parsers for YAWL Workflow Engine

# Java multiline stack traces
[MULTILINE_PARSER]
    Name          java_multiline
    Type          regex
    Flush_Timeout 1000
    Rule          "start_state" "/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\.\d{3}/" "cont"
    Rule          "cont" "/^(?:(?!\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\.\d{3}).)*$/" "cont"

# Log4j2 JSON format
[PARSER]
    Name        log4j2_json
    Format      json
    Time_Key    instant
    Time_Format %Y-%m-%dT%H:%M:%S.%LZ
    Time_Keep   On

# Standard Java log format
[PARSER]
    Name        java_standard
    Format      regex
    Regex       ^(?<time>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\.\d{3})\s+(?<level>\w+)\s+\[(?<thread>[^\]]+)\]\s+(?<class>[^\s]+)\s+-\s+(?<message>.*)$
    Time_Key    time
    Time_Format %Y-%m-%d %H:%M:%S.%L

# YAWL case ID extraction
[PARSER]
    Name        yawl_case_id
    Format      regex
    Regex       ^.*case[_-]?id[=:\s]+["']?(?<case_id>[a-zA-Z0-9_-]+)["']?.*$

# YAWL task ID extraction
[PARSER]
    Name        yawl_task_id
    Format      regex
    Regex       ^.*task[_-]?id[=:\s]+["']?(?<task_id>[a-zA-Z0-9_-]+)["']?.*$

# Docker JSON logs
[PARSER]
    Name        docker
    Format      json
    Time_Key    time
    Time_Format %Y-%m-%dT%H:%M:%S.%LZ
    Time_Keep   On
    Decode_Field_As   json    log     log_escape_utf8

# Syslog RFC 5424
[PARSER]
    Name        syslog-rfc5424
    Format      regex
    Regex       ^\<(?<pri>[0-9]{1,5})\>1 (?<time>\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d+)(?<tz>[+-]\d{2}:\d{2})? (?<host>\S+) (?<app>\S+) (?<pid>\S+) (?<msgid>\S+) (?<sd>(?:\[.*?\])*) (?<message>.*)$
    Time_Key    time
    Time_Format %Y-%m-%dT%H:%M:%S.%L%z

# Syslog RFC 3164
[PARSER]
    Name        syslog-rfc3164
    Format      regex
    Regex       ^\<(?<pri>[0-9]+)\>(?<time>... \d{1,2} \d{2}:\d{2}:\d{2}) (?<host>\S+) (?<ident>[^:]+): (?<message>.*)$
    Time_Key    time
    Time_Format %b %d %H:%M:%S

# Apache common log format
[PARSER]
    Name        apache_common
    Format      regex
    Regex       ^(?<host>[^ ]*) [^ ]* (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^\"]*?)(?: +\S*)?)?" (?<code>[^ ]*) (?<size>[^ ]*)$
    Time_Key    time
    Time_Format %d/%b/%Y:%H:%M:%S %z

# JSON generic parser
[PARSER]
    Name        json
    Format      json

# Nginx error log
[PARSER]
    Name        nginx_error
    Format      regex
    Regex       ^(?<time>\d{4}/\d{2}/\d{2} \d{2}:\d{2}:\d{2}) \[(?<level>\w+)\] (?<pid>\d+).(?<tid>\d+): (?<message>.*)$
    Time_Key    time
    Time_Format %Y/%m/%d %H:%M:%S

# PostgreSQL log format
[PARSER]
    Name        postgres
    Format      regex
    Regex       ^(?<time>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\.\d+ [A-Z]+) \[(?<pid>\d+)\] (?<level>\w+):\s+(?<message>.*)$
    Time_Key    time
    Time_Format %Y-%m-%d %H:%M:%S.%L %Z

# MySQL error log
[PARSER]
    Name        mysql_error
    Format      regex
    Regex       ^(?<time>\d{6} \d{2}:\d{2}:\d{2}) (?<pid>\d+) \[(?<level>\w+)\] (?<message>.*)$
    Time_Key    time
    Time_Format %y%m%d %H:%M:%S
