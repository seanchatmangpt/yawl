# Java 25 Setup Verification Prompt

Use this prompt in your next Claude Code session to verify the Java 25 and Maven proxy setup is working correctly.

---

## Next Session Verification Prompt

```
Please verify the Java 25 and Maven proxy setup is working correctly by running through these checks:

1. **SessionStart Hook Execution**
   - Check that the SessionStart hook ran on session start
   - Look for output mentioning "YAWL environment ready for Claude Code Web"
   - Verify Java 25 detection message

2. **Java 25 Verification**
   - Run: java -version
   - Run: javac -version
   - Confirm both report version 25.x.x

3. **Maven Proxy Detection**
   - Check if https_proxy environment variable is set
   - Run: echo $https_proxy
   - If proxy detected, verify SessionStart output mentions "Local Maven proxy started"

4. **Maven Proxy Status** (if proxy detected)
   - Check proxy is running: ps aux | grep maven-proxy | grep -v grep
   - Should show python3 process running maven-proxy-v2.py or maven-proxy.py
   - Port 3128 should be listening: netstat -tlnp 2>/dev/null | grep 3128

5. **Maven Settings Verification**
   - Check: cat ~/.m2/settings.xml
   - Should contain proxy configuration for 127.0.0.1:3128 if proxy was detected
   - Should have both http and https proxy entries

6. **Maven Command Test**
   - Try quick Maven version check: mvn -version
   - Should succeed without repository access
   - Look for Java 25 in output (--enable-preview flag)

7. **Build Test (if ready)**
   - Run: bash scripts/dx.sh compile -T 1
   - If proxy was started, should download artifacts through proxy
   - If no proxy, may fail with DNS error (expected in offline mode)
   - Monitor proxy logs: tail /tmp/maven-proxy.log

8. **Environment Summary Check**
   - Look for "Environment Summary" section from SessionStart output
   - Should show either:
     * "Network: Egress proxy (local proxy bridge: 127.0.0.1:3128)" OR
     * "Network: Direct repository access"
   - Confirm all other settings (Java version, Maven cache location, etc.)

9. **Proxy Log Verification** (if proxy was started)
   - Check: tail -100 /tmp/maven-proxy.log
   - Should show proxy startup messages
   - Should show connection attempts from Maven if build ran
   - Look for "CONNECT succeeded" messages if build executed

10. **Cleanup Check**
    - If proxy was started, note the tip: pkill -f maven-proxy
    - This can be used to stop proxy if needed

## Expected Results by Environment

### Claude Code Web (Remote) with Egress Proxy
✅ Java 25 detected
✅ Egress proxy detected (https_proxy env var set)
✅ Local Maven proxy started on 127.0.0.1:3128
✅ Maven settings.xml auto-configured
✅ Network bridge operational
⚠️ First build may be slow (downloading plugins)

### Claude Code Web (Remote) without Egress Proxy
✅ Java 25 detected
✅ No proxy detected (expected)
✅ Direct Maven repository access enabled
✅ Standard Maven build workflow

### Local Environment (should not run proxy setup)
✅ Java 25 detected
✅ No proxy startup (CLAUDE_CODE_REMOTE not set)
✅ Standard Maven build workflow

## Troubleshooting Guide

**If SessionStart didn't run:**
- SessionStart only runs in Claude Code Web when CLAUDE_CODE_REMOTE=true
- Check: echo $CLAUDE_CODE_REMOTE
- Local development doesn't trigger SessionStart

**If proxy didn't start:**
- Check maven-proxy-v2.py exists: ls -la maven-proxy-v2.py
- Check Python 3 available: python3 --version
- Check proxy logs: cat /tmp/maven-proxy.log
- Try manual startup: python3 maven-proxy-v2.py

**If Maven build still fails with DNS error:**
- This indicates proxy isn't being used correctly
- Try: mvn -X clean compile 2>&1 | grep -i proxy
- Check Maven settings.xml is valid
- Verify proxy is actually running on 127.0.0.1:3128

**If Maven can't find plugins:**
- First build may need to download ~500MB of artifacts
- This goes through the proxy chain (slow due to JWT auth)
- Subsequent builds use cache (~/.m2/repository)
- Run: du -sh ~/.m2/repository to check cache size

## Files to Verify

After SessionStart, these files should exist/be modified:

| File | Status | Notes |
|------|--------|-------|
| `maven-proxy-v2.py` | Should exist | Primary proxy script |
| `maven-proxy.py` | Should exist | Fallback proxy script |
| `~/.m2/settings.xml` | Created if proxy enabled | Auto-generated by hook |
| `/tmp/maven-proxy.log` | Created if proxy started | Proxy debug log |
| `.claude/hooks/session-start.sh` | Reference | Auto-runs on session start |
| `CLAUDE.md` | Reference | Documents Λ.net section |
| `JAVA25-SETUP.md` | Reference | Detailed setup guide |

## Quick Status Command

Run this one-liner to get a status snapshot:

```bash
echo "=== Java ===" && java -version 2>&1 | head -1 && \
echo "=== Maven ===" && mvn -version | head -1 && \
echo "=== Proxy ===" && ps aux | grep maven-proxy | grep -v grep || echo "No proxy running" && \
echo "=== Settings ===" && grep -A1 "<host>" ~/.m2/settings.xml 2>/dev/null || echo "No proxy settings" && \
echo "=== HTTPS Proxy Env ===" && echo "${https_proxy:-Not set}"
```

## Next Steps After Verification

If everything checks out:
- Run: bash scripts/dx.sh all (full build validation)
- Monitor: tail -f /tmp/maven-proxy.log (watch proxy activity)
- Build: mvn -T 1.5C clean compile (fast incremental compile)

If issues found:
- Review the Troubleshooting Guide above
- Check JAVA25-SETUP.md for detailed diagnostics
- Refer to CLAUDE.md Λ.net section for architecture details

---

## Quick Verdict Checklist

- [ ] Java version is 25.x.x
- [ ] Maven is available (mvn -version works)
- [ ] If CLAUDE_CODE_REMOTE=true and https_proxy set: proxy process is running
- [ ] ~/.m2/settings.xml exists with correct proxy config (or direct access if no proxy)
- [ ] SessionStart output shows "YAWL environment ready for Claude Code Web"
- [ ] All critical environment variables properly set

✅ **If all checked**: Setup is working! Ready for Java 25 builds
⚠️ **If any unchecked**: Review Troubleshooting Guide or JAVA25-SETUP.md
