# YAWL Conservative Load Stress Test Configuration
# Version: 6.0.0
# Last Updated: 2026-02-28

# ====================================================================
# Test Duration & Load Profile
# ====================================================================

# Total test duration in hours (conservative: 4 hours)
# For production: set to 24
soak.duration.hours=4

# Case creation rate (Poisson lambda) - cases per second
# Conservative: 500, Standard: 1000, Aggressive: 2000
soak.rate.cases.per.second=500

# Task execution rate - tasks per second
# Calculated as cases * avg_tasks_per_case * task_completion_ratio
soak.rate.tasks.per.second=2500

# Load profile: POISSON (realistic variable arrivals) or CONSTANT
soak.load.profile=POISSON

# ====================================================================
# Metrics Collection & Monitoring
# ====================================================================

# Metrics sampling interval in minutes
# 2 min interval = ~120 samples over 4 hours
soak.metrics.sample.interval.min=2

# Latency sampling interval in number of cases
# Every 10K cases, capture latency percentiles
soak.latency.sample.every.cases=10000

# Breaking point detection: percentage drop in throughput
# 30% = significant cliff, worth investigating
soak.throughput.cliff.percent=30.0

# ====================================================================
# JVM Performance Thresholds
# ====================================================================

# GC pause warning threshold in milliseconds
# ZGC target: <10ms, warning: >100ms, critical: >500ms
soak.gc.pause.warning.ms=100

# Heap growth warning threshold in MB per hour
# Baseline: ~50-100 MB/hour, Warning: >500 MB/hour = potential leak
soak.heap.warning.threshold.mb=500

# Thread count warning threshold
# Virtual threads should be pooled; >10000 active = explosion
soak.thread.count.warning=10000

# Latency p99 warning threshold in milliseconds
soak.latency.p99.warning.ms=1000

# ====================================================================
# Test Assertions (Hard Failure Criteria)
# ====================================================================

# Minimum throughput to achieve (cases/sec)
# 90% of target rate = 450 cases/sec (allows for POISSON variance)
soak.min.throughput.cases.per.sec=450

# Maximum heap growth per hour (MB)
# Strict limit to detect unbounded leaks
soak.max.heap.growth.per.hour.mb=500

# Maximum GC pause p99 (milliseconds)
soak.max.gc.pause.p99.ms=100

# Maximum active threads at end of test
soak.max.final.thread.count=10000

# ====================================================================
# Output Configuration
# ====================================================================

# Directory for test outputs (relative to cwd)
soak.output.dir=./soak-test-results

# Prefix for output files
soak.output.prefix=conservative-4h

# Emit metrics to JSONL file
soak.metrics.output.file=metrics-${timestamp}.jsonl

# Emit latency percentiles to JSON
soak.latency.output.file=latency-percentiles-${timestamp}.json

# Emit breaking point analysis if detected
soak.breaking.point.output.file=breaking-point-analysis-${timestamp}.json

# ====================================================================
# Test Specification & Workload Mix
# ====================================================================

# Workload specification complexity (simple, standard, complex)
# simple: single task per case, minimal data
# standard: 3-5 tasks, moderate data, some loops
# complex: 10+ tasks, heavy data, many branches
soak.specification.complexity=standard

# Workflow pattern mix (SEQUENTIAL=1.0, PARALLEL=0.0 for pure sequential)
# 0.5 = 50% sequential patterns, 50% parallel patterns
soak.workflow.pattern.parallel.ratio=0.5

# Workload event distribution
# 20% case arrivals, 70% task execution, 10% case completion
soak.event.distribution.arrivals=0.20
soak.event.distribution.execution=0.70
soak.event.distribution.completion=0.10

# ====================================================================
# Advanced JVM Tuning (passed via -DargLine)
# ====================================================================

# JVM Configuration (set via Maven argLine or _JAVA_OPTIONS):
# -Xms8g -Xmx8g
#   Heap: 8GB initial, 8GB max
#   Note: Actual usable heap ~2-4GB; rest reserved for GC overhead
#
# -XX:+UseZGC
#   Garbage collector: ZGC (concurrent, low-pause)
#   Alternative: -XX:+UseG1GC (if ZGC unavailable)
#
# -XX:+UseCompactObjectHeaders
#   Java 25 feature: save 4-8 bytes per object
#   Throughput improvement: ~5%
#
# -XX:+DisableExplicitGC
#   Prevent System.gc() from triggering collections
#   Allows ZGC to manage collection timing
#
# -XX:+AlwaysPreTouch
#   Pre-allocate heap pages at startup
#   Prevents allocation-time pauses during test
#
# ZGC-specific tuning (optional):
# -XX:ZCollectionInterval=120000
#   Force collection every 120 seconds (for analysis)
#
# -XX:ZUncommitDelay=300
#   Return memory to OS after 300ms of inactivity
#
# Thread tuning:
# -Djava.util.concurrent.ForkJoinPool.common.parallelism=128
#   Tune FJP for high-throughput workloads

# ====================================================================
# Execution Checklist
# ====================================================================

# Before running, verify:
# 1. Java version: java -version (expect Java 25+)
# 2. Heap availability: free -h (expect 12+ GB RAM)
# 3. Disk space: df -h (expect 10+ GB free)
# 4. Test infrastructure: mvn test -pl yawl-benchmark --help
# 5. Clean environment: rm -f metrics-*.jsonl latency-*.json
# 6. Baseline captured: git log --oneline -1

# ====================================================================
# Expected Test Output
# ====================================================================

# Duration: 4 hours
# Cases created: ~7,200,000 (500 cases/sec * 14,400 sec)
# Cases completed: ~6,900,000 (95-98% of created)
# Throughput: 478-500 cases/sec (95-100% of target)
# Heap growth: 200-400 MB/hour (pass <500)
# GC pauses: p99 <100ms (typical ZGC <10ms)
# Thread count: 100-1000 (pass <10,000)
# Breaking point: Not detected (pass)

# ====================================================================
