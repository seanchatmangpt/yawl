# WCP-60: Rules Engine Pattern
# Business rules evaluation in workflow.
# Demo uses AND-split to fire all actions (simplified: all rules match).
# In production, each action would be guarded by a predicate (e.g. ruleA_matched==true)
# so only actions whose rules fired are executed.

name: RulesEnginePattern
uri: rules-engine.xml
first: CollectFacts

variables:
  - name: factSet
    type: xs:string
  - name: rulesVersion
    type: xs:string
    default: "1.0"
  - name: matchedRules
    type: xs:string
  - name: actions
    type: xs:string

tasks:
  - id: CollectFacts
    flows: [LoadRules]
    split: xor
    join: xor
    description: "Gather business facts"

  - id: LoadRules
    flows: [EvaluateRules]
    split: xor
    join: xor
    description: "Load rule definitions"

  - id: EvaluateRules
    flows: [ApplyActions]
    split: xor
    join: xor
    description: "Execute rules engine"

  - id: ApplyActions
    flows: [ActionA, ActionB, ActionC]
    split: and
    join: xor
    description: "Apply rule actions"

  - id: ActionA
    flows: [Complete]
    split: xor
    join: xor
    description: "Execute action A"

  - id: ActionB
    flows: [Complete]
    split: xor
    join: xor
    description: "Execute action B"

  - id: ActionC
    flows: [Complete]
    split: xor
    join: xor
    description: "Execute action C"

  - id: Complete
    flows: [end]
    split: xor
    join: and
    description: "Rules processing complete"
