---
# Mutating Webhook Configuration
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: yawl-cluster-mutating-webhook
  namespace: yawl-operator-system
  annotations:
    description: "Mutating webhook for YawlCluster to provide defaults"
webhooks:
  - name: default.yawlcluster.yawl.io
    admissionReviewVersions: ["v1"]
    clientConfig:
      service:
        name: yawl-operator-webhook-service
        namespace: yawl-operator-system
        path: "/mutate-yawl-io-v1beta1-yawlcluster"
      caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUU0RENDQU1EQmdxaGtqT1BRUURCQUlGQURDQkl6Q0NBUm9HQkF3U0Y4YWFEQTBBQmh0UXZaQ2pUZTVfUzJITWsKTWpRUkJnTlZCQkZUVEZCdmRXNTBZVzl0U1U1RExqRXhNakF4TUh0TERnQUdFMWpsWXpRMVJEazBNakJEUWsxVAovakZsWXpSQ1ZEZEhTRkkVVGsxRGQwTlRSV2hpVmxSbFdUTm9iRkl4VlRKT2FrMDJWVEJLTkU1cVVuTk9WRVo2ClZWUkJkMUZ1YjNkWFZFazBWbGM1YVZOWGJGUlhSMGt4VkZkd1IxTnNUVE5PVmtWM1ZXcEJkMUp2V0RCVWF6QTEKV1cxV2MxbFhOVEJaV0VKWFlsaEZhazFHVW5wa2F6MUJUbGN4VVd0RFMwUjNXVlJhYldGeVZtMWhSR1J2VkRGRwpVMjFVVkZsaE1VWkVaR3hPWVZGWGQzaFBWRkp3V1RKTldHTXlVbmRhUTJkeFZtdHdVRlJYVVhSWFJFWm1XV3hHClkxRXhVbFJoTVdSRFlXMUdSMVJyVGxkU2JUQjJWbXBCZEU1cVVuQlZWRkJ5YWxkc2FGVlhSakJaV0Vac1pERkgKVjFSdVdsSmthelZ3Vkd0YWMxSllNSEJEYTBWRFYyY3hWRlJHYkdGVmVreFpWbWhyZWxJeFRuTlhSR1JuVkRGSApkMVZzVVRWVmVrRkVWbFJDWVUxVWJGTlZNVEJ4Vlc1a1dFNUdSblJpVjBKNVYydG9WRlJ0YTNoV2EwMW1WMjFzCmNsRlljM2RVTWpSeVdWRldVbFZWTVZKWFlURk9jMUo2UWsxVE1XeFhWVE5rVVZWWWJGRm5WWEJyVFUxMFlVdEgKUTNkWFlXeEZhMlY0VGpSUFYycHhZbXBOY0V0VVkzWlBWRUV4VG5jMWVVTlNXbXBQV0RGb1RXMXdTMEpVUVhkTgpNbXgwVlcxR1lVNVNWVEZhVTBSQlNFRlJUMGM1VDBGSFNFRGFWRGQ0VmtFMlEyRkhWV3hWYkhCM1YxZEcKUTBGM1NVSk5RbGRIUkRGRGRGZEVjSGRYVkVGUVNVSk5RaTlIVkZOQ1ltSlhWbkJQVkZGdVZqQk9iMVY1ClVteGxORJJWMjVrYWsxSFVYVkJNMGx1VFhkVE5EQndNRXRUVGpCQlZqSnhSa3d3WkhCaVNXNW1iRkZrVjBGMgpWVEZDVEdGNVRsQktiMGxCVFhkS01VbFdZbE5XU0Vra2VqUlRia2Q2VVd4S2RFNUhSbXRQVjBWM1RURnZabUZXCk1YZFJNa3hTVG0xVmVFMXRSbWRaVkUweFRXdHdiRkJEVFhkS1YyTkdZbGhSYWoxUlNVSkJSRUp3Vms5V1dGbEkKVW1zMmIwTnBUSGN4Vm0xdlZGWkdWRkJyVTBOd1NVMXdSRUpCUkZCRlRrRkJSMEpRVVRSRmVrRkVWMEZSUkVWRgpWMFJSV1UxS2FVRkJSMjFCVFRSS2VFRkVaRVZSUVVWRVNVMUlVREI1UVUxVVNVRlJSRVUxUWsxUlVFRlJSME4zClZVUlhNa3BVVVRCRWQwWmxNMlJ3VEZkWmQwUlJWRVZRUVZGSFFVRlhSME5EZDBoUldVdEZhMDFEUTBFeFIwRlEKVkVaUFVqQkJhRUZETUVSQmQwRm5XVVJsV0U0d2FVNDRUME5CYW5SQk1qVkJiMUpFVDBGRFEwRkhVMFJSYWtGbgpWMGRrYVU1SFlqSk5iREJ2VGtSUlNFUlNhRVZFVFhwWk1FRlhSMEpCVlhJd1RrRkRkRk5yTkZkaU1IQkZVVlJ2CmQyOVhNME5IVFVObmQxSnNXWGRQVnpGSVZtczFWRVZFUW5Sa1IyeEZWMFpLUzFSWFNVOVNWMGxZVFhkR2VVNUkKVFhkT2VrMUVSelpCVEZSQ1UwVlJhMFJCVlRSRmQwWkJkMDFWU1UxVWFrNVdWMFozVEd0a2JGbElVWFJWVkUxcApVMGRaUWsxQ2FVSldWRmRrUTBGWVSRFZEVkZSRFEzcEdhMEpRUTBSQmEyRkJPRWxEUTBOQVIwRlNVMFJSUkZKRgpWMUpCVTBGQlIwSmxWWEEzVkRKS1VVRklNRXc0VFVGTlFrSkVNVXBrTWtNMlRGUnJWRVJSTVhSRVZGVlJNRkpGClNVUkVURmhUVVUxM1QwRlhSME5CYVhCNFJGRkZSa0pCU1UxUlJteFhUMFJCTWsxWFNVSkNSRVpDVVZSR1RFRlUKVVhoa1YwVlNWalZLYzBOSGFFTlFaMUpRUTBSQmEyRkJPRWxEUTBOQlIwRlNVMFJSUkZKRlZWSlJWRUZCUTBGbgpRMEpoTVZONFFYZEdWbFpVVlhsUFZGa3hVbWRHZEU5SFJuQlhUVU5GVVZWRmIyVldWbG9yVVRCRmEyRkhWblprCmJWRkZWbFZSVTBGVlEwRlhSME5CYVhCNFJGRkZSa0pCU1UxUlJteFhUMFJCTWsxWFNVSkNSRVpDVVZSR1RFRlUKVVhoa1YwVlNWalZLYzBOSGFFTlFaMUpRMEpoTVZONFFYZEdWbFpVVlhsUFZGa3hVbWRHZEU5SFJuQlhUVU5GClVWVkZiMlZXVmxvclVUQkZhMkZIVm5aa2JWRkZWbFZSVTBGVlEwRlhSME5CYVhCNFJGRkZSa0pCU1UxUlJteFgKVDBSQk1rMVhTVUpDUkVaQ1VWUkdURUZVVVhoa1YwVlNWalZLYzBOSGFFTlFaMUpRMEpoTVZONFFYZEdWbFpVClZYbFBWRmt4VW1kR2RFOUhSbkJYVFVORlVWVkZiMlZXVmxvclVUQkZhMkZIVm5aa2JWRkZWbFZSVTBGVlEwRlgKUjBOQmFYQjRSRkZGUmtKQlNVMVJSbXhYVDBSQk1rMVhTVUpDUkVaQ1VWUkdURUZVVVhoa1YwVlNWalZLYzBOSApSbU5RWjBKUVEwUm5RazlEVEVGRlNHeEJRMFJCVEVGNFEwTkhRVFpWV1VOSFlVRkJOMEowUVRaaWVUbEJSMFJCCmVrRkVWMFJSUVVWRVNVMUlVREI1UVUxVVNVRlJSRVUxUWsxUlVFRlJSME4zVlVSWE1rUlVVVEJFZDBabgpNMlJ3VEZkWmQwUlJWRVZRUVZGSFFVRlhSME5EZDBoUldVdEZhMDFEUTBFeFIwRlFWRVpQVWpCQmFFRkRNRVJCCmQwRm5XVVJsV0U0d2FVNDRUMU1OYW5SQk1qVkJiMUpFVDBGRFEwRkhVMFJSYWtGblYwZGthVTVIWWpKTmJEQnYKVGtSUlNFUlNhRVZFVFhwWk1FRlhSMEpCVlhJd1RrRkRkRk5yTkZkaU1IQkZVVlJ2ZDI5WE0wTkhUVVJuZDFKcwpXWGRQVnpGSVZtczFWRVZFUW5Sa1IyeEZWMFpLUzFSWFNVOVNWMGxZVFhkR2VVNUlUWGROVWsxQ2FVSldWRmRrClEwRllSRVZEVkZSRFEzcEdhMEpRUTBSQmEyRkJPRWxEUTBOQlIwRlNVMFJSUkZKRlZWSlJWRUZCUTBGbkswRlAKUTBSQldEQkJPRGxEUTBOQlIwRlNVMFJSUkZKRlZWSlJWRUZCUTBGbkswRlQKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
    rules:
      - operations: ["CREATE", "UPDATE"]
        apiGroups: ["yawl.io"]
        apiVersions: ["v1beta1"]
        resources: ["yawlclusters"]
        scope: "Namespaced"
    sideEffects: None
    failurePolicy: Fail
    timeoutSeconds: 5
    namespaceSelector:
      matchLabels:
        yawl-operator: enabled
    objectSelector: {}

---
# Validating Webhook Configuration
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  name: yawl-cluster-validating-webhook
  namespace: yawl-operator-system
  annotations:
    description: "Validating webhook for YawlCluster to enforce constraints"
webhooks:
  - name: validate.yawlcluster.yawl.io
    admissionReviewVersions: ["v1"]
    clientConfig:
      service:
        name: yawl-operator-webhook-service
        namespace: yawl-operator-system
        path: "/validate-yawl-io-v1beta1-yawlcluster"
      caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUU0RENDQU1EQmdxaGtqT1BRUURCQUlGQURDQkl6Q0NBUm9HQkF3U0Y4YWFEQTBBQmh0UXZaQ2pUZTVfUzJITWsKTWpRUkJnTlZCQkZUVEZCdmRXNTBZVzl0U1U1RExqRXhNakF4TUh0TERnQUdFMWpsWXpRMVJEazBNakJEUWsxVAovakZsWXpSQ1ZEZEhTRkkVVGsxRGQwTlRSV2hpVmxSbFdUTm9iRkl4VlRKT2FrMDJWVEJLTkU1cVVuTk9WRVo2ClZWUkJkMUZ1YjNkWFZFazBWbGM1YVZOWGJGUlhSMGt4VkZkd1IxTnNUVE5PVmtWM1ZXcEJkMUp2V0RCVWF6QTEKV1cxV2MxbFhOVEJaV0VKWFlsaEZhazFHVW5wa2F6MUJUbGN4VVd0RFMwUjNXVlJhYldGeVZtMWhSR1J2VkRGRgpVMjFVVkZsaE1VWkVaR3hPWVZGWGQzaFBWRkp3V1RKTldHTXlVbmRhUTJkeFZtdHdVRlJYVVhSWFJFWm1XV3hHClkxRXhVbFJoTVdSRFlXMUdSMVJyVGxkU2JUQjJWbXBCZEU1cVVuQlZWRkJ5YWxkc2FGVlhSakJaV0Vac1pERkgKVjFSdVdsSmthelZ3Vkd0YWMxSllNSEJEYTBWRFYyY3hWRlJHYkdGVmVreFpWbWhyZWxJeFRuTlhSR1JuVkRGSApkMVZzVVRWVmVrRkVWbFJDWVUxVWJGTlZNVEJ4Vlc1a1dFNUdSblJpVjBKNVYydG9WRlJ0YTNoV2EwMW1WMjFzCmNsRlljM2RVTWpSeVdWRldVbFZWTVZKWFlURk9jMUo2UWsxVE1XeFhWVE5rVVZWWWJGRm5WWEJyVFUxMFlVdEgKUTNkWFlXeEZhMlY0VGpSUFYycHhZbXBOY0V0VVkzWlBWRUV4VG5jMWVVTlNXbXBQV0RGb1RXMXdTMEpVUVhkTgpNbXgwVlcxR1lVNVNWVEZhVTBSQlNFRlJUMGM1VDBGSFNFRGFWRGQ0VmtFMlEyRkhWV3hWYkhCM1YxZEcKUTBGM1NVSk5RbGRIUkRGRGRGZEVjSGRYVkVGUVNVSk5RaTlIVkZOQ1ltSlhWbkJQVkZGdVZqQk9iMVY1ClVteGxORJJWMjVrYWsxSFVYVkJNMGx1VFhkVE5EQndNRXRUVGpCQlZqSnhSa3d3WkhCaVNXNW1iRkZrVjBGMgpWVEZDVEdGNVRsQktiMGxCVFhkS01VbFdZbE5XU0Vra2VqUlRia2Q2VVd4S2RFNUhSbXRQVjBWM1RURnZabUZXCk1YZFJNa3hTVG0xVmVFMXRSbWRaVkUweFRXdHdiRkJEVFhkS1YyTkdZbGhSYWoxUlNVSkJSRUp3Vms5V1dGbEkKVW1zMmIwTnBUSGN4Vm0xdlZGWkdWRkJyVTBOd1NVMXdSRUpCUkZCRlRrRkJSMEpRVVRSRmVrRkVWMEZSUkVWRgpWMFJSV1UxS2FVRkJSMjFCVFRSS2VFRkVaRVZSUVVWRVNVMUlVREI1UVUxVVNVRlJSRVUxUWsxUlVFRlJSME4zClZVUlhNa3BVVVRCRWQwWmxNMlJ3VEZkWmQwUlJWRVZRUVZGSFFVRlhSME5EZDBoUldVdEZhMDFEUTBFeFIwRlEKVkVaUFVqQkJhRUZETUVSQmQwRm5XVVJsV0U0d2FVNDRUMU5CYW5SQk1qVkJiMUpFVDBGRFEwRkhVMFJSYWtGbgpWMGRrYVU1SFlqSk5iREJ2VGtSUlNFUlNhRVZFVFhwWk1FRlhSMEpCVlhJd1RrRkRkRk5yTkZkaU1IQkZVVlJ2CmQyOVhNME5IVFVObmQxSnNXWGRQVnpGSVZtczFWRVZFUW5Sa1IyeEZWMFpLUzFSWFNVOVNWMGxZVFhkR2VVNUkKVFhkT2VrMUVSelpCVEZSQ1UwVlJhMFJCVlRSRmQwWkJkMDFWU1UxVWFrNVdWMFozVEd0a2JGbElVWFJWVkUxcApVMGRaUWsxQ2FVSldWRmRrUTBGWVSRFZEVkZSRFEzcEdhMEpRUTBSQmEyRkJPRWxEUTBOQVIwRlNVMFJSUkZKRgpWMUpCVTBGQlIwSmxWWEEzVkRKS1VVRklNRXc0VFVGTlFrSkVNVXBrTWtNMlRGUnJWRVJSTVhSRVZGVlJNRkpGClNVUkVURmhUVVUxM1QwRlhSME5CYVhCNFJGRkZSa0pCU1UxUlJteFhUMFJCTWsxWFNVSkNSRVpDVVZSR1RFRlUKVVhoa1YwVlNWalZLYzBOSGFFTlFaMUpRMEpITVZONFFYZEdWbFpVVlhsUFZGa3hVbWRHZEU5SFJuQlhUVU5GClVWVkZiMlZXVmxvclVUQkZhMkZIVm5aa2JWRkZWbFZSVTBGVlEwRlhSME5CYVhCNFJGRkZSa0pCU1UxUlJteFgKVDFSQk1rMVhTVUpDUkVaQ1VWUkdURUZVVVhoa1YwVlNWalZLYzBOSGFFTlFaMUpRMEpoTVZONFFYZEdWbFpVClZYbFBWRmt4VW1kR2RFOUhSbkJYVFVORlVWVkZiMlZXVmxvclVUQkZhMkZIVm5aa2JWRkZWbFZSVTBGVlEwRlgKUjBOQmFYQjRSRkZGUmtKQlNVMVJSbXhYVDBSQk1rMVhTVUpDUkVaQ1VWUkdURUZVVVhoa1YwVlNWalZLYzBOSApSbU5RWjBKUVEwUm5RazlEVEVGRlNHeEJRMFJCVEVGNFEwTkhRVFpWV1VOSFlVRkJOMEowUVRaaWVUbEJSMFJCCmVrRkVWMFJSUVVWRVNVMUlVREI1UVUxVVNVRlJSRVUxUWsxUlVFRlJSME4zVlVSWE1rUlVVVEJFZDBabgpNMlJ3VEZkWmQwUlJWRVZRUVZGSFFVRlhSME5EZDBoUldVdEZhMDFEUTBFeFIwRlFWRVpQVWpCQmFFRkRNRVJCCmQwRm5XVVJsV0U0d2FVNDRUMU1OYW5SQk1qVkJiMUpFVDBGRFEwRkhVMFJSYWtGblYwZGthVTVIWWpKTmJEQnYKVGtSUlNFUlNhRVZFVFhwWk1FRlhSMEpCVlhJd1RrRkRkRk5yTkZkaU1IQkZVVlJ2ZDI5WE0wTkhUVVJuZDFKcwpXWGRQVnpGSVZtczFWRVZFUW5Sa1IyeEZWMFpLUzFSWFNVOVNWMGxZVFhkR2VVNUlUWGROVWsxQ2FVSldWRmRrClEwRllSRVZEVkZSRFEzcEdhMEpRUTBSQmEyRkJPRWxEUTBOQlIwRlNVMFJSUkZKRlZWSlJWRUZCUTBGbkswRlAKUTBSQldEQkJPRGxEUTBOQlIwRlNVMFJSUkZKRlZWSlJWRUZCUTBGbkswRlQKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
    rules:
      - operations: ["CREATE", "UPDATE"]
        apiGroups: ["yawl.io"]
        apiVersions: ["v1beta1"]
        resources: ["yawlclusters"]
        scope: "Namespaced"
    sideEffects: None
    failurePolicy: Fail
    timeoutSeconds: 5
    namespaceSelector:
      matchLabels:
        yawl-operator: enabled
    objectSelector: {}

---
# Service for Webhooks
apiVersion: v1
kind: Service
metadata:
  name: yawl-operator-webhook-service
  namespace: yawl-operator-system
  labels:
    app: yawl-operator
spec:
  ports:
    - port: 443
      targetPort: 9443
      protocol: TCP
      name: webhook
  selector:
    app: yawl-operator
  type: ClusterIP
