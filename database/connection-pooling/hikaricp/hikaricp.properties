# HikariCP Configuration for YAWL
# Production-ready connection pool settings

# =============================================================================
# BASIC DATASOURCE CONFIGURATION
# =============================================================================

# JDBC URL (choose one based on your database)
# PostgreSQL
jdbcUrl=jdbc:postgresql://localhost:5432/yawl

# MySQL
#jdbcUrl=jdbc:mysql://localhost:3306/yawl

# Oracle
#jdbcUrl=jdbc:oracle:thin:@localhost:1521:YAWL

# SQL Server
#jdbcUrl=jdbc:sqlserver://localhost:1433;databaseName=yawl

# Driver class (auto-detected, but can be specified)
#driverClassName=org.postgresql.Driver

# Credentials
username=yawl
password=changeme

# Pool name for identification
poolName=YAWLConnectionPool

# =============================================================================
# POOL SIZE CONFIGURATION
# =============================================================================

# Maximum pool size - should be tuned based on:
# connections = (core_count * 2) + effective_spindle_count
# For optimal performance: 10-20 connections per database server
maximumPoolSize=20

# Minimum idle connections - maintain this many connections even when idle
minimumIdle=5

# =============================================================================
# TIMEOUT CONFIGURATION
# =============================================================================

# Connection timeout - milliseconds to wait for a connection from pool
connectionTimeout=30000

# Idle timeout - milliseconds before an idle connection is closed
# Should be less than database server's wait_timeout
idleTimeout=600000

# Max lifetime - milliseconds before a connection is closed
# Should be less than database server's max_lifetime
maxLifetime=1800000

# Validation timeout - milliseconds to wait for connection validation
validationTimeout=5000

# Leak detection threshold - milliseconds before a connection leak is logged
# Set to 0 to disable leak detection
leakDetectionThreshold=60000

# =============================================================================
# CONNECTION INITIALIZATION
# =============================================================================

# SQL query to validate connections
connectionTestQuery=SELECT 1

# Initialize SQL to run on each new connection
connectionInitSql=SET TIME ZONE 'UTC'

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================

# Cache prepared statements
# For PostgreSQL, recommended to set to the same as maximumPoolSize
prepStmtCacheSize=250

# Cache prepared statement SQL strings
prepStmtCacheSqlLimit=2048

# Cache prepared statements for all connections
cachePrepStmts=true

# Use local prepared statement cache
useLocalSessionState=true

# Cache result set metadata
cacheResultSetMetadata=true

# Cache database metadata
cacheDatabaseMetaData=true

# Cache collation information
cacheServerConfiguration=true

# Elide set auto commit
elideSetAutoCommits=true

# Maintain time stats (disable for better performance)
maintainTimeStats=false

# Use local transaction state
useLocalTransactionState=true

# =============================================================================
# HEALTH CHECK CONFIGURATION
# =============================================================================

# Keepalive time - time between health check queries (milliseconds)
keepaliveTime=120000

# =============================================================================
# METRICS AND MONITORING
# =============================================================================

# Enable metrics collection (requires micrometer or dropwizard metrics)
metricsTrackerFactory=com.zaxxer.hikari.metrics.micrometer.MicrometerMetricsTrackerFactory

# Enable JMX for pool monitoring
registerMbeans=true

# Allow pool suspension (for maintenance)
allowPoolSuspension=true

# =============================================================================
# FAILOVER AND RECOVERY
# =============================================================================

# Schema - default schema for connections
schema=public

# Catalog - default catalog for connections
#catalog=yawl

# Initialization fail timeout - seconds to wait for pool initialization
initializationFailTimeout=1

# Isolate internal queries - run validation queries in separate transaction
isolateInternalQueries=false

# Read only - set connections to read-only mode
readOnly=false

# Auto commit - default auto-commit mode
autoCommit=true

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Log-level for HikariCP (DEBUG, INFO, WARN, ERROR)
logLevel=INFO
