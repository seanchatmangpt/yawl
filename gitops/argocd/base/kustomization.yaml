# =============================================================================
# YAWL v6.0.0 - ArgoCD Base Configuration
# =============================================================================
# Kustomize base for ArgoCD resources that should be applied first.
#
# Usage:
#   kubectl apply -k gitops/argocd/base
# =============================================================================
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - projects/yawl-project.yaml
  - apps/yawl-application.yaml

commonLabels:
  app.kubernetes.io/part-of: yawl-platform
  app.kubernetes.io/managed-by: kustomize

namespace: argocd

configMapGenerator:
  - name: yawl-argocd-config
    literals:
      - YAWL_VERSION=6.0.0
      - HELM_REPO_URL=https://github.com/yawlfoundation/yawl.git
      - VALUES_PATH=helm/yawl

replacements:
  - source:
      kind: ConfigMap
      name: yawl-argocd-config
      fieldPath: data.YAWL_VERSION
    targets:
      - select:
          kind: Application
          name: yawl
        fieldPaths:
          - spec.source.helm.parameters.[name=yawlVersion].value
