<?xml version="1.0" encoding="UTF-8"?>
<!--
  YAWL Workflow Template - Tera Template Engine Example

  This template demonstrates using Tera templating syntax with YAWL specifications.
  Useful for: Parameterized workflow generation, multi-case scenarios

  Usage: ggen generate --template Tera.template --input data.json
-->
<specification xmlns="http://www.yawlfoundation.org/yawlschema"
               xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xsi:schemaLocation="http://www.yawlfoundation.org/yawlschema
               http://www.yawlfoundation.org/yawlschema/YAWL_Schema2.3.xsd"
               name="{% if title %}{{ title }}{% else %}Template Workflow{% endif %}"
               version="0.1">

  <!-- Example: Generate task count from template variable -->
  <processControlElements>
    <!-- Start task -->
    <rootNetElement identifier="start">
      <flowsInto>
        <nextElementRef id="process_items" />
      </flowsInto>
    </rootNetElement>

    <!-- Loop over items (e.g., {{ items | length }} parallel tasks) -->
    {% for i in range(num_tasks | default(value=3)) %}
    <task id="task_{{ i }}">
      <name>Task {{ i }} - {% if items %}{{ items[i] }}{% else %}Item {% endif %}</name>
      <flowsInto>
        <nextElementRef id="aggregate" />
      </flowsInto>
      <split code="AND" />
    </task>
    {% endfor %}

    <!-- Aggregation point -->
    <condition id="aggregate">
      <flowsInto>
        <nextElementRef id="validate" />
      </flowsInto>
      <join code="AND" />
    </condition>

    <!-- Validation task (conditional on result_threshold) -->
    <task id="validate">
      <name>Validation</name>
      <flowsInto>
        {% if strict_mode %}
        <nextElementRef id="reject" />
        {% else %}
        <nextElementRef id="approve" />
        {% endif %}
      </flowsInto>
    </task>

    <!-- Conditional branches -->
    {% if strict_mode %}
    <task id="reject">
      <name>Reject</name>
      <flowsInto>
        <nextElementRef id="end" />
      </flowsInto>
    </task>
    {% endif %}

    <task id="approve">
      <name>Approve</name>
      <flowsInto>
        <nextElementRef id="end" />
      </flowsInto>
    </task>

    <!-- End task -->
    <outputCondition id="end" />
  </processControlElements>

  <!-- Task definitions -->
  <tasks>
    {% for i in range(num_tasks | default(value=3)) %}
    <task id="task_{{ i }}">
      <name>Task {{ i }}</name>
      <resourcing>
        <offer initiator="system">
          <resources>
            <participant code="{{ resource_pool | default(value='admin') }}" />
          </resources>
        </offer>
      </resourcing>
      <decomposesTo id="task_{{ i }}_subnet" />
    </task>
    {% endfor %}

    <task id="validate">
      <name>Validate Results</name>
      <resourcing>
        <offer initiator="system">
          <resources>
            <participant code="validator" />
          </resources>
        </offer>
      </resourcing>
    </task>

    <task id="approve">
      <name>Approve</name>
      <resourcing>
        <offer initiator="system">
          <resources>
            <participant code="approver" />
          </resources>
        </offer>
      </resourcing>
    </task>
  </tasks>

  <!-- Template parameters (for documentation) -->
  <!--
    Parameters to pass when rendering this template:

    - title (string): Workflow title
    - num_tasks (integer): Number of parallel tasks [default: 3]
    - items (array): List of item names to process
    - strict_mode (boolean): Enable strict validation [default: false]
    - resource_pool (string): Resource pool for task assignment [default: 'admin']
  -->

</specification>
