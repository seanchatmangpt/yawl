# YAWL Helm Chart Values for Google Cloud Platform (GCP)
# This overrides the default values for GCP-specific configurations

# GCP Project and Region
global:
  projectName: yawl
  environment: production
  gcp:
    project: "my-gcp-project"
    region: "us-central1"
    zone: "us-central1-a"

# GKE Cluster Configuration
gke:
  clusterName: "yawl-cluster"
  zone: "us-central1-a"
  machineType: "n1-standard-2"
  nodeCount: 3
  diskSizeGb: 100

# Container Registry
image:
  repository: gcr.io/my-gcp-project/yawl/yawl
  tag: "1.0.0"
  pullPolicy: IfNotPresent

imagePullSecrets:
  - name: gcr-secret

# Service Account for GCP
serviceAccount:
  create: true
  annotations:
    iam.gke.io/gcp-service-account: yawl-sa@my-gcp-project.iam.gserviceaccount.com
  name: yawl-ksa

# Storage Configuration using GCP Persistent Disks
persistence:
  enabled: true
  storageClassName: "standard-rwo"
  size: 50Gi
  accessMode: ReadWriteOnce
  annotations:
    cloud.google.com/backends: "{"gce_persistent_disk": {}}"

# CloudSQL for PostgreSQL
postgresql:
  enabled: false  # Use CloudSQL instead

externalPostgresql:
  enabled: true
  host: "35.192.0.0"  # CloudSQL instance IP
  port: 5432
  username: yawladmin
  password: "changeme123!"
  database: yawldb
  sslMode: require
  # GCP specific credentials
  credentials:
    secretName: cloudsql-credentials

# Memorystore for Redis
redis:
  enabled: false  # Use Google Memorystore instead

externalRedis:
  enabled: true
  host: "10.0.0.2"  # Memorystore Redis instance IP
  port: 6379
  auth:
    enabled: false
    password: ""

# Ingress with Google Cloud Load Balancer
ingress:
  enabled: true
  className: "gce"
  annotations:
    kubernetes.io/ingress.class: "gce"
    kubernetes.io/ingress.global-static-ip-name: "yawl-ip"
    networking.gke.io/managed-certificates: "yawl-cert"
    kubernetes.io/ingress.allow-http: "false"
  hosts:
    - host: yawl.example.com
      paths:
        - path: /*
          pathType: ImplementationSpecific

# GCP Managed Certificates
managedCertificate:
  enabled: true
  domains:
    - yawl.example.com

# Workload Identity for GCP Service Account
workloadIdentity:
  enabled: true
  gcpServiceAccount: "yawl-sa@my-gcp-project.iam.gserviceaccount.com"

# Cloud Monitoring Integration
monitoring:
  enabled: true
  gcp:
    enabled: true
    projectId: "my-gcp-project"
  serviceMonitor:
    enabled: true

# Cloud Logging Integration
logging:
  enabled: true
  gcp:
    enabled: true
    projectId: "my-gcp-project"
    logName: "projects/my-gcp-project/logs/yawl"

# GCP Backup using Cloud Storage
backup:
  enabled: true
  gcp:
    enabled: true
    bucket: "gs://my-gcp-project-yawl-backups"
    storageClass: "NEARLINE"
  schedule: "0 2 * * *"
  retention: 30

# Network Policy using GCP VPC
networkPolicy:
  enabled: true
  provider: "calico"

# HPA for GKE Workloads
autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 20
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
        - type: Percent
          value: 50
          periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 60
      policies:
        - type: Percent
          value: 100
          periodSeconds: 30

# Node Pool Configuration
nodeSelector:
  cloud.google.com/gke-nodepool: "yawl-pool"

tolerations:
  - key: "workload-type"
    operator: "Equal"
    value: "yawl"
    effect: "NoSchedule"

affinity:
  nodeAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        preference:
          matchExpressions:
            - key: cloud.google.com/gke-local-ssd
              operator: In
              values:
                - "true"

# GCP-specific labels and annotations
podAnnotations:
  cluster-autoscaler.kubernetes.io/safe-to-evict: "true"
  gke.io/workload-identity: "enabled"

podLabels:
  workload-type: "yawl"

# Service annotations for GCP Load Balancer
service:
  type: NodePort
  annotations:
    cloud.google.com/backend-config: "yawl-backendconfig"
    cloud.google.com/neg: '{"ingress": true}'

# Binary Authorization (if enabled in cluster)
binaryAuthorization:
  enabled: false
  policy: "projects/my-gcp-project/policy/default"

# GCP Service Account Permissions
iamRoles:
  - roles/cloudkms.cryptoKeyEncrypter
  - roles/cloudkms.cryptoKeyDecrypter
  - roles/storage.objectViewer
  - roles/logging.logWriter
  - roles/monitoring.metricWriter
