<?xml version="1.0" encoding="UTF-8"?>
<!--
  YAWL V6 Observatory: Build-and-Test Workflow Specification
  Run ID: 20260217T224854Z
  Receipt: docs/v6/latest/receipts/observatory.json
  Generated by: scripts/observatory/observatory.sh
-->
<specificationSet xmlns="http://www.yawlfoundation.org/yawlschema"
                  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                  xsi:schemaLocation="http://www.yawlfoundation.org/yawlschema
                  http://www.yawlfoundation.org/yawlschema/YAWL_Schema4.0.xsd">

  <specification uri="BuildAndTest">
    <documentation>
      Models the YAWL V6 Maven build-and-test lifecycle as a Petri-net-based
      workflow. Each task corresponds to a Maven phase or quality gate.
      The net topology matches the actual dependency and gate structure
      discovered by the observatory.
    </documentation>

    <metaData>
      <title>YAWL V6 Build and Test Workflow</title>
      <creator>observatory</creator>
      <description>Deterministic build/test/verify lifecycle for YAWL V6</description>
      <version>1.0</version>
      <persistent>false</persistent>
      <identifier>BuildAndTest</identifier>
    </metaData>

    <!-- ════════════════════════════════════════════════════════════════ -->
    <!-- Root Net: main                                                  -->
    <!-- ════════════════════════════════════════════════════════════════ -->
    <decomposition id="main" isRootNet="true" xsi:type="NetFactsType">

      <localVariable>
        <index>0</index>
        <name>buildStatus</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
        <initialValue>PENDING</initialValue>
      </localVariable>

      <localVariable>
        <index>1</index>
        <name>testStatus</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
        <initialValue>PENDING</initialValue>
      </localVariable>

      <localVariable>
        <index>2</index>
        <name>gateStatus</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
        <initialValue>PENDING</initialValue>
      </localVariable>

      <processControlElements>

        <!-- ── Input Condition ──────────────────────────────────── -->
        <inputCondition id="InputCondition">
          <name>Start</name>
          <flowsInto>
            <nextElementRef id="Validate"/>
          </flowsInto>
        </inputCondition>

        <!-- ── Task: Validate ───────────────────────────────────── -->
        <task id="Validate">
          <name>Validate POM and Dependencies</name>
          <documentation>
            mvn validate — checks POM structure, enforcer rules,
            dependency convergence. Detects H_DEP_CONVERGENCE_VIOLATION.
          </documentation>
          <flowsInto>
            <nextElementRef id="Compile"/>
          </flowsInto>
          <join code="xor"/>
          <split code="and"/>
          <decomposesTo id="ValidateDecomp"/>
        </task>

        <!-- ── Task: Compile ────────────────────────────────────── -->
        <task id="Compile">
          <name>Compile All Modules</name>
          <documentation>
            mvn -T 1.5C compile — parallel compilation across 13 modules.
            Resolves shared ../src paths via include/exclude filters.
            Detects H_SHARED_SRC_AMBIGUOUS_OWNER on filter overlap.
          </documentation>
          <flowsInto>
            <nextElementRef id="UnitTests"/>
          </flowsInto>
          <join code="xor"/>
          <split code="and"/>
          <decomposesTo id="CompileDecomp"/>
        </task>

        <!-- ── Task: Unit Tests ─────────────────────────────────── -->
        <task id="UnitTests">
          <name>Run Unit Tests</name>
          <documentation>
            mvn -T 1.5C test — surefire plugin, JUnit 5/6 parallel execution.
            Tests run from shared ../test root with module-scoped filtering.
          </documentation>
          <flowsInto>
            <nextElementRef id="GateFork"/>
          </flowsInto>
          <join code="xor"/>
          <split code="and"/>
          <decomposesTo id="UnitTestDecomp"/>
        </task>

        <!-- ── Condition: Gate Fork ─────────────────────────────── -->
        <condition id="GateFork">
          <name>Quality Gate Fork</name>
          <flowsInto>
            <nextElementRef id="GateSpotBugs"/>
          </flowsInto>
          <flowsInto>
            <nextElementRef id="GatePMD"/>
          </flowsInto>
          <flowsInto>
            <nextElementRef id="GateCheckstyle"/>
          </flowsInto>
        </condition>

        <!-- ── Task: SpotBugs Gate ──────────────────────────────── -->
        <task id="GateSpotBugs">
          <name>SpotBugs Analysis</name>
          <documentation>
            spotbugs-maven-plugin in verify phase.
            Refusal: Q_GATE_FAILURE_SPOTBUGS on any HIGH/CRITICAL finding.
          </documentation>
          <flowsInto>
            <nextElementRef id="GateJoin"/>
          </flowsInto>
          <join code="xor"/>
          <split code="and"/>
          <decomposesTo id="SpotBugsDecomp"/>
        </task>

        <!-- ── Task: PMD Gate ───────────────────────────────────── -->
        <task id="GatePMD">
          <name>PMD Analysis</name>
          <documentation>
            maven-pmd-plugin in verify phase.
            Refusal: Q_GATE_FAILURE_PMD on rule violations.
          </documentation>
          <flowsInto>
            <nextElementRef id="GateJoin"/>
          </flowsInto>
          <join code="xor"/>
          <split code="and"/>
          <decomposesTo id="PMDDecomp"/>
        </task>

        <!-- ── Task: Checkstyle Gate ────────────────────────────── -->
        <task id="GateCheckstyle">
          <name>Checkstyle Analysis</name>
          <documentation>
            maven-checkstyle-plugin in verify phase.
            Refusal: Q_GATE_FAILURE_CHECKSTYLE on style violations.
          </documentation>
          <flowsInto>
            <nextElementRef id="GateJoin"/>
          </flowsInto>
          <join code="xor"/>
          <split code="and"/>
          <decomposesTo id="CheckstyleDecomp"/>
        </task>

        <!-- ── Condition: Gate Join ─────────────────────────────── -->
        <condition id="GateJoin">
          <name>Quality Gate Synchronization</name>
          <flowsInto>
            <nextElementRef id="IntegrationTests"/>
          </flowsInto>
        </condition>

        <!-- ── Task: Integration Tests ──────────────────────────── -->
        <task id="IntegrationTests">
          <name>Run Integration Tests</name>
          <documentation>
            mvn failsafe:integration-test — runs **/*IT.java tests.
            Requires compiled artifacts from all modules.
          </documentation>
          <flowsInto>
            <nextElementRef id="Package"/>
          </flowsInto>
          <join code="and"/>
          <split code="and"/>
          <decomposesTo id="IntegrationTestDecomp"/>
        </task>

        <!-- ── Task: Package ────────────────────────────────────── -->
        <task id="Package">
          <name>Package Artifacts</name>
          <documentation>
            mvn package — produces JARs/WARs for all modules.
          </documentation>
          <flowsInto>
            <nextElementRef id="Install"/>
          </flowsInto>
          <join code="xor"/>
          <split code="and"/>
          <decomposesTo id="PackageDecomp"/>
        </task>

        <!-- ── Task: Install ────────────────────────────────────── -->
        <task id="Install">
          <name>Install to Local Repository</name>
          <documentation>
            mvn install — installs artifacts to ~/.m2/repository.
            Clears H_MAVEN_CACHED_MISSING_ARTIFACT hazards for own artifacts.
          </documentation>
          <flowsInto>
            <nextElementRef id="OutputCondition"/>
          </flowsInto>
          <join code="xor"/>
          <split code="and"/>
          <decomposesTo id="InstallDecomp"/>
        </task>

        <!-- ── Output Condition ─────────────────────────────────── -->
        <outputCondition id="OutputCondition">
          <name>Build Complete</name>
        </outputCondition>

      </processControlElements>
    </decomposition>

    <!-- ════════════════════════════════════════════════════════════════ -->
    <!-- Task Decompositions                                             -->
    <!-- ════════════════════════════════════════════════════════════════ -->

    <decomposition id="ValidateDecomp" xsi:type="WebServiceGatewayFactsType">
      <name>Validate POM Structure</name>
      <externalInteraction>manual</externalInteraction>
    </decomposition>

    <decomposition id="CompileDecomp" xsi:type="WebServiceGatewayFactsType">
      <name>Maven Compile</name>
      <externalInteraction>manual</externalInteraction>
    </decomposition>

    <decomposition id="UnitTestDecomp" xsi:type="WebServiceGatewayFactsType">
      <name>Surefire Unit Tests</name>
      <externalInteraction>manual</externalInteraction>
    </decomposition>

    <decomposition id="SpotBugsDecomp" xsi:type="WebServiceGatewayFactsType">
      <name>SpotBugs Static Analysis</name>
      <externalInteraction>manual</externalInteraction>
    </decomposition>

    <decomposition id="PMDDecomp" xsi:type="WebServiceGatewayFactsType">
      <name>PMD Static Analysis</name>
      <externalInteraction>manual</externalInteraction>
    </decomposition>

    <decomposition id="CheckstyleDecomp" xsi:type="WebServiceGatewayFactsType">
      <name>Checkstyle Style Analysis</name>
      <externalInteraction>manual</externalInteraction>
    </decomposition>

    <decomposition id="IntegrationTestDecomp" xsi:type="WebServiceGatewayFactsType">
      <name>Failsafe Integration Tests</name>
      <externalInteraction>manual</externalInteraction>
    </decomposition>

    <decomposition id="PackageDecomp" xsi:type="WebServiceGatewayFactsType">
      <name>Maven Package</name>
      <externalInteraction>manual</externalInteraction>
    </decomposition>

    <decomposition id="InstallDecomp" xsi:type="WebServiceGatewayFactsType">
      <name>Maven Install</name>
      <externalInteraction>manual</externalInteraction>
    </decomposition>

  </specification>
</specificationSet>
