%%{ init: { 'theme': 'base', 'themeVariables': { 'primaryColor': '#3182ce' } } }%%
graph TB
    classDef client fill:#4a5568,stroke:#2d3748,color:#fff
    classDef server fill:#3182ce,stroke:#2b6cb0,color:#fff
    classDef transport fill:#805ad5,stroke:#6b46c1,color:#fff
    classDef capability fill:#38a169,stroke:#2f855a,color:#fff
    classDef engine fill:#e53e3e,stroke:#c53030,color:#fff
    classDef zai fill:#d69e2e,stroke:#b7791f,color:#fff

    subgraph Clients["MCP Clients"]
        CLAUDE[Claude Desktop]:::client
        CURSOR[Cursor IDE]:::client
        CUSTOM[Custom MCP Client]:::client
    end

    subgraph Transport["Transport Layer"]
        STDIO[STDIO Transport<br/>com.sun.net.httpserver]:::transport
        JSONRPC[JSON-RPC 2.0<br/>Message Framing]:::transport
    end

    subgraph MCPServer["YawlMcpServer v5.2"]
        SERVER[YawlMcpServer<br/>Official MCP SDK 0.17.2]:::server
        CAPABILITIES[ServerCapabilities<br/>tools,resources,prompts,completions,logging]:::capability
    end

    subgraph Capabilities["MCP Capabilities"]
        TOOLS["Tools (3)<br/>launch_case, cancel_case,<br/>get_workitems, complete_workitem"]:::capability
        RESOURCES["Resources (2)<br/>yawl://specifications,<br/>yawl://cases, yawl://workitems"]:::capability
        PROMPTS["Prompts (3)<br/>workflow_analysis,<br/>task_completion_guide"]:::capability
        COMPLETIONS["Completions (3)<br/>spec/workitem/case IDs"]:::capability
        LOGGING["Logging<br/>Structured MCP Notifications"]:::capability
    end

    subgraph YAWLEngine["YAWL Engine"]
        INTERFACEB[InterfaceB_EnvironmentBasedClient<br/>Workflow Operations]:::engine
        INTERFACEA[InterfaceA_EnvironmentBasedClient<br/>Specification Management]:::engine
        ENGINE[YEngine<br/>Stateful Workflow Engine]:::engine
    end

    subgraph ZAI["Z.AI Integration"]
        ZAISERVICE[ZaiFunctionService<br/>GLM-4 Function Calling]:::zai
        ZAIHTTP[ZaiHttpClient<br/>HTTP/2 REST Client]:::zai
        ZAIENV[ZHIPU_API_KEY<br/>Environment Variable]:::zai
    end

    %% Client connections
    CLAUDE --> STDIO
    CURSOR --> STDIO
    CUSTOM --> STDIO

    STDIO --> JSONRPC
    JSONRPC --> SERVER

    SERVER --> CAPABILITIES
    CAPABILITIES --> TOOLS
    CAPABILITIES --> RESOURCES
    CAPABILITIES --> PROMPTS
    CAPABILITIES --> COMPLETIONS
    CAPABILITIES --> LOGGING

    TOOLS --> INTERFACEB
    TOOLS --> INTERFACEA
    RESOURCES --> INTERFACEB
    INTERFACEB --> ENGINE
    INTERFACEA --> ENGINE

    %% Z.AI integration (optional via ZHIPU_API_KEY)
    ZAIENV -.->|configures| ZAISERVICE
    ZAISERVICE --> ZAIHTTP
    ZAISERVICE -.->|enhances| TOOLS

    %% Protocol: MCP 2024-11-05 Specification
    %% Transport: STDIO with newline-delimited JSON-RPC
    %% Auth: None (transport-level auth assumed)
