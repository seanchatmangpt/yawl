# Observatory Fact Files — Schema Reference

**Location**: `docs/v6/latest/facts/`
**Generated by**: `bash scripts/observatory/observatory.sh`
**Receipt**: `docs/v6/latest/receipts/observatory.json`

Each fact file is a JSON document written by a dedicated `emit_*()` function in
`scripts/observatory/lib/emit-facts.sh` (or `emit-coverage.sh`). Files are
overwritten on every observatory run. Do not edit them by hand.

---

## modules.json

**File**: `docs/v6/latest/facts/modules.json`
**Refreshed by**: `emit_modules()` in `scripts/observatory/lib/emit-facts.sh`
**Purpose**: Lists every Maven module discovered in the reactor, with its source
directory path, file counts, and source-access strategy.

### Schema

Top-level object with one field:

| Field | Type | Description |
|---|---|---|
| `modules` | array of module objects | One entry per Maven module, in reactor-discovery order. |

Module object fields:

| Field | Type | Values | Description |
|---|---|---|---|
| `name` | string | e.g. `"yawl-engine"` | Maven `<artifactId>` of the module. |
| `path` | string | e.g. `"yawl-engine"` | Directory path relative to the repository root. Matches `name` for standard layouts. |
| `has_pom` | boolean | `true`, `false` | Whether `<path>/pom.xml` exists on disk. |
| `src_files` | integer | >= 0 | Count of `.java` files found under the resolved `source_dir`. For `full_shared` modules this reflects the full shared source tree, not the module's scoped slice. |
| `test_files` | integer | >= 0 | Count of `.java` files found under the module's `<testSourceDirectory>`. |
| `source_dir` | string | e.g. `"../src"`, `"src/main/java"`, `"../src/org/yawlfoundation/yawl/engine"` | Value of `<sourceDirectory>` from the module POM, as written (not resolved). |
| `strategy` | string | `"full_shared"`, `"package_scoped"`, `"standard"` | How the module accesses source files. See values below. |

`strategy` values:

| Value | Meaning |
|---|---|
| `"full_shared"` | `source_dir` is exactly `"../src"`. The module sees the entire shared source tree and uses `<include>`/`<exclude>` patterns to select its slice. |
| `"package_scoped"` | `source_dir` starts with `"../src/"` followed by a package path. The module is pinned to a sub-tree of the shared source. |
| `"standard"` | `source_dir` is `"src/main/java"` or similar. The module owns its own source directory. |

### Example

```json
{
  "modules": [
    {
      "name": "yawl-engine",
      "path": "yawl-engine",
      "has_pom": true,
      "src_files": 736,
      "test_files": 184,
      "source_dir": "../src",
      "strategy": "full_shared"
    },
    {
      "name": "yawl-authentication",
      "path": "yawl-authentication",
      "has_pom": true,
      "src_files": 13,
      "test_files": 0,
      "source_dir": "../src/org/yawlfoundation/yawl/authentication",
      "strategy": "package_scoped"
    }
  ]
}
```

---

## reactor.json

**File**: `docs/v6/latest/facts/reactor.json`
**Refreshed by**: `emit_reactor()` in `scripts/observatory/lib/emit-facts.sh`
**Purpose**: Records the Maven reactor build order and the inter-module dependency
graph derived from child POM `<dependency>` declarations.

### Schema

Top-level object:

| Field | Type | Description |
|---|---|---|
| `reactor_order` | array of strings | Module names in reactor build order. `"yawl-parent"` is always first. |
| `module_deps` | array of dependency objects | Directed edges of the module dependency graph. |

Dependency object fields:

| Field | Type | Values | Description |
|---|---|---|---|
| `from` | string | module name | The dependent module (the one that declares the dependency). |
| `to` | string | module name | The module being depended upon. |

### Example

```json
{
  "reactor_order": [
    "yawl-parent",
    "yawl-utilities",
    "yawl-elements",
    "yawl-engine"
  ],
  "module_deps": [
    {"from": "yawl-elements", "to": "yawl-utilities"},
    {"from": "yawl-engine",   "to": "yawl-elements"}
  ]
}
```

---

## shared-src.json

**File**: `docs/v6/latest/facts/shared-src.json`
**Refreshed by**: `emit_shared_src()` in `scripts/observatory/lib/emit-facts.sh`
**Purpose**: Maps every shared source root to the modules that claim it, including
their compiler include/exclude filters, and flags ownership ambiguities where two
modules include overlapping file patterns.

### Schema

Top-level object:

| Field | Type | Description |
|---|---|---|
| `shared_roots` | array of root objects | One entry per distinct `<sourceDirectory>` value found across all module POMs. |
| `ownership_ambiguities` | array of ambiguity objects | Detected overlaps or unfiltered claims. Empty array when none exist. |

Root object fields:

| Field | Type | Description |
|---|---|---|
| `root` | string | The `<sourceDirectory>` value, as written in the POM (e.g. `"../src"`). |
| `modules` | array of module-filter objects | All modules that declare this root as their source directory. |

Module-filter object fields:

| Field | Type | Values | Description |
|---|---|---|---|
| `name` | string | module name | Maven `<artifactId>` of the module. |
| `includes` | string | pipe-delimited glob patterns, or `""` | The `<include>` patterns from the module's compiler plugin configuration, joined with `|`. Empty string when no includes are declared. |
| `excludes` | string | pipe-delimited glob patterns, or `""` | The `<exclude>` patterns from the module's compiler plugin configuration, joined with `|`. Empty string when no excludes are declared. |

Ambiguity object fields:

| Field | Type | Values | Description |
|---|---|---|---|
| `path` | string | source root path | The shared root where the overlap was detected. |
| `claimed_by` | array of strings | module names | Modules involved in the overlap. |
| `severity` | string | `"HIGH"`, `"MEDIUM"` | `HIGH` when a module claims `../src` with no include filters. `MEDIUM` when two modules share an overlapping include pattern. |
| `reason` | string | — | Human-readable description of the ambiguity. |

### Example

```json
{
  "shared_roots": [
    {
      "root": "../src",
      "modules": [
        {
          "name": "yawl-engine",
          "includes": "**/org/yawlfoundation/yawl/engine/**",
          "excludes": "**/*.xml|**/*.properties"
        }
      ]
    }
  ],
  "ownership_ambiguities": [
    {
      "path": "../src",
      "claimed_by": ["yawl-utilities", "yawl-engine"],
      "severity": "MEDIUM",
      "reason": "Overlapping include: **/org/yawlfoundation/yawl/unmarshal/**/*.xml"
    }
  ]
}
```

---

## tests.json

**File**: `docs/v6/latest/facts/tests.json`
**Refreshed by**: `emit_tests()` in `scripts/observatory/lib/emit-facts.sh`
**Purpose**: Records the Surefire and Failsafe plugin configuration and, per module,
the number of test files that are scoped to that module versus all tests visible in
its test source directory.

### Schema

Top-level object:

| Field | Type | Description |
|---|---|---|
| `surefire` | surefire object | Global Surefire plugin configuration extracted from the parent POM. |
| `failsafe` | failsafe object | Global Failsafe plugin configuration extracted from the parent POM. |
| `module_detail` | array of module-test objects | Per-module test counts. |

Surefire / failsafe object fields:

| Field | Type | Description |
|---|---|---|
| `modules` | array of strings | Modules that have at least one test file matching the includes pattern. |
| `includes` | array of strings | File patterns used to select test classes (e.g. `"**/*Test.java|**/*Tests.java|**/*TestSuite.java"`). |
| `excludes` | array of strings | File patterns used to exclude test classes. Empty string when none declared. |

Module-test object fields:

| Field | Type | Values | Description |
|---|---|---|---|
| `module` | string | module name | Maven `<artifactId>` of the module. |
| `scoped_tests` | integer | >= 0 | Test files that belong to this module's owned packages. For `full_shared` modules this is computed by matching the module's `<include>` patterns against the test directory. |
| `visible_tests` | integer | >= 0 | All test files visible in the module's `<testSourceDirectory>`, regardless of ownership scoping. |
| `integration_tests` | integer | >= 0 | Count of `*IT.java` files (Failsafe integration tests). |
| `test_source` | string | directory path, or `"none"` | Resolved value of `<testSourceDirectory>` from the module POM. `"none"` when no test source directory is declared. |

### Example

```json
{
  "surefire": {
    "modules": ["yawl-utilities", "yawl-engine"],
    "includes": ["**/*Test.java|**/*Tests.java|**/*TestSuite.java"],
    "excludes": [""]
  },
  "failsafe": {
    "modules": [],
    "includes": ["**/*IT.java"],
    "excludes": [""]
  },
  "module_detail": [
    {
      "module": "yawl-engine",
      "scoped_tests": 11,
      "visible_tests": 70,
      "integration_tests": 0,
      "test_source": "../test"
    }
  ]
}
```

---

## maven-hazards.json

**File**: `docs/v6/latest/facts/maven-hazards.json`
**Refreshed by**: `emit_maven_hazards()` in `scripts/observatory/lib/emit-facts.sh`
**Purpose**: Lists Maven build hazards detected at observatory run time, including
cached download failures, logging bridge conflicts, and modules pointing to
non-existent source directories.

### Schema

Top-level object:

| Field | Type | Description |
|---|---|---|
| `hazards` | array of hazard objects | Detected hazards. Empty array when none exist. |

Hazard object fields:

| Field | Type | Values | Description |
|---|---|---|---|
| `code` | string | see below | Machine-readable hazard code. |
| `artifact` | string | — | Artifact identifier or module name affected. |
| `message` | string | — | Human-readable description including a remediation hint. |

`code` values:

| Code | Trigger |
|---|---|
| `H_MAVEN_CACHED_MISSING_ARTIFACT` | A `.lastUpdated` file exists in `~/.m2/repository/org/yawlfoundation/` (cached download failure), or a `_remote.repositories` file exists without a corresponding JAR. |
| `H_LOGGING_BRIDGE_CONFLICT` | Both `log4j-to-slf4j` and `log4j-slf4j2-impl` appear in the root POM. |
| `H_MISSING_SOURCE_DIR` | A module's `<sourceDirectory>` does not resolve to an existing directory on disk. |

### Example

```json
{
  "hazards": [
    {
      "code": "H_LOGGING_BRIDGE_CONFLICT",
      "artifact": "log4j-to-slf4j vs log4j-slf4j2-impl",
      "message": "Both logging bridges present; ensure exclusions are in place per module"
    }
  ]
}
```

---

## deps-conflicts.json

**File**: `docs/v6/latest/facts/deps-conflicts.json`
**Refreshed by**: `emit_deps_conflicts()` in `scripts/observatory/lib/emit-facts.sh`
**Purpose**: Summarises the dependency version management strategy and reports any
child POM version declarations that bypass parent-managed versions.

### Schema

Top-level object:

| Field | Type | Description |
|---|---|---|
| `parent_managed_entries` | integer | Count of `<dependency>` entries in the root POM's `<dependencyManagement>` section. |
| `child_explicit_versions` | integer | Count of explicit `<version>` tags (non-property references) found across all child module POMs. |
| `strategy` | string | Prose description of the versioning strategy in use. |
| `conflicts` | array | Detected version conflicts. Always an empty array in the current implementation; reserved for future use. |

### Example

```json
{
  "parent_managed_entries": 110,
  "child_explicit_versions": 21,
  "strategy": "Parent POM dependencyManagement centralizes all versions. Child POMs use property references.",
  "conflicts": []
}
```

---

## gates.json

**File**: `docs/v6/latest/facts/gates.json`
**Refreshed by**: `emit_gates()` in `scripts/observatory/lib/emit-facts.sh`
**Purpose**: Records the activation state of each quality gate plugin (SpotBugs, PMD,
Checkstyle, JaCoCo, OWASP dependency-check, Maven Enforcer), the Maven skip flags that
disable them, and the full list of profiles declared in the root POM.

### Schema

Top-level object:

| Field | Type | Description |
|---|---|---|
| `gates` | array of gate objects | One entry per detected quality plugin. |
| `skip_flags` | array of skip-flag objects | Maven property flags that disable quality gates. |
| `profiles` | array of strings | All profile `<id>` values from the root POM, in document order. May contain duplicates if a profile ID appears in multiple contexts. |

Gate object fields:

| Field | Type | Values | Description |
|---|---|---|---|
| `name` | string | e.g. `"spotbugs"`, `"jacoco"`, `"enforcer"` | Short name of the quality gate. |
| `phase` | string | e.g. `"verify"`, `"validate"` | Maven lifecycle phase at which the plugin binds. |
| `default_active` | boolean | `true`, `false` | `true` when the plugin runs in the default build (without activating any profile). |
| `activation` | string | `"ACTIVE"`, `"CONFIG_ONLY"`, `"SKIP_DEFAULT"`, `"INERT"`, `"NOT_FOUND"` | How the plugin is configured in the default build section. See values below. |
| `profiles` | array of strings | profile IDs | Profiles that activate this plugin. Empty array when the plugin is only in the default build. |
| `plugin` | string | Maven artifact ID | The plugin's `<artifactId>` (e.g. `"spotbugs-maven-plugin"`). |

`activation` values:

| Value | Meaning |
|---|---|
| `"ACTIVE"` | Plugin has `<executions>` with `<goal>` entries and no `<skip>true</skip>` in the default build. Runs unconditionally. |
| `"CONFIG_ONLY"` | Plugin is declared in the default build but has no active executions or goals. Enabled only via profile. |
| `"SKIP_DEFAULT"` | Plugin has `<skip>true</skip>` in the default build section. |
| `"INERT"` | Plugin has `<executions>` but no `<goal>` entries. |
| `"NOT_FOUND"` | Plugin artifact ID not found in the POM. |

Skip-flag object fields:

| Field | Type | Values | Description |
|---|---|---|---|
| `flag` | string | Maven `-D` property | The command-line flag that disables the gate. |
| `risk` | string | `"RED"`, `"YELLOW"` | `RED` for flags that disable test execution or enforcement. `YELLOW` for flags that disable static analysis only. |
| `disables` | string | — | Human-readable list of what the flag disables. |

### Example

```json
{
  "gates": [
    {
      "name": "jacoco",
      "phase": "verify",
      "default_active": true,
      "activation": "ACTIVE",
      "profiles": ["ci", "prod", "analysis", "sonar"],
      "plugin": "jacoco-maven-plugin"
    },
    {
      "name": "spotbugs",
      "phase": "verify",
      "default_active": false,
      "activation": "CONFIG_ONLY",
      "profiles": ["ci", "prod", "analysis"],
      "plugin": "spotbugs-maven-plugin"
    }
  ],
  "skip_flags": [
    {"flag": "-DskipTests=true", "risk": "RED", "disables": "surefire+failsafe"}
  ],
  "profiles": ["ci", "prod", "analysis", "security-audit"]
}
```

---

## coverage.json

**File**: `docs/v6/latest/facts/coverage.json`
**Refreshed by**: `emit_coverage()` in `scripts/observatory/lib/emit-coverage.sh`
**Purpose**: Aggregates JaCoCo line, branch, and instruction coverage percentages
across all modules and compares them against the project's configured targets.

**Prerequisite**: JaCoCo CSV reports must exist at
`<module>/target/site/jacoco/jacoco.csv`. Run `mvn test` before regenerating this
fact if accurate coverage data is required.

### Schema

Top-level object:

| Field | Type | Description |
|---|---|---|
| `generated_at` | string (ISO 8601 UTC) | Timestamp when the file was last written, e.g. `"2026-02-18T03:44:53Z"`. |
| `aggregate` | aggregate object | Project-wide coverage summary and gate evaluation. |
| `modules` | array of module-coverage objects | Per-module coverage breakdown. |

Aggregate object fields:

| Field | Type | Values | Description |
|---|---|---|---|
| `line_pct` | number | 0 – 100.0 | Aggregate line coverage percentage across all modules with reports. |
| `branch_pct` | number | 0 – 100.0 | Aggregate branch coverage percentage across all modules with reports. |
| `lines_covered` | integer | >= 0 | Total count of covered source lines across all modules. |
| `lines_missed` | integer | >= 0 | Total count of uncovered source lines across all modules. |
| `target_line_pct` | number | 0 – 100.0 | Minimum required line coverage percentage from `quality/test-metrics/coverage-targets.yaml`. |
| `target_branch_pct` | number | 0 – 100.0 | Minimum required branch coverage percentage from `quality/test-metrics/coverage-targets.yaml`. |
| `meets_line_target` | boolean | `true`, `false` | Whether `line_pct >= target_line_pct`. |
| `meets_branch_target` | boolean | `true`, `false` | Whether `branch_pct >= target_branch_pct`. |
| `note` | string | — | Static advisory shown when no JaCoCo reports are present. |

Module-coverage object fields:

| Field | Type | Values | Description |
|---|---|---|---|
| `module` | string | module name | Maven `<artifactId>` of the module. |
| `status` | string | `"measured"`, `"no_report"` | `"measured"` when a JaCoCo CSV was found and parsed. `"no_report"` when no CSV exists (tests not yet run). |
| `line_pct` | number | 0 – 100.0 | Line coverage percentage for this module. `0` when `status` is `"no_report"`. |
| `branch_pct` | number | 0 – 100.0 | Branch coverage percentage for this module. `0` when `status` is `"no_report"`. |
| `instruction_pct` | number | 0 – 100.0 | Bytecode instruction coverage percentage. `0` when `status` is `"no_report"`. |
| `lines_covered` | integer | >= 0 | Covered line count for this module. |
| `lines_missed` | integer | >= 0 | Uncovered line count for this module. |

### Example

```json
{
  "generated_at": "2026-02-18T03:44:53Z",
  "aggregate": {
    "line_pct": 72.4,
    "branch_pct": 58.1,
    "lines_covered": 14823,
    "lines_missed": 5641,
    "target_line_pct": 65,
    "target_branch_pct": 55,
    "meets_line_target": true,
    "meets_branch_target": true,
    "note": "Run mvn test then bash scripts/observatory/observatory.sh --facts to update"
  },
  "modules": [
    {
      "module": "yawl-engine",
      "status": "measured",
      "line_pct": 74.2,
      "branch_pct": 61.0,
      "instruction_pct": 71.8,
      "lines_covered": 5210,
      "lines_missed": 1813
    },
    {
      "module": "yawl-authentication",
      "status": "no_report",
      "line_pct": 0,
      "branch_pct": 0,
      "instruction_pct": 0,
      "lines_covered": 0,
      "lines_missed": 0
    }
  ]
}
```

---

## dual-family.json

**File**: `docs/v6/latest/facts/dual-family.json`
**Refreshed by**: `emit_dual_family()` in `scripts/observatory/lib/emit-facts.sh`
**Purpose**: Catalogs stateful/stateless class mirror pairs — classes that exist in
both `org.yawlfoundation.yawl.*` and `org.yawlfoundation.yawl.stateless.*` and must
be kept in sync.

### Schema

Top-level object:

| Field | Type | Description |
|---|---|---|
| `mirror_namespaces` | array of namespace objects | The two namespace prefixes that define the stateful/stateless boundary. Always exactly one entry. |
| `family_count` | integer | Total number of mirror pairs discovered. |
| `families` | array of family objects | One entry per mirror pair. |

Namespace object fields:

| Field | Type | Description |
|---|---|---|
| `stateful_prefix` | string | Root package prefix for stateful classes (always `"org.yawlfoundation.yawl."`). |
| `stateless_prefix` | string | Root package prefix for stateless classes (always `"org.yawlfoundation.yawl.stateless."`). |

Family object fields:

| Field | Type | Values | Description |
|---|---|---|---|
| `name` | string | simple class name | Unqualified Java class name (e.g. `"YEngine"`). `"package-info"` entries represent package descriptor files. |
| `category` | string | `"elements"`, `"engine"`, `"time"` | Functional grouping. `"elements"` for classes under `elements/`, `"time"` for classes under `engine/time/`, `"engine"` for all others. |
| `stateful_fqcn` | string | fully qualified class name | FQCN of the stateful class (under `org.yawlfoundation.yawl.*`). |
| `stateless_fqcn` | string | fully qualified class name | FQCN of the stateless mirror class (under `org.yawlfoundation.yawl.stateless.*`). |
| `policy` | string | `"MIRROR_REQUIRED"` | Always `"MIRROR_REQUIRED"`. Both classes must exist and remain structurally consistent. |

### Example

```json
{
  "mirror_namespaces": [
    {
      "stateful_prefix": "org.yawlfoundation.yawl.",
      "stateless_prefix": "org.yawlfoundation.yawl.stateless."
    }
  ],
  "family_count": 51,
  "families": [
    {
      "name": "YEngine",
      "category": "engine",
      "stateful_fqcn": "org.yawlfoundation.yawl.engine.YEngine",
      "stateless_fqcn": "org.yawlfoundation.yawl.stateless.engine.YEngine",
      "policy": "MIRROR_REQUIRED"
    }
  ]
}
```

---

## duplicates.json

**File**: `docs/v6/latest/facts/duplicates.json`
**Refreshed by**: `emit_duplicates()` in `scripts/observatory/lib/emit-facts.sh`
**Purpose**: Identifies duplicate fully qualified class names — both unintended
duplicates within the shared source tree and intentional stateful/stateless mirrors.

### Schema

Top-level object:

| Field | Type | Description |
|---|---|---|
| `within_artifact` | array of within-artifact duplicate objects | Classes with the same FQCN appearing more than once in the shared source tree. These are unintended and treated as build errors. Empty array when none exist. |
| `cross_family_duplicates` | array of cross-family objects | Classes that exist in both stateful and stateless namespaces. These are intentional mirrors derived from `dual-family.json`. |

Within-artifact duplicate object fields:

| Field | Type | Description |
|---|---|---|
| `artifact` | string | Always `"shared-src"` for the shared source tree. |
| `fqcn` | string | The duplicated fully qualified class name. |
| `paths` | array of strings | Source file paths (relative to repository root) where the class appears. |

Cross-family duplicate object fields:

| Field | Type | Values | Description |
|---|---|---|---|
| `stateful` | string | fully qualified class name | FQCN of the stateful class. |
| `stateless` | string | fully qualified class name | FQCN of the stateless mirror class. |
| `allowed` | boolean | `true` | Always `true`. Cross-family duplicates are by design. |

### Example

```json
{
  "within_artifact": [],
  "cross_family_duplicates": [
    {
      "stateful": "org.yawlfoundation.yawl.engine.YEngine",
      "stateless": "org.yawlfoundation.yawl.stateless.engine.YEngine",
      "allowed": true
    }
  ]
}
```

---

## Regenerating Facts

```bash
bash scripts/observatory/observatory.sh --facts   # all facts only
bash scripts/observatory/observatory.sh           # facts + diagrams + receipt
```

Running without `--facts` produces the full observatory output: fact files,
Mermaid diagrams in `docs/v6/latest/diagrams/`, and a receipt in
`docs/v6/latest/receipts/observatory.json`.

Coverage data requires a prior test run. To get accurate coverage facts:

```bash
mvn -T 1.5C clean test
bash scripts/observatory/observatory.sh --facts
```

---

## Staleness Detection

After every run, the observatory writes `docs/v6/latest/receipts/observatory.json`.
This receipt contains:

- `run_id`: UTC timestamp of the run (e.g. `"20260217T230032Z"`).
- `inputs.root_pom_sha256`: SHA-256 hash of the root `pom.xml` at the time of the
  run.
- `outputs.facts_sha256`: a map from each fact file name to its SHA-256 hash (e.g.
  `"modules.json": "sha256:674657..."`).
- `outputs.diagrams_sha256`: a map from each diagram file name to its SHA-256 hash.
- `facts_emitted`: list of fact file base names written during the run.
- `timing_ms`: wall-clock duration for facts, diagrams, and total.

To check whether a fact file is stale, compare its current SHA-256 against the hash
in the receipt:

```bash
sha256sum docs/v6/latest/facts/modules.json
# compare against outputs.facts_sha256["modules.json"] in the receipt
```

A mismatch indicates the file was modified after the last observatory run. Re-run
the observatory to restore consistency.

The receipt itself can be verified by re-running the observatory and comparing
the new `run_id` and hashes. If the root POM `sha256` in the receipt differs from
the current file, module discovery may have changed since the last run.
