# YAWL Environment Variables Configuration
# Copy this file to .env and configure with actual values
# SECURITY: NEVER commit .env to git (it's in .gitignore)

# ============================================
# YAWL Engine Credentials (REQUIRED)
# ============================================

# YAWL admin username
# Default: admin
# Used by: ExampleAdapter, MCP configuration, all launchers
YAWL_USERNAME=admin

# YAWL admin password
# SECURITY: This MUST be set to a strong password
# DO NOT use default "YAWL" in production
# Minimum 12 characters, mix of letters, numbers, symbols
# Used by: ExampleAdapter, MCP configuration, all launchers
YAWL_PASSWORD=<use-vault>

# ============================================
# YAWL Engine Connection
# ============================================

# YAWL engine base URL
# Used by: MCP server, launchers, integration modules
YAWL_ENGINE_URL=http://localhost:8080/yawl

# ============================================
# Z.AI Natural Language Integration
# ============================================

# Z.AI API Key (for natural language workflow operations)
# Get your API key from: https://open.bigmodel.cn/
# Alternative name: ZHIPU_API_KEY
# Used by: ZaiService, ZaiHttpClient, MCP natural language tools
ZAI_API_KEY=<use-vault>

# ============================================
# SMS Module Configuration
# ============================================

# SMS service username
# Used by: SMSSender module
SMS_USERNAME=<use-vault>

# SMS service password
# SECURITY: Store in vault, never log
# Used by: SMSSender module
SMS_PASSWORD=<use-vault>

# SMS service send endpoint
SMS_SEND_URI=https://api.smsgateway.example.com/send

# SMS service receive endpoint
SMS_RECEIVE_URI=https://api.smsgateway.example.com/receive

# ============================================
# Model Upload Service Credentials
# ============================================

# Model upload user ID (cost/interface/ModelUpload.java)
# SECURITY: Store in vault
MODEL_UPLOAD_USERID=<use-vault>

# Model upload password
MODEL_UPLOAD_PASSWORD=<use-vault>

# ============================================
# Database Credentials (REQUIRED)
# ============================================

# PostgreSQL password used by Docker Compose postgres service
# SECURITY: Must be set before running docker-compose up
# Used by: docker-compose.yml POSTGRES_PASSWORD, all engine services
POSTGRES_PASSWORD=<use-vault>

# Database password for YAWL engine services
# Used by: docker-compose.yml DB_PASSWORD, CredentialManager.getDatabasePassword()
# Used by: docker-compose.spiffe.yml DB_PASSWORD
DB_PASSWORD=<use-vault>

# Database user (default: yawl)
DB_USER=yawl

# Database host (default: localhost, use postgres in Docker)
DB_HOST=localhost

# Database port (default: 5432)
DB_PORT=5432

# Database name (default: yawl)
DB_NAME=yawl

# ============================================
# JDBC Database Configuration
# ============================================

# JDBC driver class (resourcing/datastore/orgdata/jdbcImpl.java)
YAWL_JDBC_DRIVER=org.postgresql.Driver

# JDBC connection URL (overrides DB_HOST/DB_PORT/DB_NAME if set)
YAWL_JDBC_URL=jdbc:postgresql://localhost:5432/yawl

# Database username override (falls back to DB_USER)
YAWL_JDBC_USER=<use-vault>

# Database password override (falls back to DB_PASSWORD)
# SECURITY: Store in vault
YAWL_JDBC_PASSWORD=<use-vault>

# ============================================
# MCP Server Configuration
# ============================================

# Enable MCP server (true/false)
MCP_ENABLED=true

# MCP transport type (stdio or http)
MCP_TRANSPORT=stdio

# MCP HTTP port (only used if MCP_TRANSPORT=http)
MCP_HTTP_PORT=8082

# ============================================
# A2A Server Configuration
# ============================================

# Port for the A2A agent-to-agent server
# Default: 8081
A2A_PORT=8081

# ============================================
# A2A Authentication (REQUIRED - set at least one scheme)
# ============================================
#
# The A2A server (port 8081) requires every request to carry verifiable
# credentials. At least one of the three schemes below must be configured.
# All three may be enabled simultaneously; the server tries them in order:
#   1. mTLS / SPIFFE (service-to-service, highest assurance)
#   2. JWT Bearer (external agent clients)
#   3. API Key (operational tooling)
#
# CRITICAL: If none of these variables is set, the server will refuse to start.
# There is NO anonymous fallback.

# --------------------------------------------
# Scheme 1: mTLS with SPIFFE X.509 SVIDs
# Preferred for service-to-service within a Kubernetes cluster.
# Requires SPIRE Agent running at SPIFFE_ENDPOINT_SOCKET.
# No secret to distribute: certificates are automatically rotated.
# --------------------------------------------

# SPIFFE trust domain to accept client certificates from.
# Default: yawl.cloud
# Used by: SpiffeAuthenticationProvider
A2A_SPIFFE_TRUST_DOMAIN=yawl.cloud

# SPIRE Agent socket path (optional - defaults to /run/spire/sockets/agent.sock)
# SPIFFE_ENDPOINT_SOCKET=unix:///run/spire/sockets/agent.sock

# --------------------------------------------
# Scheme 2: JWT Bearer Token (HS256)
# Use for external agent clients that cannot present an mTLS certificate.
# Generate the secret with: openssl rand -base64 32
# SECURITY: Minimum 32 characters (256 bits). Store in vault.
# --------------------------------------------

# HMAC-SHA256 signing key for JWT tokens (min 32 chars)
# Generate: openssl rand -base64 32
# Used by: JwtAuthenticationProvider
A2A_JWT_SECRET=<use-vault>

# Optional: expected "iss" (issuer) claim in JWT tokens.
# When set, tokens with a different issuer are rejected.
# Recommended in multi-tenant deployments.
# A2A_JWT_ISSUER=yawl-auth

# JWT token validity period for server-issued tokens (milliseconds)
# Default: 3600000 (1 hour)
# A2A_JWT_VALIDITY_MS=3600000

# --------------------------------------------
# Scheme 3: API Key (HMAC-SHA256)
# Use for operational tooling (scripts, CI/CD pipelines).
# Keys are stored as HMAC digests; the raw value is never retained.
# --------------------------------------------

# Master HMAC key used to derive stored key digests (min 16 chars)
# Generate: openssl rand -hex 32
# SECURITY: Changing this key invalidates ALL registered API keys.
# Used by: ApiKeyAuthenticationProvider
A2A_API_KEY_MASTER=<use-vault>

# Default API key auto-registered as principal "api-key-client" with full access.
# Generate: openssl rand -hex 32
# Clients send this value in the X-API-Key header.
# SECURITY: Treat as a password - store in vault, rotate regularly.
A2A_API_KEY=<use-vault>

# ============================================
# Security & Authentication
# ============================================

# JWT secret for session tokens (generate with: openssl rand -base64 32)
JWT_SECRET=<use-vault>

# Session timeout in minutes
SESSION_TIMEOUT_MINUTES=30

# ============================================
# Observability & Monitoring
# ============================================

# OpenTelemetry endpoint (optional)
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317

# Prometheus metrics endpoint (optional)
METRICS_ENABLED=false
METRICS_PORT=9090

# ============================================
# Development & Testing
# ============================================

# Enable debug logging (true/false)
DEBUG_ENABLED=false

# Test mode (disables some security checks)
# NEVER set to true in production
TEST_MODE=false

# ============================================
# Deployment Notes
# ============================================
#
# Production Deployment Checklist:
# 1.  Replace ALL <use-vault> placeholders with actual credentials from vault
# 2.  Set YAWL_PASSWORD to a strong password (min 12 chars)
# 3.  Set ZAI_API_KEY if using natural language features
# 4.  Generate new JWT_SECRET (openssl rand -base64 32)
# 5.  Set TEST_MODE=false
# 6.  Configure database credentials (YAWL_JDBC_*)
# 7.  Review and set SMS credentials if using SMS module
# 8.  Configure observability endpoints for monitoring
# 9.  Ensure .env file has permissions 600 (readable only by owner)
# 10. NEVER commit .env to version control
#
# A2A Authentication Checklist (CRITICAL - server will not start without one):
# 11. EITHER deploy SPIRE and set A2A_SPIFFE_TRUST_DOMAIN (recommended for k8s)
# 12. OR generate A2A_JWT_SECRET (openssl rand -base64 32) for JWT tokens
# 13. OR set A2A_API_KEY_MASTER + A2A_API_KEY for API key auth
# 14. In production use mTLS (SPIFFE) + JWT together for defence-in-depth
#
# Kubernetes Deployment:
# - Use Kubernetes Secrets for ALL <use-vault> values
# - Example:
#     - name: YAWL_PASSWORD
#       valueFrom:
#         secretKeyRef:
#           name: yawl-secrets
#           key: password
#     - name: A2A_JWT_SECRET
#       valueFrom:
#         secretKeyRef:
#           name: yawl-a2a-secrets
#           key: jwt-secret
#
# Docker Deployment:
# - Use docker-compose env_file or --env-file flag
# - Store .env outside of image build context
# - Use Docker Secrets for sensitive values in Swarm mode
#
# Vault Integration:
# - HashiCorp Vault: vault kv get secret/yawl/credentials
# - AWS Secrets Manager: aws secretsmanager get-secret-value --secret-id yawl/credentials
# - Azure Key Vault: az keyvault secret show --name yawl-password --vault-name <vault-name>
#
