<?xml version="1.0" encoding="UTF-8"?>
<!--
  YAWL v6 Multi-Cloud Deployment Pipeline
  ========================================
  Models the complete CI/CD deployment of YAWL v6 to AWS, GCP, Azure,
  Oracle Cloud, IBM Cloud, and Teradata as a formal workflow net.

  Van Der Aalst Workflow Patterns Used:
    WCP-01 Sequence           - Pipeline stages
    WCP-02 Parallel Split     - Concurrent cloud deployments (AND-split)
    WCP-03 Synchronisation    - Wait for all clouds (AND-join)
    WCP-04 Exclusive Choice   - Success/failure routing (XOR-split)
    WCP-05 Simple Merge       - Converge after decision (XOR-join)
    WCP-10 Arbitrary Cycles   - Retry loop on transient failures
    WCP-19 Cancel Task        - Cancellation set on rollback
    WCP-38 Cancelling Task    - Failed deployment cancels remaining

  Petri Net Semantics:
    pi = (P, T, F, M0) where
      P = {conditions between tasks}
      T = {tasks: build, test, deploy, verify, go-live, rollback}
      F = {flow arcs connecting P and T}
      M0 = {token in InputCondition}

  Soundness Property (Van Der Aalst 1997):
    1. For every marking M reachable from M0, there exists a firing
       sequence from M to the marking with one token in OutputCondition
    2. The marking with one token in OutputCondition is the only
       proper final marking
    3. There are no dead transitions

  Agent Assignment (mu mapping):
    engineer   -> Build, Package (automated)
    validator  -> Test, Schema Validate (automated)
    architect  -> Infrastructure Provisioning (automated)
    integrator -> Cross-Cloud Federation (automated)
    reviewer   -> Security Scan, Compliance Audit (automated)
    tester     -> Smoke Test, Health Check (automated)
    prod-val   -> Production Verification (automated)
    perf-bench -> Latency, Performance Benchmarks (automated)

  Author: Claude Code / seanchatmangpt
  Date: 2026-02-18
  Schema: YAWL_Schema4.0.xsd
-->
<specificationSet xmlns="http://www.yawlfoundation.org/yawlschema"
                  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                  version="4.0"
                  xsi:schemaLocation="http://www.yawlfoundation.org/yawlschema
                                      http://www.yawlfoundation.org/yawlschema/YAWL_Schema4.0.xsd">

  <specification uri="MultiCloudDeployment">
    <name>YAWL v6 Multi-Cloud Deployment Pipeline</name>
    <documentation>
      Orchestrates the build, test, packaging, and parallel deployment of
      YAWL v6 to six cloud providers (AWS, GCP, Azure, Oracle, IBM, Teradata),
      followed by cross-cloud verification and go-live decision.
      Implements the Saga pattern: any cloud failure triggers compensating
      rollback actions across all previously-deployed clouds.
    </documentation>

    <metaData>
      <title>YAWL v6 Multi-Cloud Deployment Pipeline</title>
      <creator>seanchatmangpt</creator>
      <subject>Multi-Cloud Deployment</subject>
      <subject>CI/CD Pipeline</subject>
      <subject>Van Der Aalst Workflow Patterns</subject>
      <description>
        Formal workflow specification for deploying YAWL v6 to production
        across AWS, GCP, Azure, Oracle Cloud, IBM Cloud, and Teradata.
        Uses AND-split/join for parallel cloud deployment, XOR-split for
        success/failure routing, cancellation sets for rollback, and
        timer-based SLA enforcement.
      </description>
      <contributor>Dr Wil van der Aalst (workflow pattern foundations)</contributor>
      <coverage>6.0.0</coverage>
      <version>0.1</version>
      <status>draft</status>
      <persistent>true</persistent>
      <identifier>UID_mcd_v6_2026_multi_cloud</identifier>
    </metaData>

    <xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema">
      <xs:complexType name="DeploymentContextType">
        <xs:sequence>
          <xs:element name="DeploymentId" type="xs:string"/>
          <xs:element name="Version" type="xs:string"/>
          <xs:element name="GitCommitSha" type="xs:string"/>
          <xs:element name="TriggeredBy" type="xs:string"/>
          <xs:element name="Timestamp" type="xs:dateTime"/>
        </xs:sequence>
      </xs:complexType>
      <xs:complexType name="BuildResultType">
        <xs:sequence>
          <xs:element name="BuildStatus" type="xs:string"/>
          <xs:element name="TestsPassed" type="xs:integer"/>
          <xs:element name="TestsFailed" type="xs:integer"/>
          <xs:element name="CoveragePercent" type="xs:double"/>
          <xs:element name="ArtifactDigest" type="xs:string"/>
        </xs:sequence>
      </xs:complexType>
      <xs:complexType name="CloudDeployResultType">
        <xs:sequence>
          <xs:element name="CloudProvider" type="xs:string"/>
          <xs:element name="Region" type="xs:string"/>
          <xs:element name="ClusterEndpoint" type="xs:string"/>
          <xs:element name="DeployStatus" type="xs:string"/>
          <xs:element name="HealthCheckPassed" type="xs:boolean"/>
          <xs:element name="SmokeTestPassed" type="xs:boolean"/>
          <xs:element name="DeployDurationSeconds" type="xs:integer"/>
        </xs:sequence>
      </xs:complexType>
      <xs:complexType name="VerificationResultType">
        <xs:sequence>
          <xs:element name="FederationTestPassed" type="xs:boolean"/>
          <xs:element name="LatencyWithinSLA" type="xs:boolean"/>
          <xs:element name="FailoverTestPassed" type="xs:boolean"/>
          <xs:element name="ComplianceAuditPassed" type="xs:boolean"/>
          <xs:element name="AllCloudsPassed" type="xs:boolean"/>
        </xs:sequence>
      </xs:complexType>
    </xs:schema>

    <!-- ================================================================== -->
    <!--  ROOT NET: MultiCloudDeployment                                     -->
    <!--  Topology: InputCondition -> Initialize -> Build_And_Test ->        -->
    <!--    Package -> [AND-split to 6 clouds] -> [AND-join] ->              -->
    <!--    Cross_Cloud_Verify -> [XOR-split] -> Go_Live | Rollback ->       -->
    <!--    [XOR-join] -> Notify -> OutputCondition                          -->
    <!-- ================================================================== -->
    <decomposition id="MultiCloudDeployment" isRootNet="true"
                   xsi:type="NetFactsType">

      <!-- Net-level variables (case data) -->
      <localVariable>
        <index>0</index>
        <name>DeploymentId</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
        <initialValue>DEPLOY-0000</initialValue>
      </localVariable>
      <localVariable>
        <index>1</index>
        <name>Version</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
        <initialValue>6.0.0</initialValue>
      </localVariable>
      <localVariable>
        <index>2</index>
        <name>GitCommitSha</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
        <initialValue>HEAD</initialValue>
      </localVariable>
      <localVariable>
        <index>3</index>
        <name>BuildPassed</name>
        <type>boolean</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
        <initialValue>false</initialValue>
      </localVariable>
      <localVariable>
        <index>4</index>
        <name>AllCloudsPassed</name>
        <type>boolean</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
        <initialValue>false</initialValue>
      </localVariable>
      <localVariable>
        <index>5</index>
        <name>ImageDigest</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
        <initialValue>sha256:0000</initialValue>
      </localVariable>
      <localVariable>
        <index>6</index>
        <name>RollbackNeeded</name>
        <type>boolean</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
        <initialValue>false</initialValue>
      </localVariable>
      <localVariable>
        <index>7</index>
        <name>NotificationMessage</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
        <initialValue>Deployment not yet started</initialValue>
      </localVariable>

      <processControlElements>

        <!-- ============================================================ -->
        <!-- INPUT CONDITION: Token enters here when case is launched      -->
        <!-- ============================================================ -->
        <inputCondition id="InputCondition">
          <name>Deployment Triggered</name>
          <flowsInto>
            <nextElementRef id="Initialize_Deployment"/>
          </flowsInto>
        </inputCondition>

        <!-- ============================================================ -->
        <!-- TASK: Initialize_Deployment                                   -->
        <!-- Pattern: WCP-01 (Sequence)                                    -->
        <!-- Agent: engineer                                               -->
        <!-- Purpose: Set deployment ID, validate git state, create        -->
        <!--          deployment record in database                        -->
        <!-- ============================================================ -->
        <task id="Initialize_Deployment">
          <name>Initialize Deployment</name>
          <flowsInto>
            <nextElementRef id="Build_And_Test"/>
          </flowsInto>
          <join code="xor"/>
          <split code="and"/>
          <startingMappings>
            <mapping>
              <expression query="&lt;DeploymentId&gt;{/MultiCloudDeployment/DeploymentId/text()}&lt;/DeploymentId&gt;"/>
              <mapsTo>DeploymentId</mapsTo>
            </mapping>
            <mapping>
              <expression query="&lt;Version&gt;{/MultiCloudDeployment/Version/text()}&lt;/Version&gt;"/>
              <mapsTo>Version</mapsTo>
            </mapping>
            <mapping>
              <expression query="&lt;GitCommitSha&gt;{/MultiCloudDeployment/GitCommitSha/text()}&lt;/GitCommitSha&gt;"/>
              <mapsTo>GitCommitSha</mapsTo>
            </mapping>
          </startingMappings>
          <completedMappings>
            <mapping>
              <expression query="&lt;DeploymentId&gt;{/Initialize_Deployment/DeploymentId/text()}&lt;/DeploymentId&gt;"/>
              <mapsTo>DeploymentId</mapsTo>
            </mapping>
          </completedMappings>
          <resourcing>
            <offer initiator="system">
              <distributionSet>
                <initialSet>
                  <role>engineer</role>
                </initialSet>
              </distributionSet>
            </offer>
            <allocate initiator="system"/>
            <start initiator="system"/>
          </resourcing>
          <decomposesTo id="Initialize_Deployment"/>
        </task>

        <!-- ============================================================ -->
        <!-- TASK: Build_And_Test                                          -->
        <!-- Pattern: WCP-01 (Sequence, composite task -> sub-net)         -->
        <!-- Agent: engineer + validator                                   -->
        <!-- Purpose: Maven compile, JUnit tests, schema validation        -->
        <!-- Timer: 30 minute SLA (WCP pattern: SLA Enforcement)           -->
        <!-- ============================================================ -->
        <task id="Build_And_Test">
          <name>Build And Test</name>
          <flowsInto>
            <nextElementRef id="Security_Scan"/>
            <predicate ordering="0">/MultiCloudDeployment/BuildPassed/text() = 'true'</predicate>
          </flowsInto>
          <flowsInto>
            <nextElementRef id="Notify_Stakeholders"/>
            <isDefaultFlow/>
          </flowsInto>
          <join code="xor"/>
          <split code="xor"/>
          <startingMappings>
            <mapping>
              <expression query="&lt;Version&gt;{/MultiCloudDeployment/Version/text()}&lt;/Version&gt;"/>
              <mapsTo>Version</mapsTo>
            </mapping>
            <mapping>
              <expression query="&lt;GitCommitSha&gt;{/MultiCloudDeployment/GitCommitSha/text()}&lt;/GitCommitSha&gt;"/>
              <mapsTo>GitCommitSha</mapsTo>
            </mapping>
          </startingMappings>
          <completedMappings>
            <mapping>
              <expression query="&lt;BuildPassed&gt;{/Build_And_Test/BuildPassed/text()}&lt;/BuildPassed&gt;"/>
              <mapsTo>BuildPassed</mapsTo>
            </mapping>
            <mapping>
              <expression query="&lt;ImageDigest&gt;{/Build_And_Test/ImageDigest/text()}&lt;/ImageDigest&gt;"/>
              <mapsTo>ImageDigest</mapsTo>
            </mapping>
          </completedMappings>
          <timer>
            <trigger>OnEnabled</trigger>
            <duration>PT30M</duration>
          </timer>
          <resourcing>
            <offer initiator="system">
              <distributionSet>
                <initialSet>
                  <role>engineer</role>
                  <role>validator</role>
                </initialSet>
              </distributionSet>
            </offer>
            <allocate initiator="system"/>
            <start initiator="system"/>
          </resourcing>
          <decomposesTo id="Build_And_Test"/>
        </task>

        <!-- ============================================================ -->
        <!-- TASK: Security_Scan                                           -->
        <!-- Pattern: WCP-01 (Sequence)                                    -->
        <!-- Agent: reviewer                                               -->
        <!-- Purpose: Trivy scan, SBOM generation, vulnerability audit     -->
        <!-- ============================================================ -->
        <task id="Security_Scan">
          <name>Security Scan</name>
          <flowsInto>
            <nextElementRef id="Package_Artifacts"/>
          </flowsInto>
          <join code="xor"/>
          <split code="and"/>
          <startingMappings>
            <mapping>
              <expression query="&lt;ImageDigest&gt;{/MultiCloudDeployment/ImageDigest/text()}&lt;/ImageDigest&gt;"/>
              <mapsTo>ImageDigest</mapsTo>
            </mapping>
          </startingMappings>
          <resourcing>
            <offer initiator="system">
              <distributionSet>
                <initialSet>
                  <role>reviewer</role>
                </initialSet>
              </distributionSet>
            </offer>
            <allocate initiator="system"/>
            <start initiator="system"/>
          </resourcing>
          <decomposesTo id="Security_Scan"/>
        </task>

        <!-- ============================================================ -->
        <!-- TASK: Package_Artifacts                                       -->
        <!-- Pattern: WCP-02 (Parallel Split / AND-split)                  -->
        <!-- Agent: engineer                                               -->
        <!-- Purpose: Build Docker images, push to registries, sign with   -->
        <!--          Cosign. AND-split fans out to all 6 cloud deploys.   -->
        <!--                                                               -->
        <!-- This is the critical AND-SPLIT point. After packaging, the    -->
        <!-- token splits into 6 concurrent tokens, one per cloud.         -->
        <!-- Van Der Aalst: "All outgoing paths are activated              -->
        <!--                 simultaneously"                               -->
        <!-- ============================================================ -->
        <task id="Package_Artifacts">
          <name>Package Artifacts</name>
          <flowsInto>
            <nextElementRef id="Deploy_AWS"/>
          </flowsInto>
          <flowsInto>
            <nextElementRef id="Deploy_GCP"/>
          </flowsInto>
          <flowsInto>
            <nextElementRef id="Deploy_Azure"/>
          </flowsInto>
          <flowsInto>
            <nextElementRef id="Deploy_Oracle"/>
          </flowsInto>
          <flowsInto>
            <nextElementRef id="Deploy_IBM"/>
          </flowsInto>
          <flowsInto>
            <nextElementRef id="Deploy_Teradata"/>
          </flowsInto>
          <join code="xor"/>
          <split code="and"/>
          <startingMappings>
            <mapping>
              <expression query="&lt;ImageDigest&gt;{/MultiCloudDeployment/ImageDigest/text()}&lt;/ImageDigest&gt;"/>
              <mapsTo>ImageDigest</mapsTo>
            </mapping>
            <mapping>
              <expression query="&lt;Version&gt;{/MultiCloudDeployment/Version/text()}&lt;/Version&gt;"/>
              <mapsTo>Version</mapsTo>
            </mapping>
          </startingMappings>
          <completedMappings>
            <mapping>
              <expression query="&lt;ImageDigest&gt;{/Package_Artifacts/ImageDigest/text()}&lt;/ImageDigest&gt;"/>
              <mapsTo>ImageDigest</mapsTo>
            </mapping>
          </completedMappings>
          <resourcing>
            <offer initiator="system">
              <distributionSet>
                <initialSet>
                  <role>engineer</role>
                </initialSet>
              </distributionSet>
            </offer>
            <allocate initiator="system"/>
            <start initiator="system"/>
          </resourcing>
          <decomposesTo id="Package_Artifacts"/>
        </task>

        <!-- ============================================================ -->
        <!-- TASKS: Deploy_AWS through Deploy_Teradata                     -->
        <!-- Pattern: WCP-02/03 (Parallel paths between AND-split/join)    -->
        <!-- Agents: architect + integrator (per cloud)                    -->
        <!--                                                               -->
        <!-- Each deploy task runs CONCURRENTLY. All 6 tokens must arrive  -->
        <!-- at Cross_Cloud_Verify (AND-join) before verification starts.  -->
        <!--                                                               -->
        <!-- The Rollback task has a CANCELLATION SET (WCP-38) over all    -->
        <!-- deploy tasks: if rollback fires, remaining deploys cancel.    -->
        <!-- ============================================================ -->

        <!-- AWS: EKS + RDS + CloudWatch -->
        <task id="Deploy_AWS">
          <name>Deploy to AWS</name>
          <flowsInto>
            <nextElementRef id="Cross_Cloud_Verify"/>
          </flowsInto>
          <join code="xor"/>
          <split code="and"/>
          <startingMappings>
            <mapping>
              <expression query="&lt;ImageDigest&gt;{/MultiCloudDeployment/ImageDigest/text()}&lt;/ImageDigest&gt;"/>
              <mapsTo>ImageDigest</mapsTo>
            </mapping>
            <mapping>
              <expression query="&lt;Version&gt;{/MultiCloudDeployment/Version/text()}&lt;/Version&gt;"/>
              <mapsTo>Version</mapsTo>
            </mapping>
            <mapping>
              <expression query="&lt;DeploymentId&gt;{/MultiCloudDeployment/DeploymentId/text()}&lt;/DeploymentId&gt;"/>
              <mapsTo>DeploymentId</mapsTo>
            </mapping>
          </startingMappings>
          <completedMappings>
            <mapping>
              <expression query="&lt;AllCloudsPassed&gt;{/Deploy_AWS/HealthCheckPassed/text()}&lt;/AllCloudsPassed&gt;"/>
              <mapsTo>AllCloudsPassed</mapsTo>
            </mapping>
          </completedMappings>
          <timer>
            <trigger>OnEnabled</trigger>
            <duration>PT45M</duration>
          </timer>
          <resourcing>
            <offer initiator="system">
              <distributionSet>
                <initialSet>
                  <role>architect</role>
                  <role>integrator</role>
                </initialSet>
              </distributionSet>
            </offer>
            <allocate initiator="system"/>
            <start initiator="system"/>
          </resourcing>
          <decomposesTo id="Deploy_Cloud"/>
        </task>

        <!-- GCP: GKE + Cloud SQL + Cloud Operations -->
        <task id="Deploy_GCP">
          <name>Deploy to GCP</name>
          <flowsInto>
            <nextElementRef id="Cross_Cloud_Verify"/>
          </flowsInto>
          <join code="xor"/>
          <split code="and"/>
          <startingMappings>
            <mapping>
              <expression query="&lt;ImageDigest&gt;{/MultiCloudDeployment/ImageDigest/text()}&lt;/ImageDigest&gt;"/>
              <mapsTo>ImageDigest</mapsTo>
            </mapping>
            <mapping>
              <expression query="&lt;Version&gt;{/MultiCloudDeployment/Version/text()}&lt;/Version&gt;"/>
              <mapsTo>Version</mapsTo>
            </mapping>
            <mapping>
              <expression query="&lt;DeploymentId&gt;{/MultiCloudDeployment/DeploymentId/text()}&lt;/DeploymentId&gt;"/>
              <mapsTo>DeploymentId</mapsTo>
            </mapping>
          </startingMappings>
          <completedMappings>
            <mapping>
              <expression query="&lt;AllCloudsPassed&gt;{/Deploy_GCP/HealthCheckPassed/text()}&lt;/AllCloudsPassed&gt;"/>
              <mapsTo>AllCloudsPassed</mapsTo>
            </mapping>
          </completedMappings>
          <timer>
            <trigger>OnEnabled</trigger>
            <duration>PT45M</duration>
          </timer>
          <resourcing>
            <offer initiator="system">
              <distributionSet>
                <initialSet>
                  <role>architect</role>
                  <role>integrator</role>
                </initialSet>
              </distributionSet>
            </offer>
            <allocate initiator="system"/>
            <start initiator="system"/>
          </resourcing>
          <decomposesTo id="Deploy_Cloud"/>
        </task>

        <!-- Azure: AKS + Managed Database + Azure Monitor -->
        <task id="Deploy_Azure">
          <name>Deploy to Azure</name>
          <flowsInto>
            <nextElementRef id="Cross_Cloud_Verify"/>
          </flowsInto>
          <join code="xor"/>
          <split code="and"/>
          <startingMappings>
            <mapping>
              <expression query="&lt;ImageDigest&gt;{/MultiCloudDeployment/ImageDigest/text()}&lt;/ImageDigest&gt;"/>
              <mapsTo>ImageDigest</mapsTo>
            </mapping>
            <mapping>
              <expression query="&lt;Version&gt;{/MultiCloudDeployment/Version/text()}&lt;/Version&gt;"/>
              <mapsTo>Version</mapsTo>
            </mapping>
            <mapping>
              <expression query="&lt;DeploymentId&gt;{/MultiCloudDeployment/DeploymentId/text()}&lt;/DeploymentId&gt;"/>
              <mapsTo>DeploymentId</mapsTo>
            </mapping>
          </startingMappings>
          <completedMappings>
            <mapping>
              <expression query="&lt;AllCloudsPassed&gt;{/Deploy_Azure/HealthCheckPassed/text()}&lt;/AllCloudsPassed&gt;"/>
              <mapsTo>AllCloudsPassed</mapsTo>
            </mapping>
          </completedMappings>
          <timer>
            <trigger>OnEnabled</trigger>
            <duration>PT45M</duration>
          </timer>
          <resourcing>
            <offer initiator="system">
              <distributionSet>
                <initialSet>
                  <role>architect</role>
                  <role>integrator</role>
                </initialSet>
              </distributionSet>
            </offer>
            <allocate initiator="system"/>
            <start initiator="system"/>
          </resourcing>
          <decomposesTo id="Deploy_Cloud"/>
        </task>

        <!-- Oracle Cloud: OKE + Autonomous DB -->
        <task id="Deploy_Oracle">
          <name>Deploy to Oracle Cloud</name>
          <flowsInto>
            <nextElementRef id="Cross_Cloud_Verify"/>
          </flowsInto>
          <join code="xor"/>
          <split code="and"/>
          <startingMappings>
            <mapping>
              <expression query="&lt;ImageDigest&gt;{/MultiCloudDeployment/ImageDigest/text()}&lt;/ImageDigest&gt;"/>
              <mapsTo>ImageDigest</mapsTo>
            </mapping>
            <mapping>
              <expression query="&lt;Version&gt;{/MultiCloudDeployment/Version/text()}&lt;/Version&gt;"/>
              <mapsTo>Version</mapsTo>
            </mapping>
            <mapping>
              <expression query="&lt;DeploymentId&gt;{/MultiCloudDeployment/DeploymentId/text()}&lt;/DeploymentId&gt;"/>
              <mapsTo>DeploymentId</mapsTo>
            </mapping>
          </startingMappings>
          <completedMappings>
            <mapping>
              <expression query="&lt;AllCloudsPassed&gt;{/Deploy_Oracle/HealthCheckPassed/text()}&lt;/AllCloudsPassed&gt;"/>
              <mapsTo>AllCloudsPassed</mapsTo>
            </mapping>
          </completedMappings>
          <timer>
            <trigger>OnEnabled</trigger>
            <duration>PT45M</duration>
          </timer>
          <resourcing>
            <offer initiator="system">
              <distributionSet>
                <initialSet>
                  <role>architect</role>
                  <role>integrator</role>
                </initialSet>
              </distributionSet>
            </offer>
            <allocate initiator="system"/>
            <start initiator="system"/>
          </resourcing>
          <decomposesTo id="Deploy_Cloud"/>
        </task>

        <!-- IBM Cloud: ROKS + Managed Databases -->
        <task id="Deploy_IBM">
          <name>Deploy to IBM Cloud</name>
          <flowsInto>
            <nextElementRef id="Cross_Cloud_Verify"/>
          </flowsInto>
          <join code="xor"/>
          <split code="and"/>
          <startingMappings>
            <mapping>
              <expression query="&lt;ImageDigest&gt;{/MultiCloudDeployment/ImageDigest/text()}&lt;/ImageDigest&gt;"/>
              <mapsTo>ImageDigest</mapsTo>
            </mapping>
            <mapping>
              <expression query="&lt;Version&gt;{/MultiCloudDeployment/Version/text()}&lt;/Version&gt;"/>
              <mapsTo>Version</mapsTo>
            </mapping>
            <mapping>
              <expression query="&lt;DeploymentId&gt;{/MultiCloudDeployment/DeploymentId/text()}&lt;/DeploymentId&gt;"/>
              <mapsTo>DeploymentId</mapsTo>
            </mapping>
          </startingMappings>
          <completedMappings>
            <mapping>
              <expression query="&lt;AllCloudsPassed&gt;{/Deploy_IBM/HealthCheckPassed/text()}&lt;/AllCloudsPassed&gt;"/>
              <mapsTo>AllCloudsPassed</mapsTo>
            </mapping>
          </completedMappings>
          <timer>
            <trigger>OnEnabled</trigger>
            <duration>PT45M</duration>
          </timer>
          <resourcing>
            <offer initiator="system">
              <distributionSet>
                <initialSet>
                  <role>architect</role>
                  <role>integrator</role>
                </initialSet>
              </distributionSet>
            </offer>
            <allocate initiator="system"/>
            <start initiator="system"/>
          </resourcing>
          <decomposesTo id="Deploy_Cloud"/>
        </task>

        <!-- Teradata: Vantage + IntelliCloud -->
        <task id="Deploy_Teradata">
          <name>Deploy to Teradata</name>
          <flowsInto>
            <nextElementRef id="Cross_Cloud_Verify"/>
          </flowsInto>
          <join code="xor"/>
          <split code="and"/>
          <startingMappings>
            <mapping>
              <expression query="&lt;ImageDigest&gt;{/MultiCloudDeployment/ImageDigest/text()}&lt;/ImageDigest&gt;"/>
              <mapsTo>ImageDigest</mapsTo>
            </mapping>
            <mapping>
              <expression query="&lt;Version&gt;{/MultiCloudDeployment/Version/text()}&lt;/Version&gt;"/>
              <mapsTo>Version</mapsTo>
            </mapping>
            <mapping>
              <expression query="&lt;DeploymentId&gt;{/MultiCloudDeployment/DeploymentId/text()}&lt;/DeploymentId&gt;"/>
              <mapsTo>DeploymentId</mapsTo>
            </mapping>
          </startingMappings>
          <completedMappings>
            <mapping>
              <expression query="&lt;AllCloudsPassed&gt;{/Deploy_Teradata/HealthCheckPassed/text()}&lt;/AllCloudsPassed&gt;"/>
              <mapsTo>AllCloudsPassed</mapsTo>
            </mapping>
          </completedMappings>
          <timer>
            <trigger>OnEnabled</trigger>
            <duration>PT45M</duration>
          </timer>
          <resourcing>
            <offer initiator="system">
              <distributionSet>
                <initialSet>
                  <role>architect</role>
                  <role>integrator</role>
                </initialSet>
              </distributionSet>
            </offer>
            <allocate initiator="system"/>
            <start initiator="system"/>
          </resourcing>
          <decomposesTo id="Deploy_Cloud"/>
        </task>

        <!-- ============================================================ -->
        <!-- TASK: Cross_Cloud_Verify                                      -->
        <!-- Pattern: WCP-03 (Synchronisation / AND-join)                  -->
        <!--          WCP-04 (Exclusive Choice / XOR-split)                -->
        <!-- Agent: integrator + tester + prod-val + perf-bench            -->
        <!--                                                               -->
        <!-- AND-JOIN: Waits for ALL 6 cloud deployments to complete.      -->
        <!-- Then XOR-SPLIT: routes to Go_Live or Rollback based on        -->
        <!-- verification results.                                         -->
        <!--                                                               -->
        <!-- Van Der Aalst: "Waits for all incoming paths to complete.     -->
        <!--                 Consumes all incoming tokens."                 -->
        <!-- ============================================================ -->
        <task id="Cross_Cloud_Verify">
          <name>Cross-Cloud Verification</name>
          <flowsInto>
            <nextElementRef id="Go_Live"/>
            <predicate ordering="0">/MultiCloudDeployment/AllCloudsPassed/text() = 'true'</predicate>
          </flowsInto>
          <flowsInto>
            <nextElementRef id="Rollback"/>
            <isDefaultFlow/>
          </flowsInto>
          <join code="and"/>
          <split code="xor"/>
          <startingMappings>
            <mapping>
              <expression query="&lt;DeploymentId&gt;{/MultiCloudDeployment/DeploymentId/text()}&lt;/DeploymentId&gt;"/>
              <mapsTo>DeploymentId</mapsTo>
            </mapping>
          </startingMappings>
          <completedMappings>
            <mapping>
              <expression query="&lt;AllCloudsPassed&gt;{/Cross_Cloud_Verify/AllCloudsPassed/text()}&lt;/AllCloudsPassed&gt;"/>
              <mapsTo>AllCloudsPassed</mapsTo>
            </mapping>
          </completedMappings>
          <resourcing>
            <offer initiator="system">
              <distributionSet>
                <initialSet>
                  <role>integrator</role>
                  <role>tester</role>
                </initialSet>
              </distributionSet>
            </offer>
            <allocate initiator="system"/>
            <start initiator="system"/>
          </resourcing>
          <decomposesTo id="Cross_Cloud_Verify"/>
        </task>

        <!-- ============================================================ -->
        <!-- TASK: Go_Live                                                 -->
        <!-- Pattern: WCP-04/05 (Exclusive Choice path -> Simple Merge)    -->
        <!-- Agent: prod-val                                               -->
        <!-- Purpose: DNS cutover, traffic shifting, monitoring activation -->
        <!-- ============================================================ -->
        <task id="Go_Live">
          <name>Go Live</name>
          <flowsInto>
            <nextElementRef id="Notify_Stakeholders"/>
          </flowsInto>
          <join code="xor"/>
          <split code="and"/>
          <startingMappings>
            <mapping>
              <expression query="&lt;DeploymentId&gt;{/MultiCloudDeployment/DeploymentId/text()}&lt;/DeploymentId&gt;"/>
              <mapsTo>DeploymentId</mapsTo>
            </mapping>
            <mapping>
              <expression query="&lt;Version&gt;{/MultiCloudDeployment/Version/text()}&lt;/Version&gt;"/>
              <mapsTo>Version</mapsTo>
            </mapping>
          </startingMappings>
          <completedMappings>
            <mapping>
              <expression query="&lt;NotificationMessage&gt;{/Go_Live/NotificationMessage/text()}&lt;/NotificationMessage&gt;"/>
              <mapsTo>NotificationMessage</mapsTo>
            </mapping>
          </completedMappings>
          <resourcing>
            <offer initiator="system">
              <distributionSet>
                <initialSet>
                  <role>prod-val</role>
                </initialSet>
              </distributionSet>
            </offer>
            <allocate initiator="system"/>
            <start initiator="system"/>
          </resourcing>
          <decomposesTo id="Go_Live"/>
        </task>

        <!-- ============================================================ -->
        <!-- TASK: Rollback                                                -->
        <!-- Pattern: WCP-38 (Cancelling Task) + ENT-COMPENSATION (Saga)   -->
        <!-- Agent: engineer + architect                                   -->
        <!--                                                               -->
        <!-- CANCELLATION SET: When Rollback fires, it cancels any         -->
        <!-- remaining deploy tasks that haven't completed yet.            -->
        <!-- Then executes compensating actions in reverse order.           -->
        <!--                                                               -->
        <!-- Van Der Aalst: "Completion of one task cancels a set of       -->
        <!--                 other tasks and conditions in the same case"   -->
        <!-- ============================================================ -->
        <task id="Rollback">
          <name>Rollback All Clouds</name>
          <flowsInto>
            <nextElementRef id="Notify_Stakeholders"/>
          </flowsInto>
          <join code="xor"/>
          <split code="and"/>
          <removesTokens id="Deploy_AWS"/>
          <removesTokens id="Deploy_GCP"/>
          <removesTokens id="Deploy_Azure"/>
          <removesTokens id="Deploy_Oracle"/>
          <removesTokens id="Deploy_IBM"/>
          <removesTokens id="Deploy_Teradata"/>
          <startingMappings>
            <mapping>
              <expression query="&lt;DeploymentId&gt;{/MultiCloudDeployment/DeploymentId/text()}&lt;/DeploymentId&gt;"/>
              <mapsTo>DeploymentId</mapsTo>
            </mapping>
          </startingMappings>
          <completedMappings>
            <mapping>
              <expression query="&lt;NotificationMessage&gt;{/Rollback/NotificationMessage/text()}&lt;/NotificationMessage&gt;"/>
              <mapsTo>NotificationMessage</mapsTo>
            </mapping>
            <mapping>
              <expression query="&lt;RollbackNeeded&gt;true&lt;/RollbackNeeded&gt;"/>
              <mapsTo>RollbackNeeded</mapsTo>
            </mapping>
          </completedMappings>
          <resourcing>
            <offer initiator="system">
              <distributionSet>
                <initialSet>
                  <role>engineer</role>
                  <role>architect</role>
                </initialSet>
              </distributionSet>
            </offer>
            <allocate initiator="system"/>
            <start initiator="system"/>
          </resourcing>
          <decomposesTo id="Rollback"/>
        </task>

        <!-- ============================================================ -->
        <!-- TASK: Notify_Stakeholders                                     -->
        <!-- Pattern: WCP-05 (Simple Merge / XOR-join)                     -->
        <!-- Agent: engineer                                               -->
        <!--                                                               -->
        <!-- XOR-JOIN: Converges the Go_Live and Rollback paths.           -->
        <!-- Also converges the Build_And_Test failure path.               -->
        <!-- Only one token arrives (from whichever path was taken).       -->
        <!--                                                               -->
        <!-- Van Der Aalst: "Passes through the first arriving token.      -->
        <!--                 Other incoming paths are never active."        -->
        <!-- ============================================================ -->
        <task id="Notify_Stakeholders">
          <name>Notify Stakeholders</name>
          <flowsInto>
            <nextElementRef id="OutputCondition"/>
          </flowsInto>
          <join code="xor"/>
          <split code="and"/>
          <startingMappings>
            <mapping>
              <expression query="&lt;NotificationMessage&gt;{/MultiCloudDeployment/NotificationMessage/text()}&lt;/NotificationMessage&gt;"/>
              <mapsTo>NotificationMessage</mapsTo>
            </mapping>
            <mapping>
              <expression query="&lt;DeploymentId&gt;{/MultiCloudDeployment/DeploymentId/text()}&lt;/DeploymentId&gt;"/>
              <mapsTo>DeploymentId</mapsTo>
            </mapping>
            <mapping>
              <expression query="&lt;RollbackNeeded&gt;{/MultiCloudDeployment/RollbackNeeded/text()}&lt;/RollbackNeeded&gt;"/>
              <mapsTo>RollbackNeeded</mapsTo>
            </mapping>
          </startingMappings>
          <resourcing>
            <offer initiator="system">
              <distributionSet>
                <initialSet>
                  <role>engineer</role>
                </initialSet>
              </distributionSet>
            </offer>
            <allocate initiator="system"/>
            <start initiator="system"/>
          </resourcing>
          <decomposesTo id="Notify_Stakeholders"/>
        </task>

        <!-- ============================================================ -->
        <!-- OUTPUT CONDITION: Case completes when token arrives here      -->
        <!-- ============================================================ -->
        <outputCondition id="OutputCondition">
          <name>Deployment Complete</name>
        </outputCondition>

      </processControlElements>
    </decomposition>

    <!-- ================================================================ -->
    <!-- TASK DECOMPOSITIONS (WebServiceGatewayFactsType)                  -->
    <!-- Each decomposition defines the task's interface: input/output     -->
    <!-- parameters and whether it's manual (human) or automated (agent)  -->
    <!-- ================================================================ -->

    <!-- Initialize_Deployment: Sets up deployment context -->
    <decomposition id="Initialize_Deployment" xsi:type="WebServiceGatewayFactsType">
      <name>Initialize Deployment</name>
      <inputParam>
        <index>0</index>
        <name>DeploymentId</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </inputParam>
      <inputParam>
        <index>1</index>
        <name>Version</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </inputParam>
      <inputParam>
        <index>2</index>
        <name>GitCommitSha</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </inputParam>
      <outputParam>
        <index>0</index>
        <name>DeploymentId</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </outputParam>
      <externalInteraction>automated</externalInteraction>
    </decomposition>

    <!-- Build_And_Test: Maven compile + JUnit + schema validation -->
    <decomposition id="Build_And_Test" xsi:type="WebServiceGatewayFactsType">
      <name>Build And Test</name>
      <documentation>
        Executes: mvn -T 1.5C clean compile, mvn -T 1.5C clean test,
        xmllint --schema schema/YAWL_Schema4.0.xsd
      </documentation>
      <inputParam>
        <index>0</index>
        <name>Version</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </inputParam>
      <inputParam>
        <index>1</index>
        <name>GitCommitSha</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </inputParam>
      <outputParam>
        <index>0</index>
        <name>BuildPassed</name>
        <type>boolean</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </outputParam>
      <outputParam>
        <index>1</index>
        <name>ImageDigest</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </outputParam>
      <externalInteraction>automated</externalInteraction>
    </decomposition>

    <!-- Security_Scan: Trivy + CycloneDX SBOM -->
    <decomposition id="Security_Scan" xsi:type="WebServiceGatewayFactsType">
      <name>Security Scan</name>
      <inputParam>
        <index>0</index>
        <name>ImageDigest</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </inputParam>
      <externalInteraction>automated</externalInteraction>
    </decomposition>

    <!-- Package_Artifacts: Docker build + push + Cosign -->
    <decomposition id="Package_Artifacts" xsi:type="WebServiceGatewayFactsType">
      <name>Package Artifacts</name>
      <inputParam>
        <index>0</index>
        <name>ImageDigest</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </inputParam>
      <inputParam>
        <index>1</index>
        <name>Version</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </inputParam>
      <outputParam>
        <index>0</index>
        <name>ImageDigest</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </outputParam>
      <externalInteraction>automated</externalInteraction>
    </decomposition>

    <!-- Deploy_Cloud: Shared decomposition for all 6 cloud deploys -->
    <!-- Each cloud task instance shares this interface but receives  -->
    <!-- cloud-specific config via case data mappings                 -->
    <decomposition id="Deploy_Cloud" xsi:type="WebServiceGatewayFactsType">
      <name>Deploy to Cloud</name>
      <documentation>
        Terraform apply -> Helm install -> Smoke test -> Health check.
        Cloud-specific configuration provided by Helm values files:
          AWS:      values-aws.yaml    (EKS + RDS + CloudWatch)
          GCP:      values-gcp.yaml    (GKE + Cloud SQL + Cloud Ops)
          Azure:    values-azure.yaml  (AKS + Managed DB + Monitor)
          Oracle:   values-oracle.yaml (OKE + Autonomous DB)
          IBM:      values-ibm.yaml    (ROKS + managed databases)
          Teradata: values-teradata.yaml (Vantage + IntelliCloud)
      </documentation>
      <inputParam>
        <index>0</index>
        <name>ImageDigest</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </inputParam>
      <inputParam>
        <index>1</index>
        <name>Version</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </inputParam>
      <inputParam>
        <index>2</index>
        <name>DeploymentId</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </inputParam>
      <outputParam>
        <index>0</index>
        <name>HealthCheckPassed</name>
        <type>boolean</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </outputParam>
      <externalInteraction>automated</externalInteraction>
    </decomposition>

    <!-- Cross_Cloud_Verify: Federation + latency + failover tests -->
    <decomposition id="Cross_Cloud_Verify" xsi:type="WebServiceGatewayFactsType">
      <name>Cross-Cloud Verification</name>
      <documentation>
        1. SPIFFE federation test (cross-cloud mTLS)
        2. Inter-cloud latency measurement
        3. Failover test (kill one cloud, verify others handle traffic)
        4. Compliance audit (SOC2, GDPR, HIPAA)
      </documentation>
      <inputParam>
        <index>0</index>
        <name>DeploymentId</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </inputParam>
      <outputParam>
        <index>0</index>
        <name>AllCloudsPassed</name>
        <type>boolean</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </outputParam>
      <externalInteraction>automated</externalInteraction>
    </decomposition>

    <!-- Go_Live: DNS cutover + monitoring activation -->
    <decomposition id="Go_Live" xsi:type="WebServiceGatewayFactsType">
      <name>Go Live</name>
      <inputParam>
        <index>0</index>
        <name>DeploymentId</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </inputParam>
      <inputParam>
        <index>1</index>
        <name>Version</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </inputParam>
      <outputParam>
        <index>0</index>
        <name>NotificationMessage</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </outputParam>
      <externalInteraction>automated</externalInteraction>
    </decomposition>

    <!-- Rollback: Compensating actions across all clouds -->
    <decomposition id="Rollback" xsi:type="WebServiceGatewayFactsType">
      <name>Rollback All Clouds</name>
      <documentation>
        Saga compensation pattern:
        1. Identify which clouds deployed successfully
        2. Execute terraform destroy in reverse order
        3. Restore DNS to previous version
        4. Verify all resources cleaned up
      </documentation>
      <inputParam>
        <index>0</index>
        <name>DeploymentId</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </inputParam>
      <outputParam>
        <index>0</index>
        <name>NotificationMessage</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </outputParam>
      <externalInteraction>automated</externalInteraction>
    </decomposition>

    <!-- Notify_Stakeholders: Email + Slack + dashboard update -->
    <decomposition id="Notify_Stakeholders" xsi:type="WebServiceGatewayFactsType">
      <name>Notify Stakeholders</name>
      <inputParam>
        <index>0</index>
        <name>NotificationMessage</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </inputParam>
      <inputParam>
        <index>1</index>
        <name>DeploymentId</name>
        <type>string</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </inputParam>
      <inputParam>
        <index>2</index>
        <name>RollbackNeeded</name>
        <type>boolean</type>
        <namespace>http://www.w3.org/2001/XMLSchema</namespace>
      </inputParam>
      <externalInteraction>automated</externalInteraction>
    </decomposition>

  </specification>
</specificationSet>
