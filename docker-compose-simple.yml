# Simple Docker Compose for testing
version: '3.8'

services:
  # YAWL Engine
  yawl-engine:
    build:
      context: .
      dockerfile: docker/production/Dockerfile.engine
    image: yawl-engine:6.0.0-alpha
    container_name: yawl-engine
    hostname: yawl-engine
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/actuator/health/liveness"]
      interval: 10s
      timeout: 5s
      start_period: 60s
      retries: 5
    networks:
      - yawl-network

  # Test Runner
  test-runner:
    image: alpine:3.19
    container_name: yawl-test-runner
    depends_on:
      yawl-engine:
        condition: service_healthy
    volumes:
      - ./scripts:/scripts:ro
      - ./test-results:/results
    command: >
      sh -c "
        apk add --no-cache curl jq &&
        echo 'Testing YAWL Engine...' &&
        curl -s http://localhost:8080/actuator/health/liveness | jq . &&
        echo 'Test complete' > /results/test-summary.txt
      "
    networks:
      - yawl-network

networks:
  yawl-network:
    driver: bridge

volumes:
  test-results: